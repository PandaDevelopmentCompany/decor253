(function(g){var window=this;'use strict';var cZC=function(O){var V=new g.GX("und",new g.Kh("Default","und",!0));V.captionTracks=O.captionTracks;return V},sLD=function(O){return new g.bF(function(V,J){var y=O.length,l=[];
if(y)for(var m=function(x,W){y--;l[x]=W;y==0&&V(l)},H=function(x){J(x)},F,N=0;N<O.length;N++)F=O[N],g.Zpn(F,g.oz(m,N),H);
else V(l)})},Lw=function(O){this.K=O},nw=function(){Lw.apply(this,arguments)},TbW=function(){nw.apply(this,arguments)},eNd=function(){nw.apply(this,arguments)},ILW=function(){nw.apply(this,arguments)},Ydz=function(){nw.apply(this,arguments)},aLC=function(){nw.apply(this,arguments)},bpy=function(){nw.apply(this,arguments)},p$F=function(){nw.apply(this,arguments)},fLy=function(){Lw.apply(this,arguments)},hNd=function(){nw.apply(this,arguments)},oIm=function(){nw.apply(this,arguments)},vID=function(){nw.apply(this,
arguments)},w$D=function(){nw.apply(this,arguments)},MHn=function(){nw.apply(this,arguments)},Lhd=function(){nw.apply(this,arguments)},nIF=function(){nw.apply(this,arguments)},X$E=function(){nw.apply(this,arguments)},EIz=function(){nw.apply(this,arguments)},dBz=function(){nw.apply(this,arguments)},gIE=function(){nw.apply(this,arguments)},qdz=function(){nw.apply(this,arguments)},QLI=function(){Lw.apply(this,arguments)},Gun=function(){nw.apply(this,arguments)},KhE=function(){nw.apply(this,arguments)},
tHz=function(){nw.apply(this,arguments)},uTI=function(){nw.apply(this,arguments)},AZn=function(){nw.apply(this,arguments)},rZz=function(){nw.apply(this,arguments)},ipV=function(){nw.apply(this,arguments)},RND=function(){nw.apply(this,arguments)},Bbz=function(){nw.apply(this,arguments)},Pp1=function(){Lw.apply(this,arguments)},kum=function(){Lw.apply(this,arguments)},SdV=function(){Lw.apply(this,arguments)},DBW=function(){nw.apply(this,arguments)},O1I=function(){nw.apply(this,arguments)},VDy=function(){nw.apply(this,
arguments)},J6V=function(){nw.apply(this,arguments)},y6n=function(){nw.apply(this,arguments)},lqd=function(){nw.apply(this,arguments)},mxs=function(){nw.apply(this,arguments)},$xz=function(){nw.apply(this,arguments)},H1z=function(){nw.apply(this,arguments)},jhy=function(){nw.apply(this,arguments)},CIn=function(){nw.apply(this,arguments)},FKz=function(){nw.apply(this,arguments)},NfI=function(){nw.apply(this,arguments)},xxs=function(){nw.apply(this,arguments)},WKz=function(){nw.apply(this,arguments)},
Uxs=function(){nw.apply(this,arguments)},Z1s=function(){nw.apply(this,arguments)},z3d=function(){nw.apply(this,arguments)},c6n=function(){nw.apply(this,arguments)},shn=function(){nw.apply(this,arguments)},Tfz=function(){nw.apply(this,arguments)},e3V=function(){nw.apply(this,arguments)},Iqs=function(){nw.apply(this,arguments)},YLs=function(){nw.apply(this,arguments)},aqE=function(){nw.apply(this,arguments)},b1D=function(){nw.apply(this,arguments)},plW=function(){nw.apply(this,arguments)},fqz=function(){nw.apply(this,
arguments)},h3s=function(){nw.apply(this,arguments)},ouE=function(){Lw.apply(this,arguments)},vuy=function(){nw.apply(this,arguments)},wly=function(){nw.apply(this,arguments)},MDs=function(){nw.apply(this,arguments)},LKF=function(){nw.apply(this,arguments)},nu1=function(){nw.apply(this,arguments)},Xlz=function(){nw.apply(this,arguments)},Eud=function(){nw.apply(this,arguments)},dxW=function(){nw.apply(this,arguments)},guz=function(){nw.apply(this,arguments)},qLz=function(){nw.apply(this,arguments)},
Qhz=function(){nw.apply(this,arguments)},GOD=function(){nw.apply(this,arguments)},KKd=function(){nw.apply(this,arguments)},tDy=function(){nw.apply(this,arguments)},uMn=function(){nw.apply(this,arguments)},A6s=function(){nw.apply(this,arguments)},r6z=function(){nw.apply(this,arguments)},i1I=function(){nw.apply(this,arguments)},R3D=function(){nw.apply(this,arguments)},BfE=function(){nw.apply(this,arguments)},PIz=function(){nw.apply(this,arguments)},kOW=function(){nw.apply(this,arguments)},SLs=function(){nw.apply(this,
arguments)},DxC=function(){nw.apply(this,arguments)},Oim=function(){nw.apply(this,arguments)},Vam=function(){nw.apply(this,arguments)},Jbm=function(){nw.apply(this,arguments)},ybz=function(){nw.apply(this,arguments)},lBV=function(){nw.apply(this,arguments)},m$C=function(){nw.apply(this,arguments)},$$E=function(){nw.apply(this,arguments)},Hiz=function(){nw.apply(this,arguments)},jV1=function(){nw.apply(this,arguments)},CDV=function(){nw.apply(this,arguments)},FzV=function(O){return g.LH((0,g.Dkn)(),
O)},Xx=function(O){this.token=O},N2C=function(O){O=O.key||O.id;
if(!O)throw Error("Entity key is missing");return O},x$n=function(){if(EU)return EU();
var O={};EU=g.tD("PersistentEntityStoreDb",{YM:(O.EntityStore={Yy:1},O.EntityAssociationStore={Yy:2},O),shared:!1,upgrade:function(V,J){J(1)&&g.bH(g.eA(V,"EntityStore",{keyPath:"key"}),"entityType","entityType");J(2)&&(V=g.eA(V,"EntityAssociationStore",{keyPath:["parentEntityKey","childEntityKey"]}),g.bH(V,"byParentEntityKey","parentEntityKey"),g.bH(V,"byChildEntityKey","childEntityKey"))},
version:3});return EU()},WzD=function(O){return g.LH(x$n(),O)},dm=function(O,V){V=V===void 0?{}:V;
g.pn.call(this,g.Ham[O],Object.assign({},{name:"PESEncoderError",type:O},V));this.type=O;this.level="WARNING";Object.setPrototypeOf(this,dm.prototype)},U$F=function(O){return new dm("WRONG_DATA_TYPE",{Z0:O})},Zim=function(O){return O instanceof Error?new dm("UNKNOWN_ENCODE_ERROR",{originalMessage:O.message}):new dm("UNKNOWN_ENCODE_ERROR")},zj1=function(O){return O instanceof Error?new dm("UNKNOWN_DECODE_ERROR",{originalMessage:O.message}):new dm("UNKNOWN_DECODE_ERROR")},cbn=function(O,V){O=O instanceof
dm?O:V(O);
g.sk(O);throw O;},sVn=function(){},T2V=function(O,V,J){try{return O.U(V,J)}catch(y){cbn(y,Zim)}},ejz=function(O){O=(new TextEncoder).encode(O).subarray(0,16);
var V=new Uint8Array(16);V.set(O);return V},gm=function(O){this.K=O},Y6E=function(O){var V=IBW[O];
if(V)return V;g.en(new g.pn("Entity model not found.",{entityType:O}))},aBC=function(O,V){this.K=O;
this.j=V;this.U={}},pay=function(O,V){a:{O=biF(O.j,V.version);
try{var J=O.j(V.data,V.key);break a}catch(y){cbn(y,zj1)}J=void 0}return J},qr=function(O,V,J){return O.K.objectStore("EntityStore").get(V).then(function(y){if(y){if(J&&y.entityType!==J)throw Error("Incorrect entity type");
return pay(O,y)}})},QM=function(O,V,J){return J?(J=J.map(function(y){return qr(O,y,V)}),g.WH.all(J)):O.K.objectStore("EntityStore").index("entityType").getAll(IDBKeyRange.only(V)).then(function(y){return y.map(function(l){return pay(O,l)})})},Kw=function(O,V,J){var y=N2C(V),l=biF(O.j,1),m=Object.assign({},V);
return O.K.objectStore("EntityStore").get(y).then(function(H){if(H){if(H.entityType!==J)throw Error("Incorrect entity type");m.entityMetadata||(H=pay(O,H),m.entityMetadata=H.entityMetadata)}}).then(function(){var H={key:y,
entityType:J,data:T2V(l,m,y),version:1};return g.WH.all([O.K.objectStore("EntityStore").put(H),fBF(O,m,J)])}).then(function(){GV(O,y,J);
return y})},hjd=function(O,V,J){V=V.map(function(y){return Kw(O,y,J)});
return g.WH.all(V)},tL=function(O,V,J){if(J==null?0:J.WQ){var y=new Set;
return oQE(O,V,y).then(function(){for(var m=[],H=g.n(y),F=H.next();!F.done;F=H.next())m.push(tL(O,F.value));return g.WH.all(m).then(function(){})})}var l=g.$y(V).entityType;
return g.WH.all([O.K.objectStore("EntityStore").delete(V),vQz(O,V)]).then(function(){GV(O,V,l)})},waC=function(O,V){return g.oj(O.K.objectStore("EntityStore").index("entityType"),{query:IDBKeyRange.only(V)},function(J){return g.WH.all([J.delete(),
vQz(O,J.cursor.primaryKey)]).then(function(){GV(O,J.cursor.primaryKey,V);return g.fH(J)})})},Maz=function(O,V,J,y){var l=biF(O.j,1);
return qr(O,V,y).then(function(m){if(m){m=g.qP(m,J);var H={key:V,entityType:y,data:T2V(l,m,V),version:1};return g.WH.all([O.K.objectStore("EntityStore").put(H),fBF(O,m,y)])}}).then(function(){GV(O,V,y);
return V})},GV=function(O,V,J){var y=O.U[J];
y||(y=new Set,O.U[J]=y);y.add(V)},LzW=function(O,V,J){var y=N2C(V);
J=Y6E(J);if(!J)return g.WH.resolve([]);J=new J(V);O=O.K.objectStore("EntityAssociationStore");V=[];J=g.n(J.j());for(var l=J.next();!l.done;l=J.next())V.push(O.put({parentEntityKey:y,childEntityKey:l.value}));return g.WH.all(V).then(function(m){return m.map(function(H){return H[1]})})},vQz=function(O,V){return O.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(V))},fBF=function(O,V,J){var y=N2C(V);
return vQz(O,y).then(function(){return LzW(O,V,J)})},oQE=function(O,V,J){if(J.has(V))return g.WH.resolve(void 0);
J.add(V);return nQz(O,V).then(function(y){return O.K.objectStore("EntityAssociationStore").index("byParentEntityKey").delete(IDBKeyRange.only(V)).then(function(){return y})}).then(function(y){var l=g.WH.resolve(void 0);
y=g.n(y);for(var m=y.next(),H={};!m.done;H={Co:void 0},m=y.next())H.Co=m.value,l=l.then(function(F){return function(){return oQE(O,F.Co,J)}}(H));
return l}).then(function(){})},nQz=function(O,V){var J=O.K.objectStore("EntityAssociationStore");
return J.index("byParentEntityKey").getAll(IDBKeyRange.only(V)).then(function(y){var l=[];y=g.n(y);for(var m=y.next();!m.done;m=y.next())m=m.value,l.push(J.index("byChildEntityKey").getAll(m.childEntityKey));return g.WH.all(l)}).then(function(y){var l=[];
y=g.n(y);for(var m=y.next();!m.done;m=y.next())m=m.value,m.length===1&&l.push(m[0].childEntityKey);return l})},ux=function(){},XaC=function(){this.K={};
this.K[0]=new ux;if(!g.Ut("aes_pes_encoder_killswitch")){var O=this.K;try{var V=g.Gb();var J=ejz(V);var y=new gm(new g.n9(J),new g.XL(J))}catch(l){throw O=l instanceof Error?new dm("KEY_CREATION_FAILED",{originalMessage:l.message}):new dm("KEY_CREATION_FAILED"),g.sk(O),O;}O[1]=y}},biF=function(O,V){V=V===void 0?0:V;
O=O.K[V];if(!O)throw V=new dm("INVALID_ENCODER_VERSION",{Z0:V}),g.sk(V),V;return O},AL=function(O,V){g.K.call(this);
this.token=O;this.K=V;this.observers=[];O=new g.Z1.BroadcastChannel("PERSISTENT_ENTITY_STORE_SYNC:"+g.Gb());O.onmessage=this.j.bind(this);this.channel=O},rm=function(O,V,J){var y,l,m,H;
return g.Q(function(F){if(F.j==1)return F.K(WzD(O.token),2);if(F.j!=3)return y=F.U,F.K(g.aj(y,["EntityStore","EntityAssociationStore"],V,function(N){l=new aBC(N,O.K);return J(l)}),3);
m=F.U;l&&(H=l.U,Object.keys(H).length>0&&(O.channel.postMessage(H),EQy(O,H)));return F.return(m)})},ix=function(O,V,J){return rm(O,{mode:"readwrite",
cY:!0},function(y){return Kw(y,V,J)})},d$C=function(O,V){return rm(O,{mode:"readwrite",
cY:!0},function(J){return hjd(J,V,"offlineOrchestrationActionWrapperEntity")})},gQz=function(O,V){return rm(O,{mode:"readwrite",
cY:!0},function(J){return tL(J,V)})},q6m=function(O){return rm(O,{mode:"readwrite",
cY:!0},function(V){return waC(V,"videoPlaybackPositionEntity")})},RA=function(O,V,J){return rm(O,{mode:"readonly",
cY:!0},function(y){return qr(y,V,J)})},Br=function(O,V,J){return rm(O,{mode:"readonly",
cY:!0},function(y){return QM(y,V,J)})},EQy=function(O,V){O=g.n(O.observers);
for(var J=O.next();!J.done;J=O.next())J=J.value,J(V)},QVz=function(){var O,V,J;
return g.Q(function(y){if(y.j==1)return y.W(2),y.K(g.Gf(),4);if(y.j!=2){O=y.U;if(!O||!g.Kz()||typeof g.Z1.BroadcastChannel==="undefined")return y.return();V=new XaC;return y.return(new AL(O,V))}J=y.D();J instanceof Error&&g.sk(J);return y.return()})},Pr=function(){G7F||(G7F=QVz());
return G7F},Kzz=function(O){var V;
O=(V=O.options)==null?void 0:V.persistenceOption;return O==="ENTITY_PERSISTENCE_OPTION_PERSIST"||O==="ENTITY_PERSISTENCE_OPTION_INMEMORY_AND_PERSIST"},taz=function(O){var V;
return g.Q(function(J){return J.j==1?J.K(Pr(),2):(V=J.U)?J.K(rm(V,"readwrite",function(y){for(var l={},m=g.n(O),H=m.next(),F={};!H.done;F={dB:void 0,iF:void 0},H=m.next())F.dB=H.value,F.dB.entityKey&&Kzz(F.dB)&&(F.iF=g.U2(F.dB.payload),H=void 0,F.dB.type==="ENTITY_MUTATION_TYPE_REPLACE"&&(H=function(N){return function(){return Kw(y,N.dB.payload[N.iF],N.iF)}}(F)),F.dB.type==="ENTITY_MUTATION_TYPE_DELETE"&&(H=function(N){return function(){return tL(y,N.dB.entityKey)}}(F)),F.dB.type==="ENTITY_MUTATION_TYPE_UPDATE"&&
(H=function(N){return function(){return Maz(y,N.dB.entityKey,N.dB.payload[N.iF],N.iF)}}(F)),H&&(l[F.dB.entityKey]=l[F.dB.entityKey]?l[F.dB.entityKey].then(H):H()));
return g.WH.all(Object.values(l))}),0):J.return()})},u3m=function(O){var V;
return g.Q(function(J){if(J.j==1){V=O.mutations;if(!V||V.length<=0)return J.return();if(g.aT){var y={type:"ENTITY_LOADED"};V!==void 0&&(y.payload=V);g.aT.dispatch(y)}return J.K(taz(V),2)}V.length=0;J.V()})},AbC=function(O){return O!==void 0},rbW=function(O){var V=g.SN();
V=Object.assign({},V);O=Object.assign({},O);for(var J in V)O[J]?(V[J]!==4&&(V[J]=O[J]),delete O[J]):V[J]!==2&&(V[J]=4);Object.assign(V,O);g.qEX(V);JSON.stringify(V);return V},iim=function(O){var V,J;
return g.Q(function(y){if(y.j==1)return y.K(g.Gf(),2);if(y.j!=3)return(V=y.U)?y.K(g.V1(V),3):y.return();J=y.U;return y.return(g.aj(J,["index","media","captions"],{mode:"readwrite",cY:!0},function(l){var m=IDBKeyRange.bound(O+"|",O+"~");l=[l.objectStore("index").delete(m),l.objectStore("media").delete(m),l.objectStore("captions").delete(m)];return g.WH.all(l).then(function(){})}))})},RjF=function(){var O,V;
return g.Q(function(J){if(J.j==1)return J.K(g.Gf(),2);if(J.j!=3){O=J.U;if(!O)throw g.NV("rvdfd");return J.K(g.V1(O),3)}V=J.U;return J.return(g.aj(V,["index","media"],{mode:"readwrite",cY:!0},function(y){var l={};return g.pH(y.objectStore("index"),{},function(m){var H=m.cursor.key.match(/^([\w\-_]+)\|(a|v)$/),F=g.WH.resolve(void 0);if(H){var N=H[1];H=H[2];l[N]=l[N]||{};var x;l[N][H]=g.uqn((x=m.getValue())==null?void 0:x.fmts)}else F=m.delete().then(function(){});
return g.WH.all([g.fH(m),F]).then(function(W){return g.n(W).next().value})}).then(function(){for(var m={},H=g.n(Object.keys(l)),F=H.next();!F.done;F=H.next()){F=F.value;
var N=l[F].v;m[F]=l[F].a&&N?1:2}var x=rbW(m);return g.$nr(y.objectStore("media"),{},function(W){var U=W.cursor.key.match(g.Rnr);U&&m[U[1]]||y.objectStore("media").delete(W.cursor.key);return g.klr(W)}).then(function(){return x})})}))})},B2s=function(O,V){var J,y;
return g.Q(function(l){if(l.j==1)return l.K(g.Gf(),2);if(l.j!=3){J=l.U;if(!J)throw g.NV("wct");return l.K(g.V1(J),3)}y=l.U;return l.K(g.aj(y,["captions"],{mode:"readwrite",cY:!0},function(m){var H=[];m=m.objectStore("captions");for(var F=0;F<V.length;F++){var N=m.put(V[F],O+"|"+V[F].metadata.vss_id);H.push(N)}return g.WH.all(H)}),0)})},PDW=function(O){var V,J,y;
return g.Q(function(l){if(l.j==1)return V=IDBKeyRange.bound(O+"|",O+"~"),l.K(g.Gf(),2);if(l.j!=3){J=l.U;if(!J)throw g.NV("gactfv");return l.K(g.V1(J),3)}y=l.U;return l.return(y.getAll("captions",V))})},k7V=function(O){return g.Q(function(V){g.Oy(O,0);
return V.return(iim(O))})},S6F=function(O){return{context:g.GE(),
videoIds:O}},D$V=function(O){return{context:g.GE(),
playlistIds:O}},Oqm=function(O){return{context:g.GE(),
offlinePlaylistSyncChecks:O}},VIs=function(){this.K=new Map},yBs=function(){JBd||(JBd=new VIs);
return JBd},llV=function(O,V){return{eventType:{flowEventNamespace:"FLOW_EVENT_NAMESPACE_OFFLINE_ORCHESTRATION",
flowEventType:O},metadata:V,statusCode:void 0,csn:void 0,can:void 0}},mqE=function(O,V,J){if(!J){var y=y===void 0?!1:y;
J=O.K.get("FLOW_TYPE_OFFLINE_ORCHESTRATION");if(!J||y)J=g.mR(16),O.K.set("FLOW_TYPE_OFFLINE_ORCHESTRATION",J)}O={flowNonce:J,flowType:"FLOW_TYPE_OFFLINE_ORCHESTRATION",flowEventType:V.eventType};V.metadata&&(O.flowMetadata=V.metadata);V.statusCode!==void 0&&(O.flowEventStatus=V.statusCode);V.csn&&(O.csn=V.csn);V.can&&(O.can=V.can);g.l6("flowEvent",O,void 0)},$qF=function(O){var V,J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo,md,xY,V7,Tr,Rp,ys,JI,uX,nn,im,fd,h,X1,AI,gV;
return g.Q(function(lX){if(lX.j==1)return lX.K(rm(O,{mode:"readonly",cY:!0},function(az){return QM(az,"playbackData").then(function(p){var Jr=p.map(function(sz){return sz.transfer}).filter(function(sz){return!!sz}),Ht=p.map(function(sz){return sz.offlineVideoPolicy}).filter(function(sz){return!!sz}),wT=p.filter(function(sz){return!!sz.key}).map(function(sz){return g.Hq(g.$y(sz.key).entityId,"downloadStatusEntity")});
Jr=QM(az,"transfer",Jr);Ht=QM(az,"offlineVideoPolicy",Ht);wT=QM(az,"downloadStatusEntity",wT);var HZ=Jr.then(function(sz){sz=sz.reduce(function(Ml,ZZ){(ZZ==null?0:ZZ.offlineVideoStreams)&&Ml.push.apply(Ml,g.q(ZZ.offlineVideoStreams));return Ml},[]).filter(function(Ml){return!!Ml});
return QM(az,"offlineVideoStreams",sz)});
return g.WH.all([Jr,Ht,HZ,wT]).then(function(sz){var Ml=g.n(sz);sz=Ml.next().value;var ZZ=Ml.next().value;var Mk=Ml.next().value;Ml=Ml.next().value;return[p,sz,ZZ,Mk,Ml]})})}),2);
if(lX.j!=3)return V=lX.U,lX.K(rm(O,{mode:"readonly",cY:!0},function(az){return QM(az,"mainDownloadsListEntity").then(function(p){var Jr,Ht;return(Ht=(Jr=p[0])==null?void 0:Jr.downloads)!=null?Ht:[]})}),3);
J=lX.U;y=g.n(V);l=y.next().value;m=y.next().value;H=y.next().value;F=y.next().value;N=y.next().value;x=l;W=m;U=H;Z=F;z=N;c={};Y={};b={};M={};w={};L=[];X=g.n(W);for(u=X.next();!u.done;u=X.next())(G=u.value)&&(c[G.key]=G);k=g.n(U);for(D=k.next();!D.done;D=k.next())(Oo=D.value)&&(Y[Oo.key]=Oo);md=g.n(z);for(xY=md.next();!xY.done;xY=md.next())(V7=xY.value)&&(b[V7.key]=V7);Tr=g.n(Z);for(Rp=Tr.next();!Rp.done;Rp=Tr.next())(ys=Rp.value)&&(M[ys.key]=ys);JI=g.n(J);for(uX=JI.next();!uX.done;uX=JI.next())nn=
uX.value,im=void 0,w[(im=nn.videoItem)!=null?im:""]=!0,nn.videoItem&&(h=fd=void 0,X1=(h=(fd=g.$y(nn.videoItem))==null?void 0:fd.entityId)!=null?h:"",L.push({externalVideoId:X1}));AI=x.filter(function(az){if(!az||!az.key||!az.offlineVideoPolicy)return!1;az=g.$y(az.key).entityId;az=g.Hq(az,"downloadStatusEntity");var p;return!(az&&((p=b[az])==null?void 0:p.downloadState)==="DOWNLOAD_STATE_USER_DELETED")});
gV=AI.map(function(az){var p=c[az.transfer],Jr=[];if(p==null?0:p.offlineVideoStreams)for(var Ht=g.n(p.offlineVideoStreams),wT=Ht.next();!wT.done;wT=Ht.next())(wT=M[wT.value])&&Jr.push(wT);Ht=Y[az.offlineVideoPolicy];wT=w;var HZ=az==null?void 0:az.playerResponseTimestamp,sz=g.$y(Ht.key).entityId;az=g.Hq(sz,"mainVideoEntity");if(Ht.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"){var Ml="OFFLINE_VIDEO_STATE_DISABLED";Ht.expirationTimestamp&&Number(Ht.expirationTimestamp)<Date.now()/1E3&&(Ml="OFFLINE_VIDEO_STATE_EXPIRED")}else if(Ht.action===
"OFFLINE_VIDEO_POLICY_ACTION_DOWNLOAD_FAILED")Ml="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";else{switch(p==null?void 0:p.transferState){case "TRANSFER_STATE_TRANSFER_IN_QUEUE":Ml="OFFLINE_VIDEO_STATE_PENDING";break;case "TRANSFER_STATE_TRANSFERRING":Ml="OFFLINE_VIDEO_STATE_TRANSFERRING";break;case "TRANSFER_STATE_PAUSED_BY_USER":Ml="OFFLINE_VIDEO_STATE_PAUSED_TRANSFER";break;case "TRANSFER_STATE_FAILED":Ml="OFFLINE_VIDEO_STATE_OFFLINE_FAILED";break;case "TRANSFER_STATE_COMPLETE":Ml="OFFLINE_VIDEO_STATE_PLAYABLE";
break;case "TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH":Ml="OFFLINE_VIDEO_STATE_STREAMS_OUT_OF_DATE";break;default:Ml="OFFLINE_VIDEO_STATE_UNKNOWN"}if(Ml==="OFFLINE_VIDEO_STATE_OFFLINE_FAILED")switch(p==null?void 0:p.failureReason){case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":Ml="OFFLINE_VIDEO_STATE_OUT_OF_STORAGE_ERROR";break;case "TRANSFER_FAILURE_REASON_STREAM_MISSING":Ml="OFFLINE_VIDEO_STATE_STREAMS_MISSING";break;case "TRANSFER_FAILURE_REASON_NETWORK":case "TRANSFER_FAILURE_REASON_NETWORK_LOST":Ml=
"OFFLINE_VIDEO_STATE_NETWORK_ERROR"}}sz={id:sz,videoState:Ml};if(p==null?0:p.cotn)sz.cotn=p.cotn;if(p==null?0:p.maximumDownloadQuality)sz.selectedVideoQuality=p==null?void 0:p.maximumDownloadQuality;if(p==null?0:p.lastProgressTimeMs)sz.lastProgressTimeMs=p.lastProgressTimeMs;HZ&&(sz.playerResponseSavedTimeMs=String(Number(HZ)*1E3));p=String;HZ=0;Jr=g.n(Jr);for(Ml=Jr.next();!Ml.done;Ml=Jr.next())if(Ml=Ml.value,Ml.streamsProgress){Ml=g.n(Ml.streamsProgress);for(var ZZ=Ml.next();!ZZ.done;ZZ=Ml.next()){var Mk=
void 0;HZ+=Number((Mk=ZZ.value.numBytesDownloaded)!=null?Mk:0)}}sz.downloadedBytes=p(HZ);sz.selectedOfflineMode=wT[az]?"OFFLINE_MODE_TYPE_AUTO_OFFLINE":"OFFLINE_NOW";Ht.action==="OFFLINE_VIDEO_POLICY_ACTION_DISABLE"&&(sz.offlinePlaybackDisabledReason=Ht.offlinePlaybackDisabledReason);return sz});
return lX.return({offlineVideos:gV,additionalOfflineClientState:{mainAppAdditionalOfflineClientState:{smartDownloadVideos:L}}})})},Hqz=function(){this.locks=navigator.locks},j_F=function(){try{var O=g.cn("ytglobal.locks_");
if(O)return O;var V;if(V=navigator){var J=navigator;V="locks"in J&&!!J.locks}if(V)return g.Z1.localStorage&&g.Z1.localStorage.getItem("noop"),O=new Hqz,g.zD("ytglobal.locks_",O),O}catch(y){}},kh=function(){},CTz=function(){},FUs=function(O){if(O.includes(":"))throw Error("Invalid user cache name: "+O);
return O+":"+g.Gb("CacheStorage get")},Nqz=function(){return g.Q(function(O){if(S2!==void 0)return O.return(S2);
S2=new Promise(function(V){var J;return g.Q(function(y){switch(y.j){case 1:return y.W(2),y.K(Dh.open("test-only"),4);case 4:return y.K(Dh.delete("test-only"),5);case 5:y.S(3);break;case 2:if(J=y.D(),J instanceof Error&&J.name==="SecurityError")return V(!1),y.return();case 3:V("caches"in window),y.V()}})});
return O.return(S2)})},WUn=function(){return g.Q(function(O){if(O.j==1)return O.K(Nqz(),2);
if(!O.U)return O.return(void 0);xqI||(xqI=new CTz);return O.return(xqI)})},OY=function(O,V,J){g.en(new g.pn("Woffle: "+O,J?{cotn:J}:""));
V instanceof Error&&g.en(V)},UqI=function(O){var V;
return g.Q(function(J){if(J.j==1)return J.K($qF(O),2);V=J.U;g.l6("offlineStateSnapshot",V);J.V()})},Vu=function(O){g.K.call(this);
var V=this;this.api=O;this.Ty={oow:function(){return V.K},
HJE:function(){return V.j}};
typeof g.Z1.BroadcastChannel!=="undefined"&&(this.K=new g.Z1.BroadcastChannel("PLAYER_OFFLINE_ERROR_SYNC:"+g.Gb()),this.K.onmessage=this.U.bind(this),this.j=new g.Z1.BroadcastChannel("PLAYER_OFFLINE_PAUSE_SYNC:"+g.Gb()),this.j.onmessage=this.D.bind(this))},Jv=function(O,V){O.api.MX("onOfflineOperationFailure",V);
var J;(J=O.K)==null||J.postMessage(V)},ZqC=function(O,V,J){var y=this;
this.T=O;this.qX=V;this.visibility=J;this.W=this.S=this.V=this.U=this.K=!1;this.D=new g.t_(function(){y.xv()});
this.Ty={kE:function(){return y.j},
xv:function(){y.xv()},
tQv:function(){return y.D}};
this.visibility.subscribe("visibilitystatechange",function(){y.D_()})},zLn=function(O){if(!O.U&&!O.K){var V=j_F();
if(V){O.U=!0;var J=g.Gb("OfflineLockManager");V.request("woffle_orchestration_leader:"+J,{},function(){var y,l;return g.Q(function(m){switch(m.j){case 1:return m.W(2),O.j=new g.HP,O.K=!0,O.U=!1,m.K(O.T(),4);case 4:return m.K(O.j.promise,5);case 5:m.S(0);break;case 2:y=m.D(),O.xv(),y instanceof Error&&(l=y,l.args=[{name:"WoLockManagerError",NR:y.name}],g.sk(l)),m.V()}})})}}},cBW=function(O){O.K&&(O.W=!0,yu(O))},s_E=function(O,V){O.K&&(O.V=V,yu(O))},Tqn=function(O,V){O.K&&(O.S=V,yu(O))},yu=function(O){O.S&&
O.V&&O.W&&O.visibility.isBackground()?g.uL(O.D,6E4):O.D.stop()},lq=function(O){var V;
O.offlineDeleteReason=(V=O.offlineDeleteReason)!=null?V:"OFFLINE_DELETE_REASON_UNKNOWN";var J;O.offlineModeType=(J=O.offlineModeType)!=null?J:"OFFLINE_NOW";g.l6("offlineDeleteEvent",O)},mF=function(O,V){var J=V.videoId;
var y=V.r8;V=V.offlineModeType;O.encryptedVideoId=J;O.cotn=y==null?void 0:y.cotn;O.offlineabilityFormatType=y==null?void 0:y.maximumDownloadQuality;var l;O.isRefresh=(l=y==null?void 0:y.isRefresh)!=null?l:!1;var m;O.softErrorCount=(m=y==null?void 0:y.transferRetryCount)!=null?m:0;O.offlineModeType=V!=null?V:"OFFLINE_NOW";(O.transferStatusType==="TRANSFER_STATUS_TYPE_UNKNOWN"&&O.statusType==="UNKNOWN_STATUS_TYPE"||!O.transferStatusType&&!O.statusType)&&g.en(Error("Woffle unknown transfer status"));
g.l6("offlineTransferStatusChanged",O)},eLz=function(O){mF({transferStatusType:"TRANSFER_STATUS_TYPE_ENQUEUED",
statusType:"ADDED_TO_QUEUE"},O)},Ils=function(O,V,J,y){y={transferStatusType:"TRANSFER_STATUS_TYPE_PROCESSING",
statusType:"OFFLINING_STARTED",transferFirstStarted:!!y};V&&J&&(V=Math.floor(V/1024).toFixed(),J=Math.floor(J/1024).toFixed(),y.alreadyDownloadedKbytes=V,y.totalFetchedKbytes=V,y.totalContentKbytes=J);mF(y,O)},YWz=function(O){mF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_PLAYER_RESPONSE_REFRESH"},O)},alm=function(O){mF({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_USER_PAUSE",
statusType:"SUSPENDED"},O)},bqF=function(O){switch(O){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":return"OFFLINE_DATABASE_ERROR";
case "TRANSFER_FAILURE_REASON_PLAYABILITY":return"NOT_PLAYABLE";case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":return"TOO_MANY_RETRIES";case "TRANSFER_FAILURE_REASON_INTERNAL":return"OFFLINE_DOWNLOAD_CONTROLLER_ERROR";case "TRANSFER_FAILURE_REASON_STREAM_MISSING":return"STREAM_VERIFICATION_FAILED";case "TRANSFER_FAILURE_REASON_SERVER":case "TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING":return"OFFLINE_REQUEST_FAILURE";case "TRANSFER_FAILURE_REASON_NETWORK":return"OFFLINE_NETWORK_ERROR";default:return"UNKNOWN_FAILURE_REASON"}},
$w=function(O){var V,J,y;
return((y=(V=O.actionMetadata)==null?void 0:(J=V.retryScheduleIntervalsInSeconds)==null?void 0:J.length)!=null?y:0)>0},H1=function(O){return O.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD"&&!!O.entityKey},jb=function(O){return O.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&!!O.entityKey},CQ=function(O){return O.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&!!O.entityKey},pG1=function(O){return O.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE"&&!!O.entityKey},
F8=function(O,V,J,y,l){l=l===void 0?!1:l;
var m,H,F,N,x,W;return g.Q(function(U){if(U.j==1)return m=g.Hq(O,V),H=g.Hq(O,"downloadStatusEntity"),U.K(rm(J,{mode:"readonly",cY:!0},function(Z){return g.WH.all([qr(Z,m,V),qr(Z,H,"downloadStatusEntity")])}),2);
F=U.U;N=F.length?F[0]:void 0;if(!N)return U.uw(0);x=fls;if(W=F.length>1?F[1]:void 0){if(W.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&!l)return U.return();W.downloadState=y}else W={key:H,downloadState:y};g.fY(N,x,W);return U.K(rm(J,{mode:"readwrite",cY:!0},function(Z){return g.WH.all([Kw(Z,N,V),Kw(Z,W,"downloadStatusEntity")])}),0)})},NG=function(O,V){return O.actionType===V.actionType&&O.entityKey===V.entityKey},xw=function(O,V){if(O&&O.transferState!=="TRANSFER_STATE_COMPLETE"&&O.transferState!==
"TRANSFER_STATE_FAILED"){var J=g.$y(O.key).entityId;
mF({transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_BY_USER",statusType:"CANCELLED"},{videoId:J,r8:O,offlineModeType:V})}},W1=function(O){if(!O||!O.thumbnails)return[];
var V=[];O=g.n(O.thumbnails);for(var J=O.next();!J.done;J=O.next())J=J.value,J.url&&V.push(J.url);return V},hLn=function(O,V,J){J=J===void 0?[]:J;
var y,l,m,H,F,N,x,W,U,Z,z,c,Y;return g.Q(function(b){if(b.j==1)return J.length?b.K(Br(O,V),2):b.return([]);y=b.U;l=new Set;m=g.n(y);for(H=m.next();!H.done;H=m.next())if(F=H.value,N=F.id||F.key)x=g.$y(N).entityId,l.add(x);W=[];U=g.n(J);for(Z=U.next();!Z.done;Z=U.next())z=Z.value,c=z.offlineVideoData,Y=void 0,((Y=c)==null?0:Y.videoId)&&!l.has(c.videoId)&&W.push(z);return b.return(W)})},o9s=function(O,V,J){return new g.WL(O,{cotn:V,
raw_player_response:J,download_media:!0,start:Infinity,disable_watch_next:!0})},v9E=function(){return{priority:1,
retryScheduleIntervalsInSeconds:[1,2,4]}},UY=function(O,V,J,y,l,m,H,F,N,x,W){this.entityType=O;
this.actionId=V;this.action=J;this.parentActionId=y;this.rootActionId=l===void 0?V:l;this.childActionIds=m;this.prereqActionId=H;this.postreqActionIds=F;this.hasChildActionFailed=x;this.retryScheduleIndex=0;this.K=W||Date.now();this.retryScheduleIndex=N||0},ZC=function(O){if(!O.key)throw Error("Entity key is required.");
if(!O.actionProto)throw Error("OfflineOrchestrationAction is required.");var V=g.$y(O.key),J=g.$y(O.actionProto.entityKey);return new UY(J.entityType,V.entityId,O.actionProto,O.parentActionId,O.rootActionId,O.childActionIds,O.prereqActionId,O.postreqActionIds,O.retryScheduleIndex,O.hasChildActionFailed,Number(O.enqueueTimeSec)*1E3)},za=function(O){return{key:g.Hq(O.actionId,"offlineOrchestrationActionWrapperEntity"),
actionProto:O.action,parentActionId:O.parentActionId,rootActionId:O.rootActionId,childActionIds:O.childActionIds,prereqActionId:O.prereqActionId,postreqActionIds:O.postreqActionIds,retryScheduleIndex:O.retryScheduleIndex,hasChildActionFailed:O.hasChildActionFailed,enqueueTimeSec:(O.K/1E3).toFixed()}},wG1=function(){var O;
return g.Q(function(V){return V.j==1?V.K(WUn(),2):(O=V.U)?V.return(O.delete("yt-player-local-img")):V.return(!0)})},c1=function(O){var V,J;
return g.Q(function(y){if(y.j==1)return y.K(WUn(),2);if(y.j!=3){V=y.U;if(!V)throw Error("Cache API not supported");return O.length?y.K(V.open("yt-player-local-img"),3):y.return()}J=y.U;return y.K(Promise.all(O.map(function(l){return J.delete(l)})),0)})},sY=function(O){var V,J;
return g.Q(function(y){if(y.j==1)return y.K(WUn(),2);if(y.j!=3){V=y.U;if(!V)throw Error("Cache API not supported");return O.length?y.K(V.open("yt-player-local-img"),3):y.return()}J=y.U;return y.K(J.addAll(O),0)})},Ta=function(O,V,J,y,l){var m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo,md,xY,V7,Tr,Rp,ys,JI,uX,nn,im;
return g.Q(function(fd){switch(fd.j){case 1:return m=g.Hq(O,"mainVideoEntity"),H=g.Hq(O,"ytMainChannelEntity"),F=g.Hq(O,"transfer"),N=g.Hq(O,"videoDownloadContextEntity"),fd.K(rm(V,{mode:"readonly",cY:!0},function(h){return g.WH.all([qr(h,m,"mainVideoEntity"),qr(h,H,"ytMainChannelEntity"),qr(h,F,"transfer"),qr(h,N,"videoDownloadContextEntity"),QM(h,"ytMainChannelEntity"),QM(h,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:x=fd.U;W=g.n(x);U=W.next().value;Z=W.next().value;z=W.next().value;c=W.next().value;Y=W.next().value;b=W.next().value;M=U;w=Z;L=z;X=c;u=Y;G=b;if(!M&&!w){fd.uw(3);break}k=M?W1(M.thumbnail):[];if(!w){D=[];fd.uw(4);break}return fd.K(MIm(w,u),5);case 5:D=fd.U;case 4:return Oo=D,fd.K(c1(k.concat(Oo)),3);case 3:md=[];xY=g.Hq(O,"downloadStatusEntity");V7=g.n(G);for(Tr=V7.next();!Tr.done;Tr=V7.next())Rp=Tr.value,ys=g.$y(Rp.key).entityId,JI=ZC(Rp),uX=g.$y(JI.action.entityKey).entityId,ys!==O&&uX!==
O||NG(J,Rp.actionProto)||md.push(Rp.key);return fd.K(rm(V,{mode:"readwrite",cY:!0},function(h){var X1=md.map(function(AI){return tL(h,AI)});
X1.push(tL(h,m,{WQ:!0}));X1.push(tL(h,xY,{WQ:!0}));return g.WH.all(X1)}),7);
case 7:im=(nn=X)==null?void 0:nn.offlineModeType,l&&(lq(l),l.offlineModeType&&(im=l.offlineModeType)),xw(L,im),Jv(y,{entityKey:m,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),fd.V()}})},XGF=function(O,V,J,y){var l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo,md,xY,V7,Tr,Rp,ys,JI,uX,nn,im,fd,h,X1,AI,gV,lX,az,p,Jr,Ht,wT,HZ,sz,Ml,ZZ,Mk,f,a;
return g.Q(function(v){switch(v.j){case 1:return l=g.Hq(O,"mainPlaylistEntity"),m=g.Hq(O,"ytMainChannelEntity"),v.K(rm(V,{mode:"readonly",cY:!0},function(E){return g.WH.all([qr(E,l,"mainPlaylistEntity"),qr(E,m,"ytMainChannelEntity"),QM(E,"mainPlaylistEntity"),QM(E,"mainDownloadsListEntity"),QM(E,"ytMainChannelEntity"),QM(E,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:H=v.U;F=g.n(H);N=F.next().value;x=F.next().value;W=F.next().value;U=F.next().value;Z=F.next().value;z=F.next().value;c=N;Y=x;b=W;M=U;w=Z;L=z;if(!c&&!Y){v.uw(3);break}X=c?LUV(c):[];if(!Y){u=[];v.uw(4);break}return v.K(MIm(Y,w),5);case 5:u=v.U;case 4:return G=u,v.K(c1(X.concat(G)),3);case 3:k=[];D=new Map;if(!c){v.uw(7);break}return v.K(n9z(c,b,M),8);case 8:k=v.U;Oo=g.n(k);for(md=Oo.next();!md.done;md=Oo.next())xY=md.value,D.set(xY,{videoId:xY,playlistId:O,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});
return v.K(rm(V,{mode:"readonly",cY:!0},function(E){return g.WH.all([QM(E,"transfer"),QM(E,"videoDownloadContextEntity")])}),9);
case 9:V7=v.U;Tr=g.n(V7);Rp=Tr.next().value;ys=Tr.next().value;JI=Rp;uX=ys;nn=g.n(JI);for(im=nn.next();!im.done;im=nn.next())fd=im.value,h=g.$y(fd.key).entityId,(X1=D.get(h))&&fd&&(X1.cotn=fd.cotn);AI=g.n(uX);for(gV=AI.next();!gV.done;gV=AI.next())lX=gV.value,az=g.$y(lX.key).entityId,(p=D.get(az))&&lX&&(p.offlineModeType=lX.offlineModeType);case 7:Jr=[];Ht=g.n(L);for(wT=Ht.next();!wT.done;wT=Ht.next())HZ=wT.value,sz=g.$y(HZ.key).entityId,Ml=ZC(HZ),sz!==O&&Ml.rootActionId!==O||NG(J,HZ.actionProto)||
Jr.push(HZ.key);ZZ=g.Hq(O,"mainPlaylistEntity");return v.K(rm(V,{mode:"readwrite",cY:!0},function(E){var d=Jr.map(function(Hh){return tL(E,Hh)});
d.push(tL(E,ZZ,{WQ:!0}));return g.WH.all(d)}),10);
case 10:if(!c){v.uw(0);break}k.reverse();if(!k){v.uw(0);break}Mk=g.n(k);f=Mk.next();case 13:if(f.done){v.uw(0);break}a=f.value;return v.K(Ta(a,V,J,y,D.get(a)),14);case 14:f=Mk.next(),v.uw(13)}})},dqd=function(O,V,J,y){var l,m,H,F,N,x,W,U,Z;
return g.Q(function(z){if(z.j==1)return l=g.Hq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),m=new Map,z.K(rm(O,{mode:"readwrite",cY:!0},function(c){var Y=QM(c,"transfer"),b=QM(c,"offlineOrchestrationActionWrapperEntity"),M=QM(c,"videoDownloadContextEntity"),w=qr(c,l,"mainDownloadsListEntity");return g.WH.all([Y,b,M,w]).then(function(L){L=g.n(L);var X=L.next().value;var u=L.next().value;var G=L.next().value;var k=L.next().value;L=E9D.map(function(Oo){return waC(c,Oo)});
u=g.n(u);for(var D=u.next();!D.done;D=u.next())D=D.value,NG(V,D.actionProto)||L.push(tL(c,D.key,{WQ:!0}));k&&(k.downloads=[],L.push(Kw(c,k,"mainDownloadsListEntity")));if(G)for(G=g.n(G),k=G.next();!k.done;k=G.next())k=k.value,u=g.$y(k.key).entityId,u=g.Hq(u,"transfer"),m.set(u,k.offlineModeType);return g.WH.all(L).then(function(){return X})})}),2);
H=z.U;F=g.n(H);for(N=F.next();!N.done;N=F.next())x=N.value,xw(x,m.get(x.key)),W=g.$y(x.key).entityId,U={videoId:W,offlineDeleteReason:y,cotn:x.cotn,offlineModeType:m.get(x.key)},lq(U),Z=g.Hq(W,"mainVideoEntity"),Jv(J,{entityKey:Z,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return z.K(wG1(),0)})},LUV=function(O,V){var J=[];
if(O.thumbnailStyleData){O=g.n(O.thumbnailStyleData);for(var y=O.next();!y.done;y=O.next()){var l=void 0,m=void 0,H=void 0;J=J.concat(W1((l=y.value)==null?void 0:(m=l.value)==null?void 0:(H=m.collageThumbnail)==null?void 0:H.coverThumbnail))}}V=W1(V);return J.concat(V)},n9z=function(O,V,J){var y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo;
return g.Q(function(md){y=[];l=new Set;if(J.length)for(m=g.n(J),H=m.next();!H.done;H=m.next())if(F=H.value,N=void 0,(N=F.downloads)==null?0:N.length)for(x=g.n(F.downloads),W=x.next();!W.done;W=x.next())U=W.value,U.videoItem&&(Z=g.$y(U.videoItem).entityId,l.add(Z));if(O.videos){z=g.n(O.videos);for(c=z.next();!c.done;c=z.next())Y=c.value,b=JSON.parse(g.$y(Y).entityId),b.videoId&&!l.has(b.videoId)&&y.push(b.videoId);M=g.n(V);for(w=M.next();!w.done;w=M.next())if(L=w.value,L.key!==O.key&&(X=L.videos))for(u=
g.n(X),G=u.next();!G.done;G=u.next())k=G.value,D=JSON.parse(g.$y(k).entityId),D.videoId&&(Oo=y.indexOf(D.videoId),Oo!==-1&&y.splice(Oo,1))}return md.return(y)})},MIm=function(O,V){var J,y,l,m,H,F,N,x;
return g.Q(function(W){J=W1(O.avatar);y=g.n(V);for(l=y.next();!l.done;l=y.next())if(m=l.value,m.id!==O.id)for(H=g.n(W1(m.avatar)),F=H.next();!F.done;F=H.next())N=F.value,x=J.indexOf(N),x!==-1&&J.splice(x,1);return W.return(J)})},g9I=function(O){var V;
return g.Q(function(J){V=g.e(O.frameworkUpdates,eb);return O.frameworkUpdates&&V?J.K(u3m(V),0):J.return()})},GpD=function(O){var V;
if((V=O.onResponseReceivedActions)!=null&&V.length){var J;O=(J=g.e(g.e(O.onResponseReceivedActions[0],qWF),Q_1))==null?void 0:J.actions;if(O!=null&&O.length)return O}},KUz=function(O){var V,J,y;
return g.Q(function(l){if(l.j==1)return O?l.K(RA(O,Iv,"mainDownloadsListEntity"),2):l.return([]);V=l.U;return((J=V)==null?0:(y=J.downloads)==null?0:y.length)?l.return(V.downloads.map(function(m){var H;return(H=m.videoItem)!=null?H:""})):l.return([])})},uuD=function(O,V){var J;
return g.Q(function(y){return y.j==1?y.K(tId(O,V),2):(J=y.U)?y.K(rm(O,{mode:"readwrite",cY:!0},function(l){var m=[Kw(l,J.mainDownloadsLibraryEntity,"mainDownloadsLibraryEntity")];J.mainDownloadsListEntity&&m.push(Kw(l,J.mainDownloadsListEntity,"mainDownloadsListEntity"));return g.WH.all(m)}),0):y.uw(0)})},tId=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L;
return g.Q(function(X){if(X.j==1)return J=g.Hq("main_downloads_library_id","mainDownloadsLibraryEntity"),y=g.Hq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),X.K(rm(O,{mode:"readonly",cY:!0},function(u){return g.WH.all([qr(u,J,"mainDownloadsLibraryEntity"),qr(u,y,"mainDownloadsListEntity")])}),2);
l=X.U;m=g.n(l);H=m.next().value;F=m.next().value;N=H;x=F;N||(N={id:J});W=g.n(V);for(U=W.next();!U.done;U=W.next())if(Z=U.value,Z===Iv){if(N.smartDownloadsList)return X.return();N.smartDownloadsList=Z}else if(z=g.$y(Z).entityType,c={},z==="mainPlaylistEntity"?c.playlistItem=Z:z==="mainVideoEntity"&&(c.videoItem=Z),!g.Id(c)){Y=void 0;if((Y=x)==null?0:Y.downloads){b=!1;M=g.n(x.downloads);for(w=M.next();!w.done;w=M.next())if(L=w.value,L.playlistItem===Z||L.videoItem===Z){b=!0;break}b||x.downloads.push(c)}else x=
{id:y,downloads:[c]};N.downloadsList=y}return X.return({mainDownloadsLibraryEntity:N,mainDownloadsListEntity:x})})},ABD=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b;
return g.Q(function(M){if(M.j==1)return J=g.Hq("main_downloads_library_id","mainDownloadsLibraryEntity"),y=g.Hq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity"),M.K(rm(O,{mode:"readonly",cY:!0},function(w){return g.WH.all([qr(w,J,"mainDownloadsLibraryEntity"),qr(w,y,"mainDownloadsListEntity"),qr(w,Iv,"mainDownloadsListEntity")])}),2);
l=M.U;m=g.n(l);H=m.next().value;F=m.next().value;N=m.next().value;x=H;W=F;U=N;if(!x)return M.uw(0);if(V===Iv&&((Z=U)==null?0:Z.downloads))U.downloads=[];else if((z=W)==null?0:z.downloads)for(c=g.$y(V).entityType,Y=0;Y<W.downloads.length;Y++)if(b=W.downloads[Y],c==="mainVideoEntity"&&b.videoItem===V){W.downloads.splice(Y,1);break}else if(c==="mainPlaylistEntity"&&b.playlistItem===V){W.downloads.splice(Y,1);break}return M.K(rm(O,{mode:"readwrite",cY:!0},function(w){var L=[Kw(w,x,"mainDownloadsLibraryEntity")];
W&&L.push(Kw(w,W,"mainDownloadsListEntity"));U&&L.push(Kw(w,U,"mainDownloadsListEntity"));return g.WH.all(L)}),0)})},Yw=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z;
return g.Q(function(z){if(z.j==1)return J=g.Hq(V,"transfer"),y=g.Hq(V,"videoDownloadContextEntity"),z.K(rm(O,{mode:"readonly",cY:!0},function(c){return g.WH.all([qr(c,J,"transfer"),qr(c,y,"videoDownloadContextEntity")])}),2);
l=z.U;m=g.n(l);H=m.next().value;F=m.next().value;N=H;x=F;Z={videoId:V,cotn:(W=N)==null?void 0:W.cotn,offlineModeType:(U=x)==null?void 0:U.offlineModeType};return z.return(Z)})},av=function(O,V,J,y,l){var m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D;
return g.Q(function(Oo){switch(Oo.j){case 1:return m=g.Hq(O,"musicTrack"),H=g.Hq(O,"transfer"),Oo.K(rm(V,{mode:"readonly",cY:!0},function(md){return g.WH.all([qr(md,m,"musicTrack"),qr(md,H,"transfer"),QM(md,"musicTrack"),QM(md,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:F=Oo.U;N=g.n(F);x=N.next().value;W=N.next().value;U=N.next().value;Z=N.next().value;z=x;c=W;Y=U;b=Z;if(!z){Oo.uw(3);break}return Oo.K(rBV(z,Y),4);case 4:return M=Oo.U,Oo.K(c1(M),3);case 3:w=[];L=g.n(b);for(X=L.next();!X.done;X=L.next())u=X.value,G=g.$y(u.key).entityId,k=ZC(u),D=g.$y(k.action.entityKey).entityId,G!==O&&D!==O||NG(J,u.actionProto)||w.push(u.key);return Oo.K(rm(V,{mode:"readwrite",cY:!0},function(md){var xY=w.map(function(V7){return tL(md,V7)});
xY.push(tL(md,m,{WQ:!0}));return g.WH.all(xY)}),6);
case 6:xw(c),l&&lq(l),Jv(y,{entityKey:m,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"}),Oo.V()}})},bq=function(O,V,J,y,l){var m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo,md,xY,V7,Tr,Rp,ys,JI,uX,nn,im,fd,h,X1,AI,gV;
return g.Q(function(lX){switch(lX.j){case 1:return m=g.Hq(O,V),H=g.Hq("music_downloads_library_id","musicDownloadsLibraryEntity"),lX.K(rm(J,{mode:"readonly",cY:!0},function(az){return g.WH.all([qr(az,m,V),qr(az,H,"musicDownloadsLibraryEntity"),QM(az,V),QM(az,"offlineOrchestrationActionWrapperEntity")])}),2);
case 2:F=lX.U;N=g.n(F);x=N.next().value;W=N.next().value;U=N.next().value;Z=N.next().value;z=x;c=W;Y=U;b=Z;if(!z){lX.uw(3);break}return lX.K(rBV(z,Y),4);case 4:return M=lX.U,lX.K(c1(M),3);case 3:w=[];L=new Map;if(!z){lX.uw(6);break}return lX.K(iqd(z,Y,c),7);case 7:w=lX.U;X=g.n(w);for(u=X.next();!u.done;u=X.next())G=u.value,k=g.$y(G).entityId,L.set(k,{videoId:k,playlistId:O,offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});return lX.K(Br(J,"transfer"),8);case 8:for(D=lX.U,Oo=g.n(D),
md=Oo.next();!md.done;md=Oo.next())xY=md.value,V7=g.$y(xY.key).entityId,(Tr=L.get(V7))&&xY&&(Tr.cotn=xY.cotn);case 6:Rp=[];ys=g.n(b);for(JI=ys.next();!JI.done;JI=ys.next())uX=JI.value,nn=g.$y(uX.key).entityId,im=ZC(uX),nn!==O&&im.rootActionId!==O||NG(y,uX.actionProto)||Rp.push(uX.key);fd=g.Hq(O,V);return lX.K(rm(J,{mode:"readwrite",cY:!0},function(az){var p=Rp.map(function(Jr){return tL(az,Jr)});
p.push(tL(az,fd,{WQ:!0}));return g.WH.all(p)}),9);
case 9:if(!z){lX.uw(0);break}w.reverse();if(!w.length){lX.uw(0);break}h=g.n(w);X1=h.next();case 12:if(X1.done){lX.uw(0);break}AI=X1.value;gV=g.$y(AI).entityId;if(!gV){lX.uw(13);break}return lX.K(av(gV,J,y,l,L.get(gV)),13);case 13:X1=h.next(),lX.uw(12)}})},pQ=function(O,V,J){var y,l,m,H,F,N,x;
return g.Q(function(W){if(W.j==1)return W.K(rm(O,{mode:"readwrite",cY:!0},function(U){var Z=QM(U,"transfer"),z=QM(U,"offlineOrchestrationActionWrapperEntity");return g.WH.all([Z,z]).then(function(c){c=g.n(c);var Y=c.next().value;var b=c.next().value;c=RLd.map(function(X){return waC(U,X)});
b=g.n(b);for(var M=b.next();!M.done;M=b.next()){M=M.value;var w=g.$y(M.actionProto.entityKey).entityType==="musicTrack",L=M.actionProto.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD";NG(V,M.actionProto)||w&&(!w||L)||c.push(tL(U,M.key,{WQ:!0}))}return g.WH.all(c).then(function(){return Y})})}),2);
y=W.U;l=g.n(y);for(m=l.next();!m.done;m=l.next())H=m.value,xw(H),F=g.$y(H.key).entityId,N={videoId:F,offlineDeleteReason:void 0,cotn:H.cotn},lq(N),x=g.Hq(F,"musicTrack"),Jv(J,{entityKey:x,failureReason:"OFFLINE_OPERATION_FAILURE_REASON_VIDEO_DELETED"});return W.K(wG1(),0)})},BqV=function(O){for(var V,J=g.n(O.additionalMetadatas),y=J.next();!y.done;y=J.next())y=y.value,y.offlineMusicVideoData&&(V=y.offlineMusicVideoData);
var l,m,H,F,N;return{id:g.Hq(O.videoId,"musicTrack"),videoId:O.videoId,title:O.title,thumbnailDetails:O.thumbnail,lengthMs:String(Number(O.lengthSeconds)*1E3),albumTitle:(l=V)==null?void 0:l.releaseTitle,musicVideoType:(m=V)==null?void 0:m.musicVideoType,contentRating:{explicitType:(H=V)==null?void 0:H.explicitType},artistNames:((F=V)==null?void 0:F.byline)||((N=V)==null?void 0:N.channelName),downloadMetadata:g.Hq(O.videoId,"musicTrackDownloadMetadataEntity")}},iqd=function(O,V,J){var y,l,m,H,F,N,
x,W,U,Z,z,c,Y,b,M,w,L,X;
return g.Q(function(u){y=[];l=new Set;if((m=J)==null?0:(H=m.downloadedTracks)==null?0:H.length)for(F=g.n(J.downloadedTracks),N=F.next();!N.done;N=F.next())x=N.value,l.add(x);if(O.tracks){W=g.n(O.tracks);for(U=W.next();!U.done;U=W.next())Z=U.value,l.has(Z)||y.push(Z);z=g.n(V);for(c=z.next();!c.done;c=z.next())if(Y=c.value,Y.id!==O.id&&(b=Y.tracks))for(M=g.n(b),w=M.next();!w.done;w=M.next())L=w.value,X=y.indexOf(L),X!==-1&&y.splice(X,1)}return u.return(y)})},rBV=function(O,V){var J,y,l,m,H,F,N,x;
return g.Q(function(W){J=W1(O.thumbnailDetails);y=g.n(V);for(l=y.next();!l.done;l=y.next())if(m=l.value,m.id!==O.id)for(H=g.n(W1(m.thumbnailDetails)),F=H.next();!F.done;F=H.next())N=F.value,x=J.indexOf(N),x!==-1&&J.splice(x,1);return W.return(J)})},PTm=function(O,V){var J,y,l,m,H,F,N,x,W;
return g.Q(function(U){if(U.j==1)return J=g.Hq("music_downloads_library_id","musicDownloadsLibraryEntity"),U.K(RA(O,J,"musicDownloadsLibraryEntity"),2);(y=U.U)||(y={id:J});l=g.$y(V).entityType;l==="musicTrack"?(m=y.downloadedTracks)!=null&&m.includes(V)||(y.downloadedTracks=((H=y.downloadedTracks)!=null?H:[]).concat(V)):l==="musicPlaylist"?(F=y.downloadedPlaylists)!=null&&F.includes(V)||(y.downloadedPlaylists=((N=y.downloadedPlaylists)!=null?N:[]).concat(V)):l!=="musicAlbumRelease"||(x=y.downloadedAlbumReleases)!=
null&&x.includes(V)||(y.downloadedAlbumReleases=((W=y.downloadedAlbumReleases)!=null?W:[]).concat(V));return U.K(ix(O,y,"musicDownloadsLibraryEntity"),0)})},kpW=function(O,V){var J,y,l,m,H,F,N;
return g.Q(function(x){if(x.j==1)return J=g.Hq("music_downloads_library_id","musicDownloadsLibraryEntity"),x.K(RA(O,J,"musicDownloadsLibraryEntity"),2);y=x.U;if(!y)return x.uw(0);l=g.$y(V).entityType;l==="musicTrack"?m=y.downloadedTracks:l==="musicPlaylist"&&(m=y.downloadedPlaylists);if((H=m)==null?0:H.length)for(F=0;F<m.length;F++)if(N=m[F],N===V){m.splice(F,1);break}return x.K(ix(O,y,"musicDownloadsLibraryEntity"),0)})},SWz=function(O){var V=O.videos;
O=[];var J=[];if(V){V=g.n(V);for(var y=V.next();!y.done;y=V.next()){var l=y.value.offlineVideoData.videoId;y=g.Hq(l,"musicTrack");l=g.Hq(l,"musicTrackDownloadMetadataEntity");O.push(y);J.push(l)}}return{TJ:O,Nm:J}},fQ=function(O,V,J){V={track:BqV(V)};
J&&(V.playlistId=J);if(O=g.e(O.actionMetadata,Dqz))V.maximumDownloadQuality=O.maximumDownloadQuality;return{musicTrackEntityActionMetadata:V}},VTz=function(O){var V,J,y,l,m,H,F,N;
return g.Q(function(x){switch(x.j){case 1:return V=g.B7(),J=S6F(O),y=g.u1(O3y),x.W(2),m={lY:!0},x.K(g.fU(V,J,y,void 0,m),4);case 4:l=x.U;x.S(3);break;case 2:H=x.D();if(H instanceof g.GJ)throw F="GetOffline network manager error: "+H.message,OY(F,H),Error(F);OY("GetOffline fetch request error",H);throw Error("GetOffline fetch request error");case 3:N=hv(l);if(!l)throw OY("Network request failed"),Error("Network request failed");if(N!==void 0)ov(N);else if(!l.videos||!l.videos.length)throw OY("No data"),
Error("No data");return x.return(l.videos.map(function(W){return W.offlineVideoData}))}})},JFn=function(O){var V,J,y,l,m,H,F,N;
return g.Q(function(x){switch(x.j){case 1:return V=g.B7(),J=D$V(O),y=g.u1(O3y),x.W(2),m={lY:!0},x.K(g.fU(V,J,y,void 0,m),4);case 4:l=x.U;x.S(3);break;case 2:H=x.D();if(H instanceof g.GJ)throw F="GetOffline network manager error for playlist: "+H.message,OY(F,H),Error(F);OY("GetOffline fetch request error for playlist",H);throw Error("GetOffline fetch request error for playlist");case 3:N=hv(l);if(!l)throw OY("Network request failed for playlist"),Error("Network request failed for playlist");if(N!==
void 0)ov(N,"playlist");else if(!l.playlists||!l.playlists.length)throw OY("No data for playlist"),Error("No data for playlist");return x.return(l.playlists.map(function(W){return W.offlinePlaylistData}))}})},lWd=function(O,V,J,y){var l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo,md,xY,V7,Tr,Rp,ys,JI,uX;
return g.Q(function(nn){switch(nn.j){case 1:return nn.K(Pr(),2);case 2:l=nn.U;if(!l)return nn.return([]);m=[];if((H=y)==null?0:H.length){m=y;nn.uw(3);break}return nn.K(Br(l,"mainPlaylistEntity"),4);case 4:m=nn.U;case 3:if(!m.length)return nn.return([]);F=[];N=Date.now()/1E3;x=g.n(m);W=x.next();case 5:if(W.done)return F.length?nn.K(yFn(F),10):nn.return([]);U=W.value;if(!U.downloadState){Z=void 0;nn.uw(8);break}return nn.K(RA(l,U.downloadState,"mainPlaylistDownloadStateEntity"),9);case 9:Z=nn.U;case 8:z=
Z;c=void 0;b=(Y=(c=U)==null?void 0:c.entityMetadata)&&Y.nextAutoRefreshIntervalSeconds?Number(Y.nextAutoRefreshIntervalSeconds):NaN;M=Number.isNaN(b)?O:b;L=w=void 0;X=((w=z)==null?0:w.lastSyncedTimestampMillis)?Number((L=z)==null?void 0:L.lastSyncedTimestampMillis)/1E3:0;G=u=void 0;k=((u=z)==null?0:u.addedTimestampMillis)?Number((G=z)==null?void 0:G.addedTimestampMillis)/1E3:0;if(J||!Y||X+M<=N){D=[];Oo=void 0;if((Oo=U.videos)==null?0:Oo.length)for(md=g.n(U.videos),xY=md.next();!xY.done;xY=md.next())V7=
xY.value,Tr=JSON.parse(g.$y(V7).entityId),Tr.videoId&&D.push(Tr.videoId);Rp="0";Y&&(ys=void 0,Rp=String(Number((ys=Y.offlineLastModifiedTimestampSeconds)!=null?ys:0).toFixed()));JI={playlistId:U.playlistId,videoIds:D,offlineLastModifiedTimestamp:Rp,autoSync:V,offlineDateAddedTimestamp:String(k.toFixed())};F.push(JI)}W=x.next();nn.uw(5);break;case 10:return uX=nn.U,nn.return(uX)}})},mUz=function(){var O,V,J,y,l;
return g.Q(function(m){if(m.j==1)return m.K(Pr(),2);if(m.j!=3)return(O=m.U)?m.K(Br(O,"refresh"),3):m.return(!1);V=m.U;if((J=V[0])==null||!J.refreshTime)return m.return(!1);y=Number(V[0].refreshTime);l=Date.now()/1E3;return m.return(isFinite(y)&&l>=y)})},H3z=function(O,V){var J,y,l;
return g.Q(function(m){switch(m.j){case 1:return m.W(2),m.K($Uy(O,V),4);case 4:return y=m.U,m.K(g9I(y),5);case 5:J=GpD(y);m.S(3);break;case 2:l=m.D(),OY("getAndProcessSmartDownloadsResponse request or processing error",l);case 3:return m.return(J)}})},j8E=function(O,V,J,y){var l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo,md,xY,V7,Tr,Rp,ys,JI,uX;
return g.Q(function(nn){switch(nn.j){case 1:return nn.K(Pr(),2);case 2:l=nn.U;if(!l)return nn.return([]);m=[];if((H=y)==null?0:H.length){m=y;nn.uw(3);break}return nn.K(Br(l,"musicPlaylist"),4);case 4:m=nn.U;case 3:if(!m.length)return nn.return([]);F=[];N=Date.now()/1E3;x=g.n(m);W=x.next();case 5:if(W.done)return F.length?nn.K(yFn(F),10):nn.return([]);U=W.value;Z=void 0;c=(z=(Z=U)==null?void 0:Z.entityMetadata)&&z.nextAutoRefreshIntervalSeconds?Number(z.nextAutoRefreshIntervalSeconds):NaN;Y=Number.isNaN(c)?
O:c;M=b=0;w="DOWNLOAD_SYNC_STATE_UNKNOWN";if(!U.downloadMetadata){nn.uw(8);break}return nn.K(RA(l,U.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),9);case 9:L=nn.U,u=X=void 0,b=Number((u=(X=L)==null?void 0:X.addedTimestampMillis)!=null?u:"0")/1E3,k=G=void 0,M=Number((k=(G=L)==null?void 0:G.lastModifiedTimestampMillis)!=null?k:"0")/1E3,Oo=D=void 0,w=(Oo=(D=L)==null?void 0:D.syncState)!=null?Oo:"DOWNLOAD_SYNC_STATE_UNKNOWN";case 8:md=void 0;if(J||w!=="DOWNLOAD_SYNC_STATE_UP_TO_DATE"||!z||Number((md=
z.lastSyncedTimestampSeconds)!=null?md:0)+Y<=N){xY=[];V7=void 0;if((V7=U.tracks)==null?0:V7.length)for(Tr=g.n(U.tracks),Rp=Tr.next();!Rp.done;Rp=Tr.next())ys=Rp.value,xY.push(g.$y(ys).entityId);JI={playlistId:U.playlistId,videoIds:xY,offlineLastModifiedTimestamp:String(M.toFixed()),autoSync:V,offlineDateAddedTimestamp:String(b.toFixed())};F.push(JI)}W=x.next();nn.uw(5);break;case 10:return uX=nn.U,nn.return(uX)}})},$Uy=function(O,V){var J,y,l,m,H,F,N,x,W,U;
return g.Q(function(Z){switch(Z.j){case 1:return J=g.B7(),Z.K(Pr(),2);case 2:y=Z.U;if(!y){Z.uw(3);break}return Z.K($qF(y),4);case 4:l=Z.U;case 3:var z=l;m={context:g.GE(),browseId:"FEdownloads",browseRequestSupportedMetadata:{downloadsBrowseParams:{offlineFeatureSettingState:{isSdEnabled:O},offlineClientState:z,clientStateRequestData:{preferredFormatType:V}}}};H=g.u1(CFn);Z.W(5);N={lY:!0};return Z.K(g.fU(J,m,H,void 0,N),7);case 7:F=Z.U;Z.S(6);break;case 5:x=Z.D();if(x instanceof g.GJ)throw W="DPS network manager error for smart downloads: "+
x.message,OY(W,x),Error(W);OY("DPS fetch request error for smart downloads",x);throw Error("DPS fetch request error for smart downloads");case 6:U=hv(F);if(F)U!==void 0&&ov(U,"smart downloads");else throw OY("Network request failed for smart downloads"),Error("Network request failed for smart downloads");return Z.return(F)}})},N4z=function(O,V){var J,y,l,m,H,F,N,x;
return g.Q(function(W){switch(W.j){case 1:return J=g.B7(),y={context:g.GE(),videoPlaybackPositionEntities:O,lastSyncTimestampUsec:V},l=g.u1(FSE),W.W(2),H={lY:!0},W.K(g.fU(J,y,l,void 0,H),4);case 4:m=W.U;W.S(3);break;case 2:F=W.D();if(F instanceof g.GJ)throw N="VPPS network manager error: "+F.message,OY(N,F),Error(N);OY("VPPS fetch request error",F);throw Error("VPPS fetch request error");case 3:x=hv(m);if(m)x!==void 0&&ov(x,"position sync");else throw OY("Network request failed for position sync"),
Error("Network request failed for position sync");return W.return(m)}})},WSz=function(O,V,J){var y,l,m,H,F,N,x,W;
return g.Q(function(U){switch(U.j){case 1:y=g.B7();var Z=J.refreshData,z=J.isEnqueuedForExpiredStreamUrlRefetch,c=J.wQ,Y=J.offlineSourceData,b=J.mediaCapabilities,M={entityKey:O};Z&&(M.refreshData=Z);z&&(M.isExpiredStreamUrlRefetch=z);c&&(M.downloadParameters=c);Y&&(M.offlineSourceData=Y);Z={context:g.eu(V),signatureTimestamp:20480,videos:[M]};b&&(Z.mediaCapabilities=b);l=Z;m=g.u1(xUs);U.W(2);F={lY:!0};return U.K(g.fU(y,l,m,void 0,F),4);case 4:H=U.U;U.S(3);break;case 2:N=U.D();if(N instanceof g.GJ)throw x=
"GetPDE network manager error: "+N.message,OY(x,N),Error(x);OY("GetPDE fetch request error",N);throw Error("GetPDE fetch request error");case 3:W=hv(H);if(H)W!==void 0&&ov(W,"PDE");else throw OY("Network request failed for PDE"),Error("Network request failed for PDE");return U.return(H)}})},hv=function(O){var V;
return(V=O.errorMetadata)==null?void 0:V.status},ov=function(O,V){V=V?" for "+V:"";
if(O===0)throw O="Empty response body"+V,OY(O),Error(O);O="Response with error"+V;OY(O);throw Error(O);},yFn=function(O){var V,J,y,l,m,H,F,N;
return g.Q(function(x){switch(x.j){case 1:return V=g.B7(),J=Oqm(O),y=g.u1(UUD),x.W(2),m={lY:!0},x.K(g.fU(V,J,y,void 0,m),4);case 4:l=x.U;x.S(3);break;case 2:H=x.D();if(H instanceof g.GJ)throw F="offlinePlaylistSyncCheck network manager error: "+H.message,OY(F,H),Error(F);OY("offlinePlaylistSyncCheck fetch request error",H);throw Error("offlinePlaylistSyncCheck fetch request error");case 3:N=hv(l);if(!l)throw OY("Network request failed for playlist sync"),Error("Network request failed for playlist sync");
if(N!==void 0)ov(N,"playlist sync");else if(!l.offlinePlaylistSyncCheckDatas||!l.offlinePlaylistSyncCheckDatas.length)throw OY("No data for playlist sync"),Error("No data for playlist sync");return x.return(l.offlinePlaylistSyncCheckDatas.map(function(W){return W.offlinePlaylistSyncCheckData}))}})},v1=function(O){this.K=O},Z3I=function(O,V){var J,y,l,m,H,F;
return g.Q(function(N){switch(N.j){case 1:J=new Map,y=g.n(V),l=y.next();case 2:if(l.done){N.uw(4);break}m=l.value;H=J;F=H.set;return N.K(O.j(m),5);case 5:F.call(H,m,N.U);l=y.next();N.uw(2);break;case 4:return N.return(J)}})},wK=function(O,V,J,y,l,m){V=g.Hq(V,J);
y=Object.assign({},m,{priority:y,retryScheduleIntervalsInSeconds:l});return{actionType:O,entityKey:V,actionMetadata:y}},MG=function(O,V,J,y,l,m){this.status=O;
this.K=V;this.D=J;this.j=y;this.U=l;this.downloadState=m},zhI=function(O,V,J){this.K=O;
this.B=V;this.U=J},T4E=function(O,V){var J,y,l,m,H,F,N,x,W;
return g.Q(function(U){switch(U.j){case 1:return J=V.entityKey,l=(y=g.e(V.actionMetadata,LQ))==null?void 0:y.isEnqueuedForExpiredStreamUrlRefetch,U.W(2),m=void 0,U.K(cFn(O,V),4);case 4:m=U.U;U.W(5);var Z=(Z=g.e(V.actionMetadata,LQ))?{maximumDownloadQuality:Z.maximumDownloadQuality}:void 0;return U.K(WSz(J,O.B,{isEnqueuedForExpiredStreamUrlRefetch:l,wQ:Z,offlineSourceData:m}),7);case 7:H=U.U;U.S(6,2);break;case 5:return U.D(2),F=$w(V)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":
"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",OY("PDE handleAdd error"),U.return(nQ(V,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",F,"DOWNLOAD_STATE_FAILED"));case 6:return U.K(s8V(O,H,V),8);case 8:return U.return(nQ(V,!0,H.orchestrationActions));case 2:return N=U.D(),x="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",W="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",N instanceof g.$P&&N.type==="QUOTA_EXCEEDED"&&(x="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
W="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),OY("PDE handleAdd error"),U.return(nQ(V,!1,void 0,x,W,"DOWNLOAD_STATE_FAILED"))}})},YTF=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo;
return g.Q(function(md){switch(md.j){case 1:return J=V.entityKey,y=g.$y(J).entityId,md.K(rm(O.K,{mode:"readonly",cY:!0},function(xY){var V7=qr(xY,J,"playbackData"),Tr=qr(xY,g.Hq(y,"offlineVideoPolicy"),"offlineVideoPolicy");xY=qr(xY,g.Hq(y,"transfer"),"transfer");return g.WH.all([V7,Tr,xY])}),2);
case 2:l=md.U;m=g.n(l);H=m.next().value;F=m.next().value;N=m.next().value;x=H;W=F;U=N;if(!x||!W)return md.return(nQ(V,!0));Z=[];Y=((c=x)==null?0:c.playerResponseJson)?JSON.parse(x.playerResponseJson):null;if(!U||!Y){md.uw(3);break}z=ehW(O,Y,U);return md.K(IW1(O,U),4);case 4:Z=md.U;case 3:b={lastPlayerResponseTimestampSeconds:x.playerResponseTimestamp,offlineToken:W.offlineToken,formatIds:Z};M={};if((w=U)==null?0:w.maximumDownloadQuality)M.maximumDownloadQuality=U.maximumDownloadQuality;md.W(5);L=
void 0;return md.K(cFn(O,V),7);case 7:return L=md.U,md.W(8),md.K(WSz(J,O.B,{refreshData:b,wQ:M,offlineSourceData:L,mediaCapabilities:z}),10);case 10:X=md.U;md.S(9,5);break;case 8:return md.D(5),u=$w(V)?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR",OY("PDE handleRefresh error"),md.return(nQ(V,!1,void 0,"OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED",u,"DOWNLOAD_STATE_FAILED"));case 9:return md.K(s8V(O,X,
V),11);case 11:return md.return(nQ(V,!0,X.orchestrationActions));case 5:return G=md.D(),k="PDE handleRefresh error",G instanceof Error&&(k="PDE handleRefresh error: "+G.message),D="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",Oo="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",G instanceof g.$P&&G.type==="QUOTA_EXCEEDED"&&(D="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",Oo="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),OY(k),md.return(nQ(V,!1,void 0,D,Oo,"DOWNLOAD_STATE_FAILED"))}})},
cFn=function(O,V){var J,y,l,m;
return g.Q(function(H){if(H.j==1)return J=g.$y(V.entityKey).entityId,y=g.Hq(J,"videoDownloadContextEntity"),H.K(RA(O.K,y,"videoDownloadContextEntity"),2);l=H.U;return(m=l)!=null&&m.offlineModeType?H.return({offlineModeType:l.offlineModeType}):H.return(void 0)})},s8V=function(O,V,J){var y,l,m,H,F;
return g.Q(function(N){if(N.j==1){if(!V.frameworkUpdates||!g.e(V.frameworkUpdates,eb))return N.return();if(!(g.e(V.frameworkUpdates,eb).mutations&&g.e(V.frameworkUpdates,eb).mutations.length>0&&g.e(V.frameworkUpdates,eb).mutations[0].type==="ENTITY_MUTATION_TYPE_DELETE"))return N.uw(2);y=g.$y(g.e(V.frameworkUpdates,eb).mutations[0].entityKey).entityId;return N.K(Yw(O.K,y),3)}if(N.j!=2){l=N.U;m=g.e(J.actionMetadata,LQ);if(F=(H=m)==null?void 0:H.playlistId)l.playlistId=F;l.offlineDeleteReason="OFFLINE_DELETE_REASON_UNKNOWN";
return g.ZG(O.B)?N.K(Ta(y,O.K,J,O.U,l),2):g.pJ(O.B)?N.K(av(y,O.K,J,O.U),2):N.uw(2)}return N.K(u3m(g.e(V.frameworkUpdates,eb)),0)})},nQ=function(O,V,J,y,l,m){return new MG(V?"OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS":"OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",$w(O),J,y,l,m)},ehW=function(O,V,J){V=o9s(O.B,J.cotn,V);
J=g.vL(V);return g.XKY(V,J,O.B)},IW1=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z;
return g.Q(function(z){if(z.j==1)return J=[],z.K(rm(O.K,{mode:"readonly",cY:!0},function(c){var Y=[],b=V.offlineVideoStreams;if(b){b=g.n(b);for(var M=b.next();!M.done;M=b.next())Y.push(qr(c,M.value,"offlineVideoStreams"))}return g.WH.all(Y)}),2);
if(y=z.U)for(l=g.n(y),m=l.next();!m.done;m=l.next())if(H=m.value,F=void 0,(F=H)==null?0:F.streamsProgress)for(N=H.streamsProgress,x=0;x<N.length;x++)W=N[x],U=JSON.parse(W.formatStreamBytes),Z={itag:U.itag,lmt:U.lastModified,xtags:U.xtags},J.push(Z);return z.return(J)})},aWV=function(O,V){this.K=O;
this.B=V},b3y=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z;
return g.Q(function(c){switch(c.j){case 1:return J=$w(V),c.K(Br(O.K,"videoPlaybackPositionEntity"),2);case 2:y=c.U;if(y.length===0)return c.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));c.W(3);return c.K(Xx.getInstance(),5);case 5:l=c.U;if(!l)throw Error("prefStorage is undefined");return c.K(l.get("psi"),6);case 6:return m=c.U,N=(F=(H=m)==null?void 0:H.y7)!=null?F:"0",c.K(N4z(y,N),7);case 7:return x=c.U,W={isPaused:x.watchHistoryPaused,y7:x.syncTimestampUsec},c.K(l.set("psi",W),
8);case 8:if(W.isPaused){c.uw(9);break}U=g.e(x.frameworkUpdates,eb);if(!x.frameworkUpdates||!U){c.uw(9);break}return c.K(u3m(U),9);case 9:c.S(4);break;case 3:return Z=c.D(),z="PPE handleRefresh error: "+(Z instanceof Error?Z.message:"unknown error"),OY(z),c.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return c.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},fWy=function(O,V){var J,y,l,m,H,F,N,x;
return g.Q(function(W){switch(W.j){case 1:return J=$w(V),y=g.$y(V.entityKey).entityId,W.W(2),W.K(Xx.getInstance(),4);case 4:l=W.U;if(!l)throw Error("prefStorage is undefined");return W.K(l.get("psi"),5);case 5:m=W.U;H=g.e(V.actionMetadata,pus);if(((F=m)==null?void 0:F.isPaused)!==!1||(N=H)==null||!N.lastPlaybackPositionSeconds){W.uw(6);break}x={key:g.Hq(y,"videoPlaybackPositionEntity"),videoId:y,lastPlaybackPositionSeconds:H.lastPlaybackPositionSeconds};return W.K(ix(O.K,x,"videoPlaybackPositionEntity"),
6);case 6:W.S(3);break;case 2:return W.D(),W.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return W.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J))}})},hhD=function(O,V){var J,y,l;
return g.Q(function(m){switch(m.j){case 1:J=$w(V);m.W(2);y=g.$y(V.entityKey).entityId;if(y==="!*$_ALL_ENTITIES_!*$")return m.K(q6m(O.K),5);l=g.Hq(y,"videoPlaybackPositionEntity");return m.K(gQz(O.K,l),5);case 5:m.S(3);break;case 2:return m.D(),m.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return m.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},oSz=function(O,V){this.api=O;
this.K=V;this.logger=new g.vK("woffle");this.j=!1;this.Ty={YK:this.YK}},vSd=function(O){return g.Q(function(V){return V.return(k7V(O))})},wum=function(O){var V;
return g.Q(function(J){if(J.j==1)return J.K(g.Amn(O),2);V=J.U;return J.return(V.filter(function(y){return!!y.url}).map(function(y){return y.url}))})},X8=function(O,V){var J=g.DG(V);
if(J===1||J===0)return Promise.resolve();(J=MTm(O,V))&&J.stopVideo();O.U=0;return vSd(V)},EY=function(O,V,J,y){J=J===void 0?!1:J;
y=y===void 0?!0:y;V=typeof V==="string"?V:V.videoDetails.videoId;if(g.DG(V)===2){var l=MTm(O,V);l&&l.stopVideo();g.Oy(V,2);O.U=2;J?LS1(O.K):y&&nSV(O.K)}},MTm=function(O,V){var J;
return((J=O.player)==null?void 0:J.getVideoData().videoId)===V?O.player:null},Xus=function(O,V){this.K=O;
this.B=V},dUV=function(O,V){var J,y;
return g.Q(function(l){switch(l.j){case 1:return J=$w(V),l.K(RA(O.K,V.entityKey,"transfer"),2);case 2:if(y=l.U)return l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));l.W(3);return l.K(ESs(O,V),5);case 5:l.S(4);break;case 3:return l.D(),l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},gSz=function(O,V){var J,y;
return g.Q(function(l){switch(l.j){case 1:return J=$w(V),l.K(RA(O.K,V.entityKey,"transfer"),2);case 2:y=l.U;if(!y||y.transferState!=="TRANSFER_STATE_COMPLETE")return l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));l.W(3);return l.K(ESs(O,V,!0),5);case 5:l.S(4);break;case 3:return l.D(),l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));
case 4:return l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J))}})},qTC=function(O,V){var J,y,l,m,H,F,N,x,W,U;
return g.Q(function(Z){switch(Z.j){case 1:return J=$w(V),y=g.$y(V.entityKey).entityId,Z.K(rm(O.K,{mode:"readonly",cY:!0},function(z){var c=qr(z,V.entityKey,"transfer");z=qr(z,g.Hq(y,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WH.all([c,z])}),2);
case 2:l=Z.U;m=g.n(l);H=m.next().value;F=m.next().value;N=H;x=F;if(!N||N.transferState!=="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH")return Z.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));Z.W(3);N.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE";return Z.K(ix(O.K,N,"transfer"),5);case 5:W=g.$y(N.key).entityId;YWz({videoId:W,r8:N,offlineModeType:(U=x)==null?void 0:U.offlineModeType});Z.S(4);break;case 3:return Z.D(),Z.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",
J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 4:return Z.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J))}})},ESs=function(O,V,J){J=J===void 0?!1:J;
var y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M;return g.Q(function(w){switch(w.j){case 1:return y=g.e(V.actionMetadata,Q8m),l=g.$y(V.entityKey).entityId,m=g.Hq(l,"downloadStatusEntity"),w.K(rm(O.K,{mode:"readonly",cY:!0},function(L){var X=qr(L,m,"downloadStatusEntity");L=qr(L,g.Hq(l,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WH.all([X,L])}),2);
case 2:return H=w.U,F=g.n(H),N=F.next().value,x=F.next().value,W=N,U=x,Z="TRANSFER_STATE_TRANSFER_IN_QUEUE",((z=W)==null?void 0:z.downloadState)==="DOWNLOAD_STATE_USER_DELETED"&&(Z="TRANSFER_STATE_PAUSED_BY_USER"),b={key:V.entityKey,transferState:Z,cotn:g.mR(16),enqueuedTimestampMs:Date.now().toString(),maximumDownloadQuality:(c=y)==null?void 0:c.maximumDownloadQuality,preferredAudioTrack:(Y=y)==null?void 0:Y.preferredAudioTrack,transferRetryCount:0,isRefresh:J,hasLoggedFirstStarted:!1},w.K(rm(O.K,
{mode:"readwrite",cY:!0},function(L){var X=[];J&&X.push(tL(L,g.Hq(l,"offlineVideoStreams")));X.push(Kw(L,b,"transfer"));return g.WH.all(X)}),3);
case 3:if(!J){w.uw(4);break}return w.K(vSd(l),4);case 4:eLz({videoId:l,r8:b,offlineModeType:(M=U)==null?void 0:M.offlineModeType}),w.V()}})},KS1=function(O,V,J,y){if(!O.action.entityKey)throw Error("entityKey is missing.");
var l=g.$y(O.action.entityKey);l={entityType:l.Ng,entityId:l.entityId,offlineOrchestrationActionType:O.action.actionType,orchestrationAction:{orchestrationActionId:O.actionId}};V&&(l.offlineOrchestrationActionResult=V.status,l.isRetryable=J?!1:V.K,V.U&&(l.offlineOrchestrationFailureReason=GFz(V.U,l.isRetryable)));var m,H;if((m=O.action.actionMetadata)==null?0:(H=m.offlineLoggingData)==null?0:H.offlineModeType)l.offlineModeType=O.action.actionMetadata.offlineLoggingData.offlineModeType;y&&(l.additionalOrchestrationActions=
y.map(function(F){return{orchestrationActionId:F.actionId}}));
return l},GFz=function(O,V){return O!=="OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR"||V?O==="OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"&&V?"OFFLINE_ORCHESTRATION_FAILURE_REASON_RECOVERABLE_NETWORK_ERROR":O:"OFFLINE_ORCHESTRATION_FAILURE_REASON_UNRECOVERABLE_NETWORK_ERROR"},tTz=function(O,V){var J={offlineOrchestrationContext:KS1(O)};
V=llV(V,J);mqE(yBs(),V,O.rootActionId)},ukz=function(O,V,J,y){y=y===void 0?[]:y;
V={offlineOrchestrationContext:KS1(O,V,J,y)};V=llV(3,V);mqE(yBs(),V,O.rootActionId)},AFn=function(){this.actions=[]},rFd=function(O,V){V=g.n(V);
for(var J=V.next();!J.done;J=V.next())J=J.value,tTz(J,1),O.actions.push(J);O.actions.sort(O.K)},i3n=function(O,V){if(V)for(var J=0;J<O.actions.length;J++)if(V==="!*$_ALL_ENTITIES_!*$"&&O.actions[J].actionId!==V||V!=="!*$_ALL_ENTITIES_!*$"&&O.actions[J].rootActionId===V&&O.actions[J].actionId!==V)O.actions.splice(J,1),J--},Rhy=function(O,V){O=g.n(O.actions);
for(var J=O.next();!J.done;J=O.next())if(J.value.actionId===V)return!0;return!1},dK=function(O,V,J,y,l){g.K.call(this);
var m=this;this.j=O;this.fD=V;this.KD=J;this.S=y;this.B=l;this.K=new AFn;this.V=new g.nO;this.U=new g.t_(function(){m.retry()});
this.T=NaN;this.W=!1;this.Ty={zoB:function(){return m.K},
gJ:function(){return m.V},
hoL:function(){return m.U},
retry:function(){return m.retry()}};
g.t(this,this.U);this.qX=this.j.observe(this.lw.bind(this))},kFz=function(O,V,J,y,l){var m;
return g.Q(function(H){if(H.j==1)return m=new dK(O,V,J,y,l),H.K(B4F(m),2);PFz(m);return H.return(m)})},PFz=function(O){var V=O.K.actions[0];
return O.D?((V==null?void 0:V.action.actionType)==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&O.D[0].action.actionType!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(O.W=!0),Promise.resolve()):STV(O)},STV=function(O){var V,J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M;
return g.Q(function(w){switch(w.j){case 1:if(O.D)throw Error("Already processing an action");if(O.GL())return w.return();V=O.K.actions.shift();s_E(O.KD,!V);if(V===void 0)return w.return();V.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&V.actionId==="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS"&&i3n(O.K,V.actionId);J="";V.action.actionType==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&V.rootActionId===V.actionId&&(J=V.actionId);y=[V];O.D=y;if(l=O.fD[V.entityType]){w.uw(2);break}O.D=
void 0;return w.K(STV(O),3);case 3:return w.return();case 2:m=g.n(y);for(H=m.next();!H.done;H=m.next())F=H.value,tTz(F,2);w.W(4,5);return w.K(Z3I(l,y.map(function(L){return L.action})),7);
case 7:N=w.U,x=g.n(y),W=x.next();case 8:if(W.done){w.uw(10);break}U=W.value;Z=N.get(U.action);return w.K(DUI(O,U,Z),9);case 9:W=x.next();w.uw(8);break;case 10:i3n(O.K,J);case 5:w.T();O.D=void 0;w.qX(6);break;case 4:return z=w.D(),OY("Orchestration error",z),w.W(12),w.K(OMs(O,y),14);case 14:w.S(5);break;case 12:c=w.D();OY("Orchestration retry error",c);Y=g.n(y);for(b=Y.next();!b.done;b=Y.next())M=b.value,M.retryScheduleIndex<3&&rFd(O.K,[M]);w.uw(5);break;case 6:return w.K(STV(O),0)}})},DUI=function(O,
V,J){var y,l,m,H,F,N,x,W,U,Z,z,c;
return g.Q(function(Y){switch(Y.j){case 1:y=V.retryScheduleIndex+2===3;if(J.status==="OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS"){Y.uw(2);break}if(J.status!=="OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE"){Y.uw(0);break}ukz(V,J,y);if(J.K&&V.retryScheduleIndex+1<3)return Y.K(OMs(O,[V]),0);m=((l=J)==null?0:l.j)?J.j:"OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN";H={entityKey:V.action.entityKey,failureReason:m};F=void 0;g.ZG(O.B)?F="mainVideoDownloadStateEntity":g.pJ(O.B)&&(F="musicTrackDownloadMetadataEntity");
if(!F||!J.downloadState){Y.uw(7);break}N=g.$y(V.action.entityKey).entityId;return Y.K(F8(N,F,O.j,J.downloadState),7);case 7:Jv(O.S,H);if(J.downloadState==="DOWNLOAD_STATE_FAILED"&&O.B.L("html5_auto_retry_failed_pde_actions")){Y.uw(0);break}OY("Orchestration result is not retryable, deleting action");return Y.K(gQz(O.j,za(V).key),0);case 2:x=void 0;try{x=(W=J.D)==null?void 0:W.map(function(b){return O.createAction(b,V)})}catch(b){return ukz(V,J,y),U={entityKey:V.action.entityKey,
failureReason:"OFFLINE_OPERATION_FAILURE_REASON_UNSUPPORTED_ENTITY_FAILED"},Jv(O.S,U),OY("Orchestration subactions creation error",b),Y.return()}ukz(V,J,y,x);if(!x){Y.uw(12);break}Z=x.map(function(b){return za(b)});
z=0;case 13:if(!(z<x.length)||O.W){Y.uw(15);break}return Y.K(rm(O.j,{mode:"readwrite",cY:!0},function(b){var M=[];M.push(hjd(b,Z.slice(z,z+10),"offlineOrchestrationActionWrapperEntity"));return g.WH.all(M)}),16);
case 16:z+=10;Y.uw(13);break;case 15:if(O.W)return O.W=!1,Y.return();case 12:return c=za(V),Y.K(gQz(O.j,c.key),17);case 17:tTz(V,4),Y.V()}})},lNm=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z;
return g.Q(function(c){J=[];y=Infinity;l=4E3;m=g.n(V);for(H=m.next();!H.done;H=m.next())F=H.value,N=Number(F.enqueueTimeSec),x=VJW(N),W=F.retryScheduleIndex,U=W!=null&&W>0,x>0&&U?(y=Math.min(y,N),l=Math.min(x,l)):J.push(F);isFinite(y)&&(!O.U.isActive()||y<O.T)&&(O.T=y,O.U.start(l));O.V.fE()||(Z=J.length,J=J.filter(function(Y){var b;Y=((b=Y.actionProto)==null?void 0:b.actionType)||"OFFLINE_ORCHESTRATION_ACTION_TYPE_UNKNOWN";return!JXC.includes(Y)}),z=J.length<Z,!O.U.isActive()&&z&&O.U.start(1));
J.length>0&&yXy(O,J);return c.K(PFz(O),0)})},$Ed=function(O){var V,J,y,l,m,H,F;
return g.Q(function(N){if(N.j==1)return N.K(mEz(O),2);V=N.U;J=[];y=g.n(V);for(l=y.next();!l.done;l=y.next())m=l.value,H=g.$y(m.key),F=H.entityId,Rhy(O.K,F)||J.push(m);return N.K(lNm(O,J),0)})},VJW=function(O){O=O*1E3-Date.now();
return O>4E3?4E3:O},OMs=function(O,V){var J,y,l;
return g.Q(function(m){J=g.n(V);for(y=J.next();!y.done;y=J.next()){l=y.value;var H=void 0,F=void 0,N=((F=l.action)==null?void 0:(H=F.actionMetadata)==null?void 0:H.retryScheduleIntervalsInSeconds)||[1,2,4];H=1;l.retryScheduleIndex<N.length&&(H=N[l.retryScheduleIndex]);l.K=H*1E3+Date.now();l.retryScheduleIndex++}return m.K(HMd(O,V),0)})},B4F=function(O){var V;
return g.Q(function(J){if(J.j==1)return J.K(Br(O.j,"offlineOrchestrationActionWrapperEntity"),2);V=J.U;return J.K(lNm(O,V),0)})},yXy=function(O,V){V.length!==0&&V.forEach(function(J){J=ZC(J);
J.retryScheduleIndex<3&&rFd(O.K,[J])})},mEz=function(O,V){var J;
return g.Q(function(y){if(y.j==1)return y.K(Br(O.j,"offlineOrchestrationActionWrapperEntity",V),2);J=y.U;return y.return(J.filter(AbC))})},HMd=function(O,V){if(V.length===0)return Promise.resolve([]);
V=V.map(function(J){return za(J)});
return d$C(O.j,V)},j5W=function(O){this.cE=O;
this.K=void 0},CNm=function(O,V){var J,y,l,m;
return g.Q(function(H){J=V.videoId;y=!0;if(V.captionTracks.length)l=cZC(V),O.K=new g.Tm(O.cE,V,l);else if(V.yc)m=g.miU(V),O.K=new g.Il(O.cE,V.yc,J,m,V.YI,V.eventId),y=V.YI;else return H.return();return H.return(new Promise(function(F){var N;(N=O.K)==null||N.SM({R2:function(){return g.Q(function(x){if(x.j==1)return x.K(O.R2(J,y),2);F();x.V()})},
P0:function(){}})}))})},Fay=function(O){var V;
return g.Q(function(J){if(J.j==1)return J.K(PDW(O),2);V=J.U;return J.return(!!V&&V.length>0)})},gK=function(O){g.K.call(this);
this.K=O;this.j=this.K.observe(this.U.bind(this))},NPE=function(O,V){var J,y,l,m,H,F,N;
return g.Q(function(x){switch(x.j){case 1:if(V.length===0)return x.return([]);J=V.map(function(W){return g.Hq(W,"transfer")});
return x.K(Br(O.K,"transfer",J),2);case 2:y=x.U;l=y.filter(AbC).map(function(W){return g.$y(W.key).entityId});
m=V.filter(function(W){return l.indexOf(W)===-1});
if(m.length===0)return x.return([]);H=g.n(m);F=H.next();case 3:if(F.done){x.uw(5);break}N=F.value;return x.K(vSd(N),4);case 4:F=H.next();x.uw(3);break;case 5:return x.return(m)}})},UEz=function(O,V,J,y,l,m){var H,F,N;
return g.Q(function(x){H="STREAM_TYPE_UNKNOWN";J.video&&J.audio?(H="STREAM_TYPE_AUDIO_AND_VIDEO",OY("unexpected stream type")):J.video&&!J.audio?H="STREAM_TYPE_VIDEO":!J.video&&J.audio&&(H="STREAM_TYPE_AUDIO");F=g.Hq(V,"offlineVideoStreams");N={numBytesDownloaded:l.toFixed(),numTotalBytes:m.toFixed(),streamType:H,streamState:"DOWNLOAD_STREAM_STATE_IN_PROGRESS",formatStreamBytes:JSON.stringify(y),itag:H==="STREAM_TYPE_AUDIO_AND_VIDEO"?Number(J.itag):void 0};return x.K(rm(O,{mode:"readwrite",cY:!0},
function(W){var U=qr(W,F,"offlineVideoStreams"),Z=qr(W,g.Hq(V,"transfer"),"transfer");return g.WH.all([U,Z]).then(function(z){z=g.n(z);var c=z.next().value;z=z.next().value;if(!z)return tL(W,F).then(function(){});
var Y=xEz(c);c=Waz(c,y,N,F);var b=Kw(W,c,"offlineVideoStreams");xEz(c)>Y&&(z.lastProgressTimeMs=Date.now().toString());Y=[b];z.offlineVideoStreams||(z.offlineVideoStreams=[]);z.offlineVideoStreams.indexOf(F)===-1&&(z.offlineVideoStreams.push(F),Y.push(Kw(W,z,"transfer")));return g.WH.all(Y)})}),0)})},ZMs=function(O,V){var J,y,l,m,H;
return g.Q(function(F){if(F.j==1)return J=g.Hq(V,"offlineVideoStreams"),F.K(RA(O,J,"offlineVideoStreams"),2);y=F.U;if(!y||!y.streamsProgress)return F.return();l=g.n(y.streamsProgress);for(m=l.next();!m.done;m=l.next())H=m.value,H.streamState="DOWNLOAD_STREAM_STATE_COMPLETE",H.numTotalBytes!==H.numBytesDownloaded&&(H.numBytesDownloaded=H.numTotalBytes);return F.K(ix(O,y,"offlineVideoStreams"),0)})},Waz=function(O,V,J,y){if(O&&O.streamsProgress){y=O;
a:{V=V.itag+";"+V.xtags;for(var l=O.streamsProgress,m=0;m<l.length;m++){var H=JSON.parse(l[m].formatStreamBytes);if(H.itag+";"+H.xtags===V){l[m]=J;J=l;break a}}l.push(J);J=l}y.streamsProgress=J}else O={key:y,streamsProgress:[J]};return O},xEz=function(O){if(O==null?0:O.streamsProgress){var V=0;
O=O.streamsProgress;for(var J=0;J<O.length;J++){var y=O[J];isNaN(Number(y.numBytesDownloaded))?OY("stream progress bytes number invalid"):V+=Number(y.numBytesDownloaded)}return V}return 0},z1d=function(O,V,J,y){g.K.call(this);
var l=this;this.j=O;this.api=V;this.yz=J;this.lw=y;this.V=new g.nO;this.D=new g.t_(function(){l.K&&l.K.transferState==="TRANSFER_STATE_TRANSFERRING"&&l.V.fE()&&((l.K.transferRetryCount||0)<3?EY(l.S,l.W,!1,!1):X8(l.S,l.W.videoDetails.videoId),l.Sm("TRANSFER_FAILURE_REASON_TIMEOUT_NO_PROGRESS"))});
this.KD=this.dW=0;this.qX=this.T=!1;this.E5=g.Ry(this.api.Y().experiments,"html5_transfer_processing_logs_interval");this.LD=new g.jX(this);this.Ty={DBX:function(){return l.D},
noW:function(){return l.lw},
gJ:function(){return l.V}};
this.fD=this.j.observe(this.GZ.bind(this));this.S=new oSz(V,this);this.nD=new j5W(V);this.O5=new gK(this.j);this.ol=this.V.listen("publicytnetworkstatus-online",this.Qb.bind(this));this.Vz=this.V.listen("publicytnetworkstatus-offline",this.F0K.bind(this));this.qX=this.api.Y().L("html5_less_transfer_processing_logs");g.t(this,this.LD);this.LD.Z(V,"offlinetransferpause",this.iuL);if(g.ZG(this.api.Y()))this.U="mainVideoDownloadStateEntity";else if(g.pJ(this.api.Y())||g.cJ(this.api.Y()))this.U="musicTrackDownloadMetadataEntity"},
cXz=function(O){return g.Q(function(V){if(V.j==1)V=V.K(RjF(),2);
else{var J=V.K;var y=O.O5;var l=g.SN();l=Object.keys(l);y=NPE(y,l);V=J.call(V,y,0)}return V})},Qu=function(O,V){V=V===void 0?!1:V;
var J;return g.Q(function(y){if(y.j==1){if(O.K)throw Error("Already downloading a video");O.KD=0;O.T=!1;return y.K(s5F(O),2)}return y.j!=4?(J=y.U,Tqn(O.yz,!J),J&&O.V.fE()?V?y.K(new Promise(function(l){g.CW(l,1E3)}),4):y.uw(4):(!J&&O.K&&qG(O),y.uw(0))):y.K(TPF(O,J),0)})},e1z=function(O){return g.Q(function(V){if(V.j==1)return O.W?V.K(X8(O.S,O.W.videoDetails.videoId),3):V.uw(0);
qG(O);V.V()})},INC=function(O,V){var J,y,l;
return g.Q(function(m){switch(m.j){case 1:return m.W(2),(J=!!V.captionTracks.length||!!V.yc)?m.K(Fay(V.videoId),4):m.return();case 4:return(y=m.U)?m.return():m.K(CNm(O.nD,V),5);case 5:m.S(0);break;case 2:l=m.D(),OY("Caption downloading error",l,V.cotn),m.V()}})},TPF=function(O,V){var J,y,l,m,H,F;
return g.Q(function(N){switch(N.j){case 1:if(O.T)return N.return();O.T=!0;O.K=V;J=g.$y(O.K.key);y=J.entityId;l=void 0;if(O.K.transferState==="TRANSFER_STATE_TRANSFERRING")return N.K(Ga(O,y),7);if(O.K.transferState!=="TRANSFER_STATE_TRANSFER_IN_QUEUE"||O.K.transferRetryCount||O.K.hasLoggedFirstStarted){N.uw(3);break}return N.K(Ga(O,y),5);case 5:return l=N.U,O.K.hasLoggedFirstStarted=!0,N.K(Y9C(O),6);case 6:Ils({videoId:y,r8:O.K,offlineModeType:l},void 0,void 0,!0);N.uw(3);break;case 7:l=N.U,mF({transferStatusType:"TRANSFER_STATUS_TYPE_RESUME_PROCESSING",
statusType:"OFFLINING_RETRIED"},{videoId:y,r8:O.K,offlineModeType:l});case 3:return N.K(aNn(O),8);case 8:return m=null,N.W(9),N.K(bMV(O,V),11);case 11:m=N.U;O.W=m;N.S(10);break;case 9:return H=N.D(),OY("error getting player response",H,V.cotn),N.K(O.Sm("TRANSFER_FAILURE_REASON_SERVER_PROPERTY_MISSING"),12);case 12:return N.return();case 10:return F=o9s(O.api.Y(),V.cotn,m),N.K(INC(O,F),13);case 13:return N.K(wum(F.videoId),14);case 14:F.PX=N.U;var x=O.S,W=F,U=V.maximumDownloadQuality;W.getPlayerResponse();
g.Oy(W.videoId,2);x.U=2;x.j=!1;var Z;(Z=x.player)==null||Z.dispose();x.player=x.api.Gc(W);W={};x.player.u3((W.localmediachange=x.cR,W.signatureexpired=x.Lq,W.statechange=x.SAN,W),x);x.L("html5_generate_content_po_token")&&x.player.iT();U=x.YK(U);x.player.Jt(g.th(U,U,!0,"m"),!1);x.player.AB(!1);O.D.start(108E5);N.V()}})},s5F=function(O){var V,J;
return g.Q(function(y){if(y.j==1)return y.K(Br(O.j,"transfer"),2);V=y.U;J=V.filter(pPs).sort(fNE);return J.length===0?y.return():y.return(J[0])})},aNn=function(O){var V,J,y;
return g.Q(function(l){if(l.j==1){if(!O.K)return KQ(O,"onTransferStart"),l.return();O.D.start(108E5);return l.K(tv(O,"TRANSFER_STATE_TRANSFERRING"),2)}V=O.K;return(y=((J=V)==null?0:J.key)?g.$y(V.key).entityId:"")&&O.U?l.K(F8(y,O.U,O.j,"DOWNLOAD_STATE_DOWNLOAD_IN_PROGRESS"),0):l.uw(0)})},LS1=function(O){var V,J,y,l;
g.Q(function(m){switch(m.j){case 1:if(!O.K){KQ(O,"onTransferPausedByUser");m.uw(2);break}V=O.K;O.D.stop();return m.K(tv(O,"TRANSFER_STATE_PAUSED_BY_USER"),3);case 3:y=((J=V)==null?0:J.key)?g.$y(V.key).entityId:"";if(!y||!O.U){m.uw(4);break}return m.K(F8(y,O.U,O.j,"DOWNLOAD_STATE_PAUSED"),4);case 4:return m.K(Ga(O,y),6);case 6:l=m.U,alm({videoId:y,r8:V,offlineModeType:l});case 2:qG(O),Qu(O),m.V()}})},nSV=function(O){var V,J,y;
g.Q(function(l){if(l.j==1){if(!O.K)return KQ(O,"onTransferPausedByNetwork"),l.return();O.D.stop();return l.K(tv(O,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),2)}if(l.j!=3)return V=O.K,(y=((J=V)==null?0:J.key)?g.$y(V.key).entityId:"")&&O.U?l.K(F8(y,O.U,O.j,"DOWNLOAD_STATE_PAUSED"),3):l.uw(3);qG(O);l.V()})},h1m=function(O){var V,J,y,l,m;
g.Q(function(H){switch(H.j){case 1:if(!O.K)return KQ(O,"onTransferComplete"),H.return();V=O.K;O.D.stop();if(!V||!O.W){H.uw(2);break}J=o9s(O.api.Y(),V.cotn,O.W);return H.K(INC(O,J),2);case 2:return H.K(tv(O,"TRANSFER_STATE_COMPLETE","DOWNLOAD_STREAM_STATE_COMPLETE"),4);case 4:l=((y=V)==null?0:y.key)?g.$y(V.key).entityId:"";if(!l||!O.U){H.uw(5);break}return H.K(F8(l,O.U,O.j,"DOWNLOAD_STATE_COMPLETE"),5);case 5:return H.K(ZMs(O.j,l),7);case 7:return H.K(Ga(O,l),8);case 8:m=H.U,mF({transferStatusType:"TRANSFER_STATUS_TYPE_COMPLETED",
statusType:"SUCCESS"},{videoId:l,r8:V,offlineModeType:m}),qG(O),Qu(O),H.V()}})},oUs=function(O,V,J){var y,l;
g.Q(function(m){switch(m.j){case 1:if(!O.K)return KQ(O,"onTransferProgress: "+V),m.return();if(O.K.transferState==="TRANSFER_STATE_TRANSFERRING"){m.uw(2);break}return m.K(aNn(O),2);case 2:y=Date.now();if(!(y-O.dW>1E3)){m.uw(4);break}O.dW=y;return m.K(UEz(O.j,J.videoId,J.j,J.LC,J.bytesDownloaded,J.K),5);case 5:if(O.qX&&!(O.qX&&y-O.KD>O.E5)){m.uw(4);break}O.KD=y;return m.K(Ga(O,V),7);case 7:l=m.U,Ils({videoId:V,r8:O.K,offlineModeType:l},J.bytesDownloaded,J.K);case 4:O.D.start(108E5),m.V()}})},vU1=function(O){var V=
(O.K.transferRetryCount||0)<3;
V&&(O=O.K,O.transferRetryCount=(O.transferRetryCount||0)+1);return V},wP1=function(O,V){V=V===void 0?"TRANSFER_FAILURE_REASON_UNKNOWN":V;
var J,y,l,m;return g.Q(function(H){if(H.j==1)return O.K||KQ(O,"setTransferToFailed: "+V),J="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V==="TRANSFER_FAILURE_REASON_NETWORK"?J="OFFLINE_OPERATION_FAILURE_REASON_NETWORK_REQUEST_FAILED":V==="TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"&&(J="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED"),H.K(tv(O,"TRANSFER_STATE_FAILED","DOWNLOAD_STREAM_STATE_ERROR_STREAMS_MISSING",V),2);if(H.j!=3)return Jv(O.lw,{entityKey:(y=O.K)==null?void 0:y.key,failureReason:J}),
l=O.K?g.$y(O.K.key).entityId:"",H.K(Ga(O,l),3);m=H.U;var F={videoId:l,r8:O.K,offlineModeType:m},N=V,x={transferStatusType:"TRANSFER_STATUS_TYPE_TERMINATED_WITH_FAILURE",statusType:"FAILED"};N&&(x.transferFailureReason=N,x.failureReason=bqF(N));mF(x,F);H.V()})},tv=function(O,V,J,y){var l;
return g.Q(function(m){if(m.j==1){if(!O.K)return KQ(O,"saveTransferState: "+V),m.return();O.K.transferState=V;O.K.failureReason=y;m.W(2);return m.K(Y9C(O,function(H){return J?QM(H,"offlineVideoStreams",O.K.offlineVideoStreams).then(function(F){for(var N=g.n(F),x=N.next();!x.done;x=N.next())if((x=x.value)&&x.streamsProgress){x=g.n(x.streamsProgress);for(var W=x.next();!W.done;W=x.next())W.value.streamState=J}return hjd(H,F.filter(function(U){return!!U}),"offlineVideoStreams")}):g.WH.resolve(void 0)}),
4)}if(m.j!=2)return m.S(0);
l=m.D();return l instanceof g.$P&&l.type==="QUOTA_EXCEEDED"?m.K(O.Sm("TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE"),0):m.uw(0)})},Y9C=function(O,V){var J;
return g.Q(function(y){if(!O.K)return y.return();J=O.K;return y.K(rm(O.j,{mode:"readwrite",cY:!0},function(l){var m=[Kw(l,J,"transfer")];V&&m.push(V(l));return g.WH.all(m)}),0)})},qG=function(O){O.K=void 0;
O.W=void 0;O.D.stop()},bMV=function(O,V){var J,y,l,m,H;
return g.Q(function(F){if(F.j==1)return J=g.$y(V.key),y=J.entityId,l=g.Hq(y,"playbackData"),F.K(RA(O.j,l,"playbackData"),2);m=F.U;if((H=m)==null?0:H.playerResponseJson)return F.return(JSON.parse(m.playerResponseJson));throw Error("No PlayerResponse found");})},KQ=function(O,V){O.api.jB("woffle",{mcte:V});
OY("missing current transfer entity.")},Ga=function(O,V){var J,y,l;
return g.Q(function(m){if(m.j==1)return m.K(RA(O.j,g.Hq(V,"videoDownloadContextEntity"),"videoDownloadContextEntity"),2);J=m.U;return m.return((l=(y=J)==null?void 0:y.offlineModeType)!=null?l:void 0)})},pPs=function(O){return MJW[O.transferState]!==void 0},fNE=function(O,V){var J=MJW[O.transferState],y=MJW[V.transferState];
return J!==y?J-y:Number(O.enqueuedTimestampMs)-Number(V.enqueuedTimestampMs)},uq=function(O,V){var J=this;
this.B=O;this.api=V;this.V=new g.nO;this.W=new g.HP;this.Ty={kE:function(){return J.U.Ty.kE()},
gJ:function(){return J.V},
PpN:function(){return J.U},
qy:function(){return J.qy()},
Nh:function(){return J.Nh()},
zH:function(){return J.zH()},
RD:function(){return J.RD()},
qh:function(){return J.qh()},
dK:function(y){return J.dK(y)}};
this.U=new ZqC(function(){return Lam(J)},function(){J.zH()},this.api.hO(),this.api.L.bind(this.api));
this.K=new Vu(this.api);zLn(this.U)},Lam=function(O){return g.Q(function(V){O.api.MX("onOrchestrationBecameLeader");
return V.K(O.Nh(),0)})},XPI=function(O){var V,J;
return g.Q(function(y){if(y.j==1)return y.K(Pr(),2);if(y.j!=3){V=y.U;if(!V)return OY("PES is undefined"),y.return();O.j=new z1d(V,O.api,O.U,O.K);J=O.B5(V);return y.K(kFz(V,J,O.U,O.K,O.B),3)}O.S=y.U;return y.K(nUz(O),0)})},nUz=function(O){var V;
return g.Q(function(J){switch(J.j){case 1:if(!O.j)return OY("transferManager is undefined"),J.return();if(O.j.K){J.uw(2);break}return J.K(Qu(O.j),2);case 2:if(!O.B.L("woffle_enable_main_downloads_library")){J.uw(4);break}return J.K(O.yk(),4);case 4:if(!O.B.L("html5_offline_playback_position_sync")){J.uw(6);break}return J.K(O.CX(),7);case 7:return J.K(O.dK(864E5),6);case 6:return J.K(O.refreshAllStaleEntities(43200,!0),9);case 9:return J.K(O.xX(),10);case 10:if(!O.B.L("html5_retry_downloads_for_expiration")){J.uw(11);
break}return J.K(O.qh(),11);case 11:return O.T=g.FR(function(){O.refreshAllStaleEntities(43200,!0);O.xX()},9E5),g.AG(g.ij(),function(){return O.RD()}),J.K(Pr(),13);
case 13:return V=J.U,J.K(UqI(V),14);case 14:cBW(O.U),J.V()}})},EUC=function(){var O,V,J,y,l,m;
return g.Q(function(H){switch(H.j){case 1:return H.K(Pr(),2);case 2:O=H.U;if(!O)return H.return([]);V=Date.now()/1E3;return H.K(Br(O,"offlineVideoPolicy"),3);case 3:J=H.U,y=g.n(J),l=y.next();case 4:if(l.done){H.uw(6);break}m=l.value;if(!(m.expirationTimestamp&&Number(m.expirationTimestamp)<V)){H.uw(5);break}m.action="OFFLINE_VIDEO_POLICY_ACTION_DISABLE";m.offlinePlaybackDisabledReason="OFFLINE_PLAYBACK_DISABLED_REASON_CLIENT_OFFLINE_CONTENT_EXPIRED";return H.K(ix(O,m,"offlineVideoPolicy"),5);case 5:l=
y.next();H.uw(4);break;case 6:return H.return(J.map(function(F){return F.key}))}})},Av=function(O,V,J,y,l){var m,H,F;
return g.Q(function(N){if(N.j==1)return N.K(Pr(),2);m=N.U;if(!m)return N.return([]);H=V.map(function(x){var W=g.Hq(x,J);W={actionType:y,entityKey:W,actionMetadata:Object.assign({},v9E(),l)};y!=="OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"&&(W.actionMetadata.priority=0);x=new UY(J,x,W);return za(x)});
F=d$C(m,H);zLn(O.U);return N.return(F)})},dEE=function(O,V,J,y){var l,m,H,F,N,x,W,U;
return g.Q(function(Z){switch(Z.j){case 1:l=[],m=g.n(V),H=m.next();case 2:if(H.done){Z.uw(4);break}F=H.value;if(F.upToDate||J&&!F.shouldAutoSyncMetadata||!F.playlistId){Z.uw(3);break}N={};switch(y){case "mainPlaylistEntity":x={nextAutoRefreshIntervalSeconds:F.checkInSeconds,autoSync:J};N={mainPlaylistEntityActionMetadata:x};break;case "musicPlaylist":W={autoSync:J},N={musicPlaylistEntityActionMetadata:W}}return Z.K(Av(O,[F.playlistId],y,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",N),6);case 6:(U=
Z.U)&&l.push.apply(l,g.q(U));case 3:H=m.next();Z.uw(2);break;case 4:return Z.return(l)}})},gUV=function(O,V){var J;
return g.Q(function(y){return V.length?(J=v9E(),g.fY(J,LQ,{isEnqueuedForExpiredStreamUrlRefetch:!0}),O.api.jB("qrd",{v:V.length}),y.return(Av(O,V,"playbackData","OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",J))):y.return([])})},q91=function(O,V,J){this.K=O;
this.B=V;this.U=J},KaE=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w;
return g.Q(function(L){switch(L.j){case 1:return J=$w(V),y=g.$y(V.entityKey),l=y.entityId,m=[],L.W(2),L.K(Q5V(O,l),4);case 4:m=L.U;if(!(O.B.L("woffle_enable_main_downloads_library")&&((H=m)==null?0:H.length))){L.uw(5);break}return L.K(uuD(O.K,[V.entityKey]),5);case 5:L.S(3);break;case 2:return F=L.D(),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.$P&&F.type==="QUOTA_EXCEEDED"?(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"):OY("Playlist add error"),L.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,N,x));case 3:W=[];if(!O.B.L("html5_offline_prevent_redownload_downloaded_video")){L.uw(7);break}return L.K(hLn(O.K,"mainVideoEntity",m),8);case 8:m=L.U;case 7:if((U=m)==null?0:U.length)for(Z=g.n(m),z=Z.next();!z.done;z=Z.next())if(c=z.value,Y=c.offlineVideoData,b=void 0,(b=Y)==null?0:b.videoId)M=void 0,w=Number(((M=V.actionMetadata)==null?void 0:M.priority)||
0)+1,W.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",Y.videoId,"mainVideoEntity",w,rK,Gld(V,Y,l)));return L.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,W))}})},uPV=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo,md,xY,V7,Tr,Rp,ys,JI,uX,nn,im,fd,h,X1,AI,gV,lX,az,p,Jr,Ht,wT,HZ,sz,Ml,ZZ,Mk,f,a,v,E,d,Hh,B,A,jV,op,Bh,xE,w5,lm,bX,rT,hr,Rz,vh,fu,Uz,Q7,Ph,Y_;
return g.Q(function(Pn){switch(Pn.j){case 1:return J=$w(V),y=V.entityKey,l=g.$y(y).entityId,m=[],H=!1,l==="!*$_ALL_ENTITIES_!*$"?(H=!0,Pn.K(Br(O.K,"mainPlaylistEntity"),5)):Pn.K(RA(O.K,y,"mainPlaylistEntity"),4);case 4:(F=Pn.U)&&m.push(F);Pn.uw(3);break;case 5:m=Pn.U;case 3:if((N=m)==null||!N.length)return Pn.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));x=g.e(V.actionMetadata,tJC);U=(W=x)==null?void 0:W.nextAutoRefreshIntervalSeconds;z=(Z=x)==null?void 0:Z.autoSync;c=[];b=Y=!0;
M=!1;if(!H&&z===!1){Pn.uw(6);break}Pn.W(7);return Pn.K(lWd(0,!!z,!0,m),9);case 9:c=Pn.U;Pn.S(8);break;case 7:w=Pn.D();if(!(w instanceof Error&&w.message==="No data")){w instanceof Error&&w.message==="Empty response body"&&OY(w.message);Pn.uw(8);break}return l==="!*$_ALL_ENTITIES_!*$"?Pn.K(dqd(O.K,V,O.U,"OFFLINE_DELETE_REASON_UNAVAILABLE"),8):Pn.K(XGF(l,O.K,V,O.U),8);case 8:if(!c.length||!H&&c[0].playlistId!==l)return Pn.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));case 6:if(H){L=
[];X=g.n(c);for(u=X.next();!u.done;u=X.next())G=u.value,G.upToDate||z&&!G.shouldAutoSyncMetadata||!G.playlistId||(k={nextAutoRefreshIntervalSeconds:G.checkInSeconds,autoSync:z},L.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",G.playlistId,"mainPlaylistEntity",0,rK,{mainPlaylistEntityActionMetadata:k})));return Pn.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,L))}c.length&&(D=c[0],M=!!D.upToDate,z&&(Y=(Oo=D.shouldAutoSyncMetadata)!=null?Oo:!0,b=(md=D.shouldAutoSyncVideos)!=null?
md:!0,D.checkInSeconds&&(U=D.checkInSeconds)));if(M||!Y)return Pn.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));xY=[];V7=m[0];if(!V7.downloadState){Tr=void 0;Pn.uw(15);break}return Pn.K(RA(O.K,V7.downloadState,"mainPlaylistDownloadStateEntity"),16);case 16:Tr=Pn.U;case 15:return Rp=Tr,JI=((ys=Rp)==null?0:ys.addedTimestampMillis)?String(Rp.addedTimestampMillis):void 0,Pn.W(17),Pn.K(Q5V(O,l,JI,U),19);case 19:xY=Pn.U;Pn.S(18);break;case 17:uX=Pn.D();if(!(uX instanceof Error&&uX.message===
"No data for playlist")){if(uX instanceof Error&&uX.message==="Empty response body for playlist")OY(uX.message);else return nn="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",im="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",uX instanceof g.$P&&uX.type==="QUOTA_EXCEEDED"&&(nn="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",im="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Pn.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,nn,im));Pn.uw(18);break}return Pn.K(XGF(l,
O.K,V,O.U),18);case 18:if(!b)return Pn.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));fd=[];h=new Map;if((X1=xY)==null?0:X1.length)for(AI=g.n(xY),gV=AI.next();!gV.done;gV=AI.next())lX=gV.value,az=lX.offlineVideoData,p=void 0,((p=az)==null?0:p.videoId)&&h.set(az.videoId,az);Jr=new Map;Ht=[];if((wT=V7)==null?0:(HZ=wT.videos)==null?0:HZ.length)for(sz=g.n(V7.videos),Ml=sz.next();!Ml.done;Ml=sz.next())if(ZZ=Ml.value,Mk=JSON.parse(g.$y(ZZ).entityId),f=Mk.videoId)h.has(f)?(Jr.set(f,h.get(f)),
h.delete(f)):Ht.push(f);v=Number(((a=V.actionMetadata)==null?void 0:a.priority)||0)+1;E=g.n(h.entries());for(d=E.next();!d.done;d=E.next())Hh=d.value,B=g.n(Hh),A=B.next().value,jV=B.next().value,op=A,Bh=jV,fd.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",op,"mainVideoEntity",v,rK,Gld(V,Bh,l)));xE=g.n(Jr.entries());for(w5=xE.next();!w5.done;w5=xE.next())lm=w5.value,bX=g.n(lm),rT=bX.next().value,hr=bX.next().value,Rz=rT,vh=hr,fd.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",Rz,"mainVideoEntity",
v,rK,Gld(V,vh,l)));fu=g.n(Ht);for(Uz=fu.next();!Uz.done;Uz=fu.next())Q7=Uz.value,Ph={playlistId:l},Y_={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"},mainVideoEntityActionMetadata:Ph},fd.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Q7,"mainVideoEntity",0,rK,Y_));return Pn.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,fd))}})},AXm=function(O,V){var J,y,l,m;
return g.Q(function(H){switch(H.j){case 1:return J=$w(V),H.W(2),y=g.$y(V.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?H.K(dqd(O.K,V,O.U,(l=V.actionMetadata)==null?void 0:(m=l.offlineLoggingData)==null?void 0:m.offlineDeleteReason),5):H.K(XGF(y,O.K,V,O.U),6);case 6:if(!O.B.L("woffle_enable_main_downloads_library")){H.uw(5);break}return H.K(ABD(O.K,V.entityKey),5);case 5:H.S(3);break;case 2:return H.D(),H.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
"OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return H.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J))}})},Q5V=function(O,V,J,y){var l,m,H,F,N,x,W;
return g.Q(function(U){switch(U.j){case 1:return U.K(JFn([V]),2);case 2:return l=U.U,U.K(rXz(O,l[0],J,y),3);case 3:return m=U.U,H=m.mainPlaylistEntity,F=m.xqv,x=LUV(H,(N=F)==null?void 0:N.avatar),U.W(4),U.K(sY(x),6);case 6:U.S(5);break;case 4:W=U.D(),W instanceof Error&&W.message==="Failed to fetch"&&OY(W.message);case 5:return U.return(l[0].videos)}})},rXz=function(O,V,J,y){var l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X;
return g.Q(function(u){switch(u.j){case 1:l=Date.now().toString();J||(J=l);m=V.videos;H=V.playlistId;F=[];N=[];if(m)for(x=g.n(m),W=x.next();!W.done;W=x.next()){U=W.value;Z=U.offlineVideoData;if(!Z||!Z.videoId)throw OY("Invalid offlineVideoData for playlist"),Error("Invalid offlineVideoData for playlist");z=Z.videoId;c={videoId:z,playlistId:H};Y={id:g.Hq(JSON.stringify(c),"mainPlaylistVideoEntity"),video:g.Hq(z,"mainVideoEntity")};F.push(Y);N.push(Y.id)}M={key:g.Hq(H,"mainPlaylistDownloadStateEntity"),
addedTimestampMillis:J,lastSyncedTimestampMillis:l};w={key:g.Hq(H,"mainPlaylistEntity"),playlistId:H,videos:N,title:V.title,thumbnailStyleData:iMm(V),visibility:R1n(V),downloadState:M.key};V.channel&&(L=V.channel.offlineChannelData,b=BPC(g.Hq(H,"ytMainChannelEntity"),L),w.channelOwner=b.id);((X=w)==null?0:X.entityMetadata)?(w.entityMetadata.offlineLastModifiedTimestampSeconds=V.lastModifiedTimestamp,y&&(w.entityMetadata.nextAutoRefreshIntervalSeconds=String(y))):w&&(w.entityMetadata={nextAutoRefreshIntervalSeconds:y?
String(y):void 0,offlineLastModifiedTimestampSeconds:V.lastModifiedTimestamp});u.W(2);return u.K(rm(O.K,{mode:"readwrite",cY:!0},function(G){var k=Kw(G,w,"mainPlaylistEntity"),D=Kw(G,M,"mainPlaylistDownloadStateEntity");k=[k,D];D=g.n(F);for(var Oo=D.next();!Oo.done;Oo=D.next())k.push(Kw(G,Oo.value,"mainPlaylistVideoEntity"));b&&k.push(Kw(G,b,"ytMainChannelEntity"));return g.WH.all(k)}),4);
case 4:u.S(3);break;case 2:throw u.D(),OY("PES failure for playlist"),Error("PES failure for playlist");case 3:return u.return({mainPlaylistEntity:w,xqv:b,RwX:F})}})},BPC=function(O,V){return{id:O,
channelId:V.channelId,title:V.title,avatar:V.thumbnail}},iMm=function(O){var V=[],J=O.videos;
J&&J.length>0&&V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_FIRST_VIDEO"),value:{collageThumbnail:{coverThumbnail:J[0].offlineVideoData.thumbnail}}});if((O=O.additionalMetadadatas)&&O.length>0)for(O=g.n(O),J=O.next();!J.done;J=O.next()){var y=J.value.offlineBundleItemPlaylistData,l=void 0;J=(l=y)==null?void 0:l.style;l=void 0;y={collageThumbnail:{coverThumbnail:(l=y)==null?void 0:l.coverThumbnail}};switch(J){case "BUNDLE_ITEM_STYLE_UNSPECIFIED":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_UNKNOWN"),
value:y});break;case "BUNDLE_ITEM_STYLE_TWO_BY_TWO":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_TWO_BY_TWO"),value:y});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO_AVATAR":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO_AVATAR"),value:y});break;case "BUNDLE_ITEM_STYLE_ONE_AND_TWO":V.push({key:Number("PLAYLIST_THUMBNAIL_STYLE_ONE_AND_TWO"),value:y})}}return V},R1n=function(O){switch(O.privacy){case "PRIVATE":return"PLAYLIST_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_VISIBILITY_UNLISTED";default:return"PLAYLIST_VISIBILITY_UNKNOWN"}},Gld=function(O,V,J){V={offlineVideoData:V,
playlistId:J};if(O=g.e(O.actionMetadata,tJC))V.maximumDownloadQuality=O.maximumDownloadQuality;return{mainVideoEntityActionMetadata:V}},PNF=function(O,V,J){this.K=O;
this.B=V;this.U=J},DEm=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c;
return g.Q(function(Y){switch(Y.j){case 1:return J=$w(V),y=g.$y(V.entityKey),l=y.entityId,m=g.e(V.actionMetadata,iq),F=!((H=m)==null?0:H.playlistId),Y.W(2),Y.K(klD(O,l,void 0,(N=m)==null?void 0:N.offlineVideoData,F),4);case 4:Y.S(3);break;case 2:return x=Y.D(),W="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.$P&&x.type==="QUOTA_EXCEEDED"&&(W="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
Y.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,W,U));case 3:Z=1;Z=Number(((z=V.actionMetadata)==null?void 0:z.priority)||0)+1;var b=(b=g.e(V.actionMetadata,iq))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;c=wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",l,"playbackData",Z,S9D,b);return Y.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,[c]))}})},OZs=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w;
return g.Q(function(L){switch(L.j){case 1:return J=$w(V),y=g.$y(V.entityKey),l=y.entityId,L.K(RA(O.K,V.entityKey,"mainVideoEntity"),2);case 2:m=L.U;if(!m){H=void 0;L.uw(3);break}return L.K(RA(O.K,m.downloadState,"mainVideoDownloadStateEntity"),4);case 4:H=L.U;case 3:F=H;if(!m||!F)return L.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));L.W(5);return L.K(klD(O,l,F.addedTimestampMillis,(x=g.e(V.actionMetadata,iq))==null?void 0:x.offlineVideoData),7);case 7:W=1;W=Number(((U=V.actionMetadata)==
null?void 0:U.priority)||0)+1;N=wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",l,"playbackData",W,S9D);L.S(6);break;case 5:Z=L.D();if(!(Z instanceof Error&&Z.message==="No data")){if(Z instanceof Error&&Z.message==="Empty response body")OY(Z.message);else return z="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",Z instanceof g.$P&&Z.type==="QUOTA_EXCEEDED"&&(z="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",c="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
L.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,z,c));L.uw(6);break}return L.K(Yw(O.K,l),9);case 9:Y=L.U;b=g.e(V.actionMetadata,iq);if(w=(M=b)==null?void 0:M.playlistId)Y.playlistId=w;Y.offlineDeleteReason="OFFLINE_DELETE_REASON_UNAVAILABLE";return L.K(Ta(l,O.K,V,O.U,Y),6);case 6:return L.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,N?[N]:void 0))}})},VLy=function(O,V){var J,y,l,m,H,F,N,x,W,U;
return g.Q(function(Z){switch(Z.j){case 1:return J=$w(V),Z.W(2),y=g.$y(V.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?Z.K(dqd(O.K,V,O.U,(W=V.actionMetadata)==null?void 0:(U=W.offlineLoggingData)==null?void 0:U.offlineDeleteReason),5):Z.K(Yw(O.K,y),6);case 6:l=Z.U;m=g.e(V.actionMetadata,iq);if(F=(H=m)==null?void 0:H.playlistId)l.playlistId=F;l.offlineDeleteReason=(N=V.actionMetadata)==null?void 0:(x=N.offlineLoggingData)==null?void 0:x.offlineDeleteReason;return Z.K(Ta(y,O.K,V,O.U,l),7);case 7:if(!O.B.L("woffle_enable_main_downloads_library")){Z.uw(5);
break}return Z.K(ABD(O.K,V.entityKey),5);case 5:Z.S(3);break;case 2:return Z.D(),Z.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return Z.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J))}})},klD=function(O,V,J,y,l){var m,H,F,N,x,W;
return g.Q(function(U){switch(U.j){case 1:if(m=y){U.uw(2);break}return U.K(VTz([V]),3);case 3:H=U.U,m=H[0];case 2:return U.K(J_E(O,m,J,l),4);case 4:F=U.U;N=F.mainVideoEntity;x=F.channelEntity;U.W(5);var Z=U.K,z=W1(N.thumbnail),c=W1(x.avatar);return Z.call(U,sY(z.concat(c)),7);case 7:U.S(0);break;case 5:W=U.D(),W instanceof Error&&W.message==="Failed to fetch"&&OY(W.message),U.V()}})},J_E=function(O,V,J,y){var l,m,H,F,N,x,W,U,Z,z,c,Y,b;
return g.Q(function(M){switch(M.j){case 1:J||(J=Date.now().toString());m=(l=V.channel)==null?void 0:l.offlineChannelData;H={id:g.Hq(V.videoId,"ytMainChannelEntity"),channelId:m.channelId,title:m.title,avatar:m.thumbnail};F={key:g.Hq(V.videoId,"mainVideoDownloadStateEntity"),playbackData:g.Hq(V.videoId,"playbackData"),addedTimestampMillis:J,videoDownloadContextEntity:g.Hq(V.videoId,"videoDownloadContextEntity")};N={key:g.Hq(V.videoId,"videoPlaybackPositionEntity"),videoId:V.videoId,lastPlaybackPositionSeconds:"0"};
O.B.L("html5_offline_playback_position_sync")&&(x={playbackPosition:N.key});W=g.Hq(V.videoId,"mainVideoEntity");U={key:W,videoId:V.videoId,title:V.title,thumbnail:V.thumbnail,localizedStrings:{viewCount:V.shortViewCountText},userState:x,lengthSeconds:V.lengthSeconds?Number(V.lengthSeconds):void 0,publishedTimestampMillis:V.publishedTimestamp?(Number(V.publishedTimestamp)*1E3).toString():void 0,formattedDescription:V.description,owner:H.id,downloadState:F.key};if(!O.B.L("woffle_enable_main_downloads_library")||
!y){M.uw(2);break}return M.K(tId(O.K,[W]),3);case 3:if(c=M.U)Z=c.mainDownloadsLibraryEntity,z=c.mainDownloadsListEntity;case 2:return b=fls,Y={key:g.Hq(V.videoId,"downloadStatusEntity"),downloadState:"DOWNLOAD_STATE_PENDING_DOWNLOAD"},g.fY(F,b,Y),M.K(rm(O.K,{mode:"readwrite",cY:!0},function(w){var L=Kw(w,H,"ytMainChannelEntity"),X=Kw(w,F,"mainVideoDownloadStateEntity"),u=Kw(w,U,"mainVideoEntity");L=[L,X,u];O.B.L("html5_offline_playback_position_sync")&&(X=Kw(w,N,"videoPlaybackPositionEntity"),L.push(X));
Z&&(X=Kw(w,Z,"mainDownloadsLibraryEntity"),L.push(X));z&&(X=Kw(w,z,"mainDownloadsListEntity"),L.push(X));Y&&(w=Kw(w,Y,"downloadStatusEntity"),L.push(w));return g.WH.all(L)}),4);
case 4:return M.return({mainVideoEntity:U,channelEntity:H})}})},y_V=function(O,V,J){this.K=O;
this.B=V;this.U=J},mnz=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo,md,xY,V7;
return g.Q(function(Tr){switch(Tr.j){case 1:return J=$w(V),y=[],Tr.K(Xx.getInstance(),2);case 2:l=Tr.U;if(!l){Tr.uw(3);break}return Tr.K(l.get("sdois"),4);case 4:return m=Tr.U,Tr.K((F=l)==null?void 0:F.get("lmqf"),5);case 5:H=Tr.U;case 3:Tr.W(6);if(m===void 0)throw Error("prefStorage or opt-in state is undefined");N=[];if(m){Tr.uw(8);break}return Tr.K(KUz(O.K),9);case 9:N=Tr.U,N.reverse();case 8:if(!N.length){Tr.uw(10);break}x=g.n(N);W=x.next();case 11:if(W.done){Tr.uw(10);break}U=W.value;if(!U){Tr.uw(12);
break}Z=g.$y(U).entityId;return Tr.K(Yw(O.K,Z),14);case 14:return z=Tr.U,z.offlineDeleteReason="OFFLINE_DELETE_REASON_PARENT_LIST_DELETE",Tr.K(Ta(Z,O.K,{entityKey:U,actionType:V.actionType},O.U,z),12);case 12:W=x.next();Tr.uw(11);break;case 10:return Tr.K($Uy(m,(c=H)!=null?c:"SD"),16);case 16:return Y=Tr.U,Tr.K(g9I(Y),17);case 17:b=GpD(Y);if(!O.B.L("woffle_enable_main_downloads_library")){Tr.uw(18);break}if(m){Tr.uw(19);break}return Tr.K(ABD(O.K,Iv),19);case 19:return Tr.K(uuD(O.K,[Iv]),18);case 18:if((M=
b)==null?0:M.length)for(w=g.n(b),L=w.next();!L.done;L=w.next())if(u=X=L.value,G=u.actionType,k=u.entityKey,D=u.actionMetadata,G&&k&&D&&!g.e(D,l0z)){G==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(D.offlineLoggingData={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_DELETE"});if(Oo=g.e(X.actionMetadata,iq))Oo.playlistId="DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS",X.actionMetadata=Object.assign({},X.actionMetadata,{mainVideoEntityActionMetadata:Oo});y.push(X)}Tr.S(7);break;case 6:return md=Tr.D(),
xY="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",V7="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",md instanceof g.$P&&md.type==="QUOTA_EXCEEDED"&&(xY="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",V7="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Tr.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,xY,V7));case 7:return Tr.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,y))}})},$nD=function(){uq.apply(this,arguments);
this.qX="mainVideoEntity"},HZz=function(O,V,J){V=V===void 0?43200:V;
J=J===void 0?!0:J;var y=y===void 0?!1:y;var l,m,H;return g.Q(function(F){switch(F.j){case 1:if(!O.V.fE())return F.return([]);l=[];F.W(2);return F.K(lWd(V,J,y),4);case 4:l=F.U;F.S(3);break;case 2:m=F.D(),m instanceof Error&&m.message==="No data"||m instanceof Error&&m.message==="Empty response body"&&OY(m.message);case 3:return H=dEE(O,l,J,"mainPlaylistEntity"),F.return(H)}})},jZs=function(O,V,J,y){y=y===void 0?!1:y;
var l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w;return g.Q(function(L){switch(L.j){case 1:return l=[],L.K(mUz(),2);case 2:return(m=L.U)||y?L.K(H3z(V,J),3):L.return([]);case 3:H=L.U;if((F=H)==null||!F.length)return L.return([]);N={offlineDeleteReason:"OFFLINE_DELETE_REASON_PARENT_LIST_REFRESH"};x=g.n(H);W=x.next();case 4:if(W.done){L.uw(6);break}Z=U=W.value;z=Z.actionType;c=Z.entityKey;Y=Z.actionMetadata;if(!(z&&c&&Y)||g.e(Y,l0z)){L.uw(5);break}z==="OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE"&&(Y.offlineLoggingData=
N);b=g.$y(c);M=b.entityId;return L.K(Av(O,[M],"mainVideoEntity",z,Y),8);case 8:w=L.U,l=l.concat(w);case 5:W=x.next();L.uw(4);break;case 6:return L.return(l)}})},CLW=function(O,V){this.K=O;
this.U=V},N7C=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M;
return g.Q(function(w){switch(w.j){case 1:return J=$w(V),y=g.$y(V.entityKey),l=y.entityId,m=[],w.W(2),w.K(FEn(O,l),4);case 4:m=w.U;if((H=m)==null||!H.length){w.uw(5);break}return w.K(PTm(O.K,V.entityKey),5);case 5:w.S(3);break;case 2:return F=w.D(),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.$P&&F.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
w.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,N,x));case 3:return W=[],w.K(hLn(O.K,"musicTrack",m),7);case 7:m=w.U;if(m.length)for(U=g.n(m),Z=U.next();!Z.done;Z=U.next())if(z=Z.value,c=z.offlineVideoData,Y=void 0,(Y=c)==null?0:Y.videoId)b=void 0,M=Number(((b=V.actionMetadata)==null?void 0:b.priority)||0)+1,W.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c.videoId,"musicTrack",M,Rv,fQ(V,c,l)));return w.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,W))}})},
xns=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo,md,xY,V7,Tr,Rp,ys,JI,uX,nn,im,fd,h,X1,AI,gV,lX,az,p,Jr,Ht,wT,HZ,sz,Ml,ZZ,Mk,f,a,v,E,d,Hh,B,A,jV;
return g.Q(function(op){switch(op.j){case 1:return J=$w(V),y=V.entityKey,l=g.$y(y).entityId,m=[],H=!1,l==="!*$_ALL_ENTITIES_!*$"?(H=!0,op.K(Br(O.K,"musicAlbumRelease"),5)):op.K(RA(O.K,y,"musicAlbumRelease"),4);case 4:(F=op.U)&&m.push(F);op.uw(3);break;case 5:m=op.U;case 3:if((N=m)==null||!N.length)return op.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));if(H){x=[];W=g.n(m);for(U=W.next();!U.done;U=W.next())Z=U.value,z=g.$y(Z.id).entityId,x.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",
z,"musicAlbumRelease",0,Rv));return op.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,x))}c=[];Y=m[0];b=void 0;if(!Y.downloadMetadata){op.uw(6);break}return op.K(RA(O.K,Y.downloadMetadata,"musicAlbumReleaseDownloadMetadataEntity"),7);case 7:M=op.U,b=Number((L=(w=M)==null?void 0:w.addedTimestampMillis)!=null?L:"0")/1E3;case 6:return op.W(8),op.K(FEn(O,l,(X=b)==null?void 0:X.toString()),10);case 10:c=op.U;op.S(9);break;case 8:u=op.D();if(!(u instanceof Error&&u.message==="No data")){if(u instanceof
Error&&u.message==="Empty response body")OY(u.message);else return G="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",u instanceof g.$P&&u.type==="QUOTA_EXCEEDED"&&(G="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",k="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),op.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,G,k));op.uw(9);break}return op.K(bq(l,"musicAlbumRelease",O.K,V,O.U),9);case 9:D=[];Oo=new Map;
if((md=c)==null?0:md.length)for(xY=g.n(c),V7=xY.next();!V7.done;V7=xY.next())Tr=V7.value,Rp=Tr.offlineVideoData,ys=void 0,((ys=Rp)==null?0:ys.videoId)&&Oo.set(Rp.videoId,Rp);JI=new Map;uX=[];if((nn=Y)==null?0:(im=nn.tracks)==null?0:im.length)for(fd=g.n(Y.tracks),h=fd.next();!h.done;h=fd.next())if(X1=h.value,AI=g.$y(X1).entityId)Oo.has(AI)?(JI.set(AI,Oo.get(AI)),Oo.delete(AI)):uX.push(AI);lX=Number(((gV=V.actionMetadata)==null?void 0:gV.priority)||0)+1;az=g.n(Oo.entries());for(p=az.next();!p.done;p=
az.next())Jr=p.value,Ht=g.n(Jr),wT=Ht.next().value,HZ=Ht.next().value,sz=wT,Ml=HZ,D.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",sz,"musicTrack",lX,Rv,fQ(V,Ml)));ZZ=g.n(JI.entries());for(Mk=ZZ.next();!Mk.done;Mk=ZZ.next())f=Mk.value,a=g.n(f),v=a.next().value,E=a.next().value,d=v,Hh=E,D.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",d,"musicTrack",lX,Rv,fQ(V,Hh)));B=g.n(uX);for(A=B.next();!A.done;A=B.next())jV=A.value,D.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",jV,"musicTrack",0,Rv));
return op.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,D))}})},WEW=function(O,V){var J,y;
return g.Q(function(l){switch(l.j){case 1:return J=$w(V),l.W(2),y=g.$y(V.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?l.K(pQ(O.K,V,O.U),5):l.K(bq(y,"musicAlbumRelease",O.K,V,O.U),6);case 6:return l.K(kpW(O.K,V.entityKey),5);case 5:l.S(3);break;case 2:return l.D(),l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},FEn=function(O,V,J){var y,l,m;
return g.Q(function(H){switch(H.j){case 1:return H.K(JFn([V]),2);case 2:return y=H.U,H.K(Unz(O,y[0],J),3);case 3:return l=H.U,m=W1(l.thumbnailDetails),H.K(sY(m),4);case 4:return H.return(y[0].videos)}})},Unz=function(O,V,J){var y,l,m,H,F,N,x,W,U,Z,z,c,Y,b;
return g.Q(function(M){if(M.j==1){y=V.additionalMetadadatas;l=void 0;if(y&&y.length>0)for(m=g.n(y),H=m.next();!H.done;H=m.next())if(F=H.value,F.offlineMusicPlaylistData){l=F.offlineMusicPlaylistData;break}N=V.playlistId;x=SWz(V);W=x.TJ;U=x.Nm;Z=J?(Number(J)*1E3).toString():Date.now().toString();z=V.lastModifiedTimestamp?(Number(V.lastModifiedTimestamp)*1E3).toString():"0";c={id:g.Hq(N,"musicAlbumReleaseDownloadMetadataEntity"),trackDownloadMetadatas:U,lastModifiedTimestampMillis:z,addedTimestampMillis:Z,
syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"};Y={id:g.Hq(N,"musicAlbumRelease"),title:V.title,audioPlaylistId:N,trackCount:V.totalVideoCount,tracks:W,downloadMetadata:c.id};l&&(Y.thumbnailDetails=(b=l.albumHqThumbnail)!=null?b:l.albumArtistThumbnail,Y.artistDisplayName=l.albumArtistDisplayName,Y.releaseDate=l.albumReleaseDate,Y.contentRating={explicitType:l.albumReleaseExplicitType},Y.releaseType=l.albumReleaseType);return M.K(rm(O.K,{mode:"readwrite",cY:!0},function(w){var L=Kw(w,Y,"musicAlbumRelease");
w=Kw(w,c,"musicAlbumReleaseDownloadMetadataEntity");return g.WH.all([L,w])}),2)}return M.return(Y)})},ZZV=function(O,V){this.K=O;
this.U=V},c_n=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M;
return g.Q(function(w){switch(w.j){case 1:return J=$w(V),y=g.$y(V.entityKey),l=y.entityId,m=[],w.W(2),w.K(zGn(O,l),4);case 4:m=w.U;if((H=m)==null||!H.length){w.uw(5);break}return w.K(PTm(O.K,V.entityKey),5);case 5:w.S(3);break;case 2:return F=w.D(),N="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",F instanceof g.$P&&F.type==="QUOTA_EXCEEDED"&&(N="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",x="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),
w.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,N,x));case 3:return W=[],w.K(hLn(O.K,"musicTrack",m),7);case 7:m=w.U;if(m.length)for(U=g.n(m),Z=U.next();!Z.done;Z=U.next())if(z=Z.value,c=z.offlineVideoData,Y=void 0,(Y=c)==null?0:Y.videoId)b=void 0,M=Number(((b=V.actionMetadata)==null?void 0:b.priority)||0)+1,W.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",c.videoId,"musicTrack",M,B1,fQ(V,c,l)));return w.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,W))}})},
sZm=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo,md,xY,V7,Tr,Rp,ys,JI,uX,nn,im,fd,h,X1,AI,gV,lX,az,p,Jr,Ht,wT,HZ,sz,Ml,ZZ,Mk,f,a,v,E,d,Hh,B,A,jV,op,Bh,xE,w5,lm,bX,rT,hr,Rz,vh,fu,Uz;
return g.Q(function(Q7){switch(Q7.j){case 1:return J=$w(V),y=V.entityKey,l=g.$y(y).entityId,m=[],H=!1,l==="!*$_ALL_ENTITIES_!*$"?(H=!0,Q7.K(Br(O.K,"musicPlaylist"),5)):Q7.K(RA(O.K,y,"musicPlaylist"),4);case 4:(F=Q7.U)&&m.push(F);Q7.uw(3);break;case 5:m=Q7.U;case 3:if((N=m)==null||!N.length)return Q7.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));x=g.e(V.actionMetadata,Dqz);U=(W=x)==null?void 0:W.autoSync;Z=[];c=z=!0;Y=!1;b=void 0;if(!H&&U===!1){Q7.uw(6);break}Q7.W(7);return Q7.K(j8E(0,
!!U,!0,m),9);case 9:Z=Q7.U;Q7.S(8);break;case 7:M=Q7.D();if(!(M instanceof Error&&M.message==="No data")){M instanceof Error&&M.message==="Empty response body"&&OY(M.message);Q7.uw(8);break}return l==="!*$_ALL_ENTITIES_!*$"?Q7.K(pQ(O.K,V,O.U),8):Q7.K(bq(l,"musicPlaylist",O.K,V,O.U),8);case 8:if(!Z.length||!H&&Z[0].playlistId!==l)return Q7.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));case 6:if(H){w=[];L=g.n(Z);for(X=L.next();!X.done;X=L.next())u=X.value,u.upToDate||U&&!u.shouldAutoSyncMetadata||
!u.playlistId||(G={autoSync:U},w.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",u.playlistId,"musicPlaylist",0,B1,{musicPlaylistEntityActionMetadata:G})));return Q7.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,w))}Z.length&&(k=Z[0],Y=!!k.upToDate,U&&(z=(D=k.shouldAutoSyncMetadata)!=null?D:!0,c=(Oo=k.shouldAutoSyncVideos)!=null?Oo:!0,k.checkInSeconds&&(b=k.checkInSeconds)));if(Y||!z)return Q7.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));md=[];xY=m[0];V7=void 0;
if(!xY.downloadMetadata){Q7.uw(15);break}return Q7.K(RA(O.K,xY.downloadMetadata,"musicPlaylistDownloadMetadataEntity"),16);case 16:Tr=Q7.U,V7=Number((ys=(Rp=Tr)==null?void 0:Rp.addedTimestampMillis)!=null?ys:"0")/1E3;case 15:return Q7.W(17),Q7.K(zGn(O,l,(JI=V7)==null?void 0:JI.toString(),b),19);case 19:md=Q7.U;Q7.S(18);break;case 17:uX=Q7.D();if(!(uX instanceof Error&&uX.message==="No data")){if(uX instanceof Error&&uX.message==="Empty response body")OY(uX.message);else return nn="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",
im="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",uX instanceof g.$P&&uX.type==="QUOTA_EXCEEDED"&&(nn="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",im="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Q7.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,nn,im));Q7.uw(18);break}return Q7.K(bq(l,"musicPlaylist",O.K,V,O.U),18);case 18:if(!c)return Q7.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));fd=[];h=new Map;if((X1=md)==null?0:X1.length)for(AI=
g.n(md),gV=AI.next();!gV.done;gV=AI.next())lX=gV.value,az=lX.offlineVideoData,p=void 0,((p=az)==null?0:p.videoId)&&h.set(az.videoId,az);Jr=new Map;Ht=[];if((wT=xY)==null?0:(HZ=wT.tracks)==null?0:HZ.length)for(sz=g.n(xY.tracks),Ml=sz.next();!Ml.done;Ml=sz.next())if(ZZ=Ml.value,Mk=g.$y(ZZ).entityId)h.has(Mk)?(Jr.set(Mk,h.get(Mk)),h.delete(Mk)):Ht.push(Mk);a=Number(((f=V.actionMetadata)==null?void 0:f.priority)||0)+1;v=g.n(h.entries());for(E=v.next();!E.done;E=v.next())d=E.value,Hh=g.n(d),B=Hh.next().value,
A=Hh.next().value,jV=B,op=A,fd.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",jV,"musicTrack",a,B1,fQ(V,op)));Bh=g.n(Jr.entries());for(xE=Bh.next();!xE.done;xE=Bh.next())w5=xE.value,lm=g.n(w5),bX=lm.next().value,rT=lm.next().value,hr=bX,Rz=rT,fd.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",hr,"musicTrack",a,B1,fQ(V,Rz)));vh=g.n(Ht);for(fu=vh.next();!fu.done;fu=vh.next())Uz=fu.value,fd.push(wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",Uz,"musicTrack",0,B1));return Q7.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J,fd))}})},T7D=function(O,V){var J,y;
return g.Q(function(l){switch(l.j){case 1:return J=$w(V),l.W(2),y=g.$y(V.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?l.K(pQ(O.K,V,O.U),5):l.K(bq(y,"musicPlaylist",O.K,V,O.U),6);case 6:return l.K(kpW(O.K,V.entityKey),5);case 5:l.S(3);break;case 2:return l.D(),l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},zGn=function(O,V,J,y){var l,m,H;
return g.Q(function(F){switch(F.j){case 1:return F.K(JFn([V]),2);case 2:return l=F.U,F.K(eGm(O,l[0],J,y),3);case 3:return m=F.U,H=W1(m.thumbnailDetails),F.K(sY(H),4);case 4:return F.return(l[0].videos)}})},eGm=function(O,V,J,y){var l,m,H,F,N,x,W,U,Z;
return g.Q(function(z){return z.j==1?(l=V.playlistId,m=SWz(V),H=m.TJ,F=m.Nm,N=J?(Number(J)*1E3).toString():Date.now().toString(),x=V.lastModifiedTimestamp?(Number(V.lastModifiedTimestamp)*1E3).toString():"0",W={id:g.Hq(l,"musicPlaylistDownloadMetadataEntity"),trackDownloadMetadatas:F,lastModifiedTimestampMillis:x,addedTimestampMillis:N,syncState:"DOWNLOAD_SYNC_STATE_UP_TO_DATE"},U={id:g.Hq(l,"musicPlaylist"),title:V.title,playlistId:l,thumbnailDetails:V.thumbnail,visibility:I0F(V),trackCount:V.totalVideoCount,
tracks:H,downloadMetadata:W.id},y&&(((Z=U)==null?0:Z.entityMetadata)?U.entityMetadata.nextAutoRefreshIntervalSeconds=String(y):U&&(U.entityMetadata={nextAutoRefreshIntervalSeconds:String(y)})),z.K(rm(O.K,{mode:"readwrite",cY:!0},function(c){var Y=Kw(c,U,"musicPlaylist");c=Kw(c,W,"musicPlaylistDownloadMetadataEntity");return g.WH.all([Y,c])}),2)):z.return(U)})},I0F=function(O){switch(O.privacy){case "PRIVATE":return"PLAYLIST_ENTITY_VISIBILITY_PRIVATE";
case "PUBLIC":return"PLAYLIST_ENTITY_VISIBILITY_PUBLIC";case "UNLISTED":return"PLAYLIST_ENTITY_VISIBILITY_UNLISTED";default:return"PLAYLIST_ENTITY_VISIBILITY_UNKNOWN"}},Y7W=function(O,V){this.K=O;
this.U=V},f0y=function(O,V){var J,y,l,m,H,F,N,x,W,U,Z,z,c;
return g.Q(function(Y){switch(Y.j){case 1:return J=$w(V),y=g.$y(V.entityKey),l=y.entityId,m=g.e(V.actionMetadata,a0z),Y.W(2),Y.K(bZz(O,l,void 0,(H=m)==null?void 0:H.track,(F=m)==null?void 0:F.albumRelease),4);case 4:if((N=m)==null?0:N.playlistId){Y.uw(5);break}return Y.K(PTm(O.K,V.entityKey),5);case 5:Y.S(3);break;case 2:return x=Y.D(),W="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",U="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",x instanceof g.$P&&x.type==="QUOTA_EXCEEDED"&&(W="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
U="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),Y.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,W,U));case 3:z=Number(((Z=V.actionMetadata)==null?void 0:Z.priority)||0)+1;var b=(b=g.e(V.actionMetadata,a0z))?{playbackDataActionMetadata:{maximumDownloadQuality:b.maximumDownloadQuality}}:void 0;c=wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",l,"playbackData",z,pyd,b);return Y.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,[c]))}})},hGz=function(O,V){var J,y,l,
m,H,F,N,x,W,U,Z,z,c,Y,b;
return g.Q(function(M){switch(M.j){case 1:return J=$w(V),y=g.$y(V.entityKey),l=y.entityId,M.K(RA(O.K,V.entityKey,"musicTrack"),2);case 2:m=M.U;if(!m){H=void 0;M.uw(3);break}return M.K(RA(O.K,m.downloadMetadata,"musicTrackDownloadMetadataEntity"),4);case 4:H=M.U;case 3:F=H;if(!m||!F)return M.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J));x=g.e(V.actionMetadata,a0z);M.W(5);return M.K(bZz(O,l,F.addedTimestampMillis,(W=x)==null?void 0:W.track,(U=x)==null?void 0:U.albumRelease),7);case 7:z=
Number(((Z=V.actionMetadata)==null?void 0:Z.priority)||0)+1;N=wK("OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH",l,"playbackData",z,pyd);M.S(6);break;case 5:c=M.D();if(!(c instanceof Error&&c.message==="No data")){if(c instanceof Error&&c.message==="Empty response body")OY(c.message);else return Y="OFFLINE_OPERATION_FAILURE_REASON_UNKNOWN",b="OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED",c instanceof g.$P&&c.type==="QUOTA_EXCEEDED"&&(Y="OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED",
b="OFFLINE_ORCHESTRATION_FAILURE_REASON_NO_STORAGE"),M.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,Y,b));M.uw(6);break}return M.K(av(l,O.K,V,O.U),6);case 6:return M.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",J,N?[N]:void 0))}})},o6z=function(O,V){var J,y;
return g.Q(function(l){switch(l.j){case 1:return J=$w(V),l.W(2),y=g.$y(V.entityKey).entityId,y==="!*$_ALL_ENTITIES_!*$"?l.K(pQ(O.K,V,O.U),5):l.K(av(y,O.K,V,O.U),6);case 6:return l.K(kpW(O.K,V.entityKey),5);case 5:l.S(3);break;case 2:return l.D(),l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_FAILURE",J,void 0,"OFFLINE_OPERATION_FAILURE_REASON_DATABASE_REQUEST_FAILED","OFFLINE_ORCHESTRATION_FAILURE_REASON_DATABASE_OPERATION_FAILED"));case 3:return l.return(new MG("OFFLINE_ORCHESTRATION_ACTION_RESULT_SUCCESS",
J))}})},bZz=function(O,V,J,y,l){var m,H,F,N,x,W;
return g.Q(function(U){switch(U.j){case 1:if(m=y){U.uw(2);break}return U.K(VTz([V]),3);case 3:H=U.U,F=H[0],m=BqV(F);case 2:return U.K(v6C(O,m,V,l,J),4);case 4:N=U.U;x=N.musicTrackEntity;W=N.gU;var Z=U.K,z=W1(x.thumbnailDetails),c=[];W&&(c=W1(W.thumbnailDetails));return Z.call(U,sY(z.concat(c)),0)}})},v6C=function(O,V,J,y,l){var m;
return g.Q(function(H){return H.j==1?(l||(l=Date.now().toString()),m={id:g.Hq(J,"musicTrackDownloadMetadataEntity"),playbackData:g.Hq(J,"playbackData"),addedTimestampMillis:l,videoDownloadContextEntity:g.Hq(J,"videoDownloadContextEntity")},y&&(V.albumRelease=y.id),H.K(rm(O.K,{mode:"readwrite",cY:!0},function(F){var N=[],x=Kw(F,m,"musicTrackDownloadMetadataEntity");N.push(x);x=Kw(F,V,"musicTrack");N.push(x);y&&(F=Kw(F,y,"musicAlbumRelease"),N.push(F));return g.WH.all(N)}),2)):H.j!=3?H.K(F8(J,"musicTrackDownloadMetadataEntity",
O.K,"DOWNLOAD_STATE_PENDING_DOWNLOAD"),3):H.return({musicTrackEntity:V,
gU:y})})},P1=function(){uq.apply(this,arguments);
this.qX="musicTrack"},wyz=function(O,V,J){V=V===void 0?43200:V;
J=J===void 0?!0:J;var y=y===void 0?!1:y;var l,m;return g.Q(function(H){switch(H.j){case 1:if(!O.V.fE())return H.return([]);l=[];H.W(2);return H.K(j8E(V,J,y),4);case 4:l=H.U;H.S(3);break;case 2:H.D();case 3:return m=dEE(O,l,J,"musicPlaylist"),H.return(m)}})},MLD=function(){g.zm.apply(this,arguments);
var O=this;this.events=new g.jX(this);this.B=this.player.Y();this.Ty={ZJX:function(){return O.K},
Yo:function(){return O.Yo()},
wT:function(V){return O.wT(V)}}},LEV=function(O){var V;
O=g.e((V=O.getWatchNextResponse())==null?void 0:V.currentVideoEndpoint,g.eW);if(O==null?0:O.playlistId)var J=O.playlistId;return J},n6z=function(O,V){var J,y,l,m;
return g.Q(function(H){if(H.j==1){J=V.clientPlaybackNonce;y={cpn:J,offlineSourceVisualElement:g.$b(V.KD||"").getAsJson(),selectedOfflineMode:"OFFLINE_NOW",isPartialPlayback:!1};V.j&&(y.videoFmt=Number(V.j.itag));V.D&&(y.audioFmt=Number(V.D.itag));if((l=LEV(V))&&V.videoId){var F=H.K;var N=V.videoId;N=l!=="PPSV"?Promise.resolve(!1):O.K.Ke(N);H=F.call(H,N,3)}else H=H.uw(2);return H}H.j!=2&&(m=H.U)&&(y.selectedOfflineMode="OFFLINE_MODE_TYPE_AUTO_OFFLINE");O.j=J;g.l6("offlinePlaybackStarted",y);H.V()})};
g.t1.prototype.Gc=g.g5(41,function(O){return this.app.Gc(O)});
g.Zv.prototype.Gc=g.g5(40,function(O){return g.ohr(this,9,O)});
g.I(nw,Lw);g.tr.Object.defineProperties(nw.prototype,{entityMetadata:{configurable:!0,enumerable:!0,get:function(){return this.K.entityMetadata},
set:function(O){this.K.entityMetadata=O}}});
g.I(TbW,nw);TbW.prototype.j=function(){return[]};
g.I(eNd,nw);eNd.prototype.j=function(){return[]};
g.I(ILW,nw);ILW.prototype.j=function(){return[]};
g.I(Ydz,nw);Ydz.prototype.j=function(){return[]};
g.I(aLC,nw);aLC.prototype.j=function(){return[]};
g.I(bpy,nw);bpy.prototype.j=function(){var O=[];this.K.alternateChannel&&O.push(this.K.alternateChannel);this.K.alternateChannelList&&O.push.apply(O,g.q(this.K.alternateChannelList));this.K.oneofChannelEntity&&O.push(this.K.oneofChannelEntity);return[].concat(g.q(new Set(O)))};
g.I(p$F,nw);p$F.prototype.j=function(){var O=[];this.K.entryCollection&&O.push(this.K.entryCollection);return[].concat(g.q(new Set(O)))};
g.I(fLy,Lw);fLy.prototype.j=function(){var O=[];this.K.video&&O.push(this.K.video);return[].concat(g.q(new Set(O)))};
g.I(hNd,nw);hNd.prototype.j=function(){var O=[];this.K.parentPlaylist&&O.push(this.K.parentPlaylist);if(this.K.entries)for(var V=g.n(this.K.entries),J=V.next();!J.done;J=V.next())O.push.apply(O,g.q((new fLy(J.value)).j()));return[].concat(g.q(new Set(O)))};
g.I(oIm,nw);oIm.prototype.j=function(){var O=[];this.K.descriptionEntity&&O.push(this.K.descriptionEntity);this.K.creators&&O.push.apply(O,g.q(this.K.creators));this.K.theBiggestFan&&O.push(this.K.theBiggestFan);return[].concat(g.q(new Set(O)))};
g.I(vID,nw);vID.prototype.j=function(){return[]};
g.I(w$D,nw);w$D.prototype.j=function(){return[]};
g.I(MHn,nw);MHn.prototype.j=function(){return[]};
g.I(Lhd,nw);Lhd.prototype.j=function(){return[]};
g.I(nIF,nw);nIF.prototype.j=function(){return[]};
g.I(X$E,nw);X$E.prototype.j=function(){return[]};
g.I(EIz,nw);EIz.prototype.j=function(){return[]};
g.I(dBz,nw);dBz.prototype.j=function(){return[]};
g.I(gIE,nw);gIE.prototype.j=function(){return[]};
g.I(qdz,nw);qdz.prototype.j=function(){var O=[];this.K.downloadsList&&O.push(this.K.downloadsList);this.K.smartDownloadsList&&O.push(this.K.smartDownloadsList);this.K.recommendedDownloadsList&&O.push(this.K.recommendedDownloadsList);this.K.refresh&&O.push(this.K.refresh);return[].concat(g.q(new Set(O)))};
g.I(QLI,Lw);QLI.prototype.j=function(){var O=[];this.K.video&&O.push(this.K.video);this.K.playlist&&O.push(this.K.playlist);this.K.videoItem&&O.push(this.K.videoItem);this.K.playlistItem&&O.push(this.K.playlistItem);return[].concat(g.q(new Set(O)))};
g.I(Gun,nw);Gun.prototype.j=function(){var O=[];this.K.refresh&&O.push(this.K.refresh);if(this.K.downloads)for(var V=g.n(this.K.downloads),J=V.next();!J.done;J=V.next())O.push.apply(O,g.q((new QLI(J.value)).j()));return[].concat(g.q(new Set(O)))};
g.I(KhE,nw);KhE.prototype.j=function(){var O=[];this.K.localImageEntities&&O.push.apply(O,g.q(this.K.localImageEntities));return[].concat(g.q(new Set(O)))};
g.I(tHz,nw);tHz.prototype.j=function(){var O=[];this.K.playbackData&&O.push(this.K.playbackData);this.K.localImageEntities&&O.push.apply(O,g.q(this.K.localImageEntities));this.K.videoDownloadContextEntity&&O.push(this.K.videoDownloadContextEntity);return[].concat(g.q(new Set(O)))};
g.I(uTI,nw);uTI.prototype.j=function(){return[]};
g.I(AZn,nw);AZn.prototype.j=function(){var O=[];this.K.fakeChildren&&O.push.apply(O,g.q(this.K.fakeChildren));return[].concat(g.q(new Set(O)))};
g.I(rZz,nw);rZz.prototype.j=function(){var O=[];this.K.video&&O.push(this.K.video);this.K.playbackData&&O.push(this.K.playbackData);this.K.offlineVideoPolicy&&O.push(this.K.offlineVideoPolicy);return[].concat(g.q(new Set(O)))};
g.I(ipV,nw);ipV.prototype.j=function(){return[]};
g.I(RND,nw);RND.prototype.j=function(){var O=[];this.K.channelOwner&&O.push(this.K.channelOwner);this.K.videos&&O.push.apply(O,g.q(this.K.videos));this.K.collaboratorChannels&&O.push.apply(O,g.q(this.K.collaboratorChannels));this.K.downloadState&&O.push(this.K.downloadState);this.K.refresh&&O.push(this.K.refresh);return[].concat(g.q(new Set(O)))};
g.I(Bbz,nw);Bbz.prototype.j=function(){var O=[];this.K.video&&O.push(this.K.video);this.K.channelContributor&&O.push(this.K.channelContributor);return[].concat(g.q(new Set(O)))};
g.I(Pp1,Lw);Pp1.prototype.j=function(){var O=[];this.K.localImageEntities&&O.push.apply(O,g.q(this.K.localImageEntities));this.K.videoDownloadContextEntity&&O.push(this.K.videoDownloadContextEntity);return[].concat(g.q(new Set(O)))};
g.I(kum,Lw);kum.prototype.j=function(){var O=[];this.K.recommendedVideoMetadata&&O.push.apply(O,g.q((new Pp1(this.K.recommendedVideoMetadata)).j()));return[].concat(g.q(new Set(O)))};
g.I(SdV,Lw);SdV.prototype.j=function(){var O=[];this.K.playbackPosition&&O.push(this.K.playbackPosition);return[].concat(g.q(new Set(O)))};
g.I(DBW,nw);DBW.prototype.j=function(){var O=[];this.K.owner&&O.push(this.K.owner);this.K.downloadState&&O.push(this.K.downloadState);this.K.userState&&O.push.apply(O,g.q((new SdV(this.K.userState)).j()));this.K.additionalMetadata&&O.push.apply(O,g.q((new kum(this.K.additionalMetadata)).j()));return[].concat(g.q(new Set(O)))};
g.I(O1I,nw);O1I.prototype.j=function(){var O=[];this.K.userChannelDetails&&O.push(this.K.userChannelDetails);return[].concat(g.q(new Set(O)))};
g.I(VDy,nw);VDy.prototype.j=function(){var O=[];this.K.channelOwner&&O.push(this.K.channelOwner);this.K.playbackPosition&&O.push(this.K.playbackPosition);this.K.localImageEntities&&O.push.apply(O,g.q(this.K.localImageEntities));this.K.downloadStatus&&O.push(this.K.downloadStatus);return[].concat(g.q(new Set(O)))};
g.I(J6V,nw);J6V.prototype.j=function(){return[]};
g.I(y6n,nw);y6n.prototype.j=function(){return[]};
g.I(lqd,nw);lqd.prototype.j=function(){return[]};
g.I(mxs,nw);mxs.prototype.j=function(){return[]};
g.I($xz,nw);$xz.prototype.j=function(){return[]};
g.I(H1z,nw);H1z.prototype.j=function(){return[]};
g.I(jhy,nw);jhy.prototype.j=function(){return[]};
g.I(CIn,nw);CIn.prototype.j=function(){return[]};
g.I(FKz,nw);FKz.prototype.j=function(){return[]};
g.I(NfI,nw);NfI.prototype.j=function(){return[]};
g.I(xxs,nw);xxs.prototype.j=function(){return[]};
g.I(WKz,nw);WKz.prototype.j=function(){return[]};
g.I(Uxs,nw);Uxs.prototype.j=function(){return[]};
g.I(Z1s,nw);Z1s.prototype.j=function(){var O=[];this.K.compositeSourceKeys&&O.push.apply(O,g.q(this.K.compositeSourceKeys));return[].concat(g.q(new Set(O)))};
g.I(z3d,nw);z3d.prototype.j=function(){var O=[];this.K.trackDownloadMetadatas&&O.push.apply(O,g.q(this.K.trackDownloadMetadatas));return[].concat(g.q(new Set(O)))};
g.I(c6n,nw);
c6n.prototype.j=function(){var O=[];this.K.downloadedTracks&&O.push.apply(O,g.q(this.K.downloadedTracks));this.K.smartDownloadedTracks&&O.push.apply(O,g.q(this.K.smartDownloadedTracks));this.K.downloadedEpisodes&&O.push.apply(O,g.q(this.K.downloadedEpisodes));this.K.downloadedAlbumReleases&&O.push.apply(O,g.q(this.K.downloadedAlbumReleases));this.K.smartDownloadedAlbumReleases&&O.push.apply(O,g.q(this.K.smartDownloadedAlbumReleases));this.K.downloadedPlaylists&&O.push.apply(O,g.q(this.K.downloadedPlaylists));this.K.smartDownloadedPlaylists&&
O.push.apply(O,g.q(this.K.smartDownloadedPlaylists));this.K.metadataOnlyTracks&&O.push.apply(O,g.q(this.K.metadataOnlyTracks));return[].concat(g.q(new Set(O)))};
g.I(shn,nw);shn.prototype.j=function(){var O=[];this.K.trackDownloadMetadatas&&O.push.apply(O,g.q(this.K.trackDownloadMetadatas));return[].concat(g.q(new Set(O)))};
g.I(Tfz,nw);Tfz.prototype.j=function(){var O=[];this.K.playbackData&&O.push(this.K.playbackData);this.K.localImageEntities&&O.push.apply(O,g.q(this.K.localImageEntities));this.K.videoDownloadContextEntity&&O.push(this.K.videoDownloadContextEntity);return[].concat(g.q(new Set(O)))};
g.I(e3V,nw);e3V.prototype.j=function(){var O=[];this.K.musicLibraryStatusEntity&&O.push(this.K.musicLibraryStatusEntity);this.K.primaryArtists&&O.push.apply(O,g.q(this.K.primaryArtists));this.K.details&&O.push(this.K.details);this.K.userDetails&&O.push(this.K.userDetails);this.K.tracks&&O.push.apply(O,g.q(this.K.tracks));this.K.share&&O.push(this.K.share);this.K.downloadMetadata&&O.push(this.K.downloadMetadata);this.K.refresh&&O.push(this.K.refresh);return[].concat(g.q(new Set(O)))};
g.I(Iqs,nw);Iqs.prototype.j=function(){var O=[];this.K.albumRelease&&O.push(this.K.albumRelease);this.K.tracks&&O.push.apply(O,g.q(this.K.tracks));return[].concat(g.q(new Set(O)))};
g.I(YLs,nw);YLs.prototype.j=function(){var O=[];this.K.albumRelease&&O.push(this.K.albumRelease);return[].concat(g.q(new Set(O)))};
g.I(aqE,nw);aqE.prototype.j=function(){var O=[];this.K.details&&O.push(this.K.details);this.K.userDetails&&O.push(this.K.userDetails);return[].concat(g.q(new Set(O)))};
g.I(b1D,nw);b1D.prototype.j=function(){var O=[];this.K.parentArtist&&O.push(this.K.parentArtist);return[].concat(g.q(new Set(O)))};
g.I(plW,nw);plW.prototype.j=function(){var O=[];this.K.parentArtist&&O.push(this.K.parentArtist);return[].concat(g.q(new Set(O)))};
g.I(fqz,nw);fqz.prototype.j=function(){return[]};
g.I(h3s,nw);h3s.prototype.j=function(){return[]};
g.I(ouE,Lw);ouE.prototype.j=function(){var O=[];this.K.creatorEntity&&O.push(this.K.creatorEntity);return[].concat(g.q(new Set(O)))};
g.I(vuy,nw);
vuy.prototype.j=function(){var O=[];this.K.tracks&&O.push.apply(O,g.q(this.K.tracks));this.K.refresh&&O.push(this.K.refresh);this.K.musicLibraryStatusEntity&&O.push(this.K.musicLibraryStatusEntity);this.K.details&&O.push(this.K.details);this.K.downloadMetadata&&O.push(this.K.downloadMetadata);this.K.sideloadMetadata&&O.push(this.K.sideloadMetadata);this.K.userDetails&&O.push(this.K.userDetails);this.K.entryCollection&&O.push(this.K.entryCollection);this.K.share&&O.push(this.K.share);this.K.podcastShowAdditionalMetadata&&O.push.apply(O,
g.q((new ouE(this.K.podcastShowAdditionalMetadata)).j()));return[].concat(g.q(new Set(O)))};
g.I(wly,nw);wly.prototype.j=function(){return[]};
g.I(MDs,nw);
MDs.prototype.j=function(){var O=[];this.K.musicLibraryStatusEntity&&O.push(this.K.musicLibraryStatusEntity);this.K.artists&&O.push.apply(O,g.q(this.K.artists));this.K.audioModeVersion&&O.push(this.K.audioModeVersion);this.K.videoModeVersion&&O.push(this.K.videoModeVersion);this.K.userDetails&&O.push(this.K.userDetails);this.K.details&&O.push(this.K.details);this.K.albumRelease&&O.push(this.K.albumRelease);this.K.share&&O.push(this.K.share);this.K.libraryEdit&&O.push(this.K.libraryEdit);this.K.downloadMetadata&&
O.push(this.K.downloadMetadata);this.K.playbackPosition&&O.push(this.K.playbackPosition);this.K.lyrics&&O.push(this.K.lyrics);return[].concat(g.q(new Set(O)))};
g.I(LKF,nw);LKF.prototype.j=function(){var O=[];this.K.parentTrack&&O.push(this.K.parentTrack);return[].concat(g.q(new Set(O)))};
g.I(nu1,nw);nu1.prototype.j=function(){var O=[];this.K.parentTrack&&O.push(this.K.parentTrack);return[].concat(g.q(new Set(O)))};
g.I(Xlz,nw);Xlz.prototype.j=function(){return[]};
g.I(Eud,nw);Eud.prototype.j=function(){return[]};
g.I(dxW,nw);dxW.prototype.j=function(){return[]};
g.I(guz,nw);guz.prototype.j=function(){return[]};
g.I(qLz,nw);qLz.prototype.j=function(){var O=[];this.K.transfer&&O.push(this.K.transfer);this.K.adsPlaybackData&&O.push.apply(O,g.q(this.K.adsPlaybackData));this.K.drmLicense&&O.push(this.K.drmLicense);this.K.offlineVideoPolicy&&O.push(this.K.offlineVideoPolicy);this.K.videoDownloadContextEntity&&O.push(this.K.videoDownloadContextEntity);return[].concat(g.q(new Set(O)))};
g.I(Qhz,nw);Qhz.prototype.j=function(){return[]};
g.I(GOD,nw);GOD.prototype.j=function(){var O=[];this.K.offlineVideoStreams&&O.push.apply(O,g.q(this.K.offlineVideoStreams));this.K.captionTrack&&O.push.apply(O,g.q(this.K.captionTrack));return[].concat(g.q(new Set(O)))};
g.I(KKd,nw);KKd.prototype.j=function(){return[]};
g.I(tDy,nw);tDy.prototype.j=function(){return[]};
g.I(uMn,nw);uMn.prototype.j=function(){return[]};
g.I(A6s,nw);A6s.prototype.j=function(){return[]};
g.I(r6z,nw);r6z.prototype.j=function(){return[]};
g.I(i1I,nw);i1I.prototype.j=function(){return[]};
g.I(R3D,nw);R3D.prototype.j=function(){return[]};
g.I(BfE,nw);BfE.prototype.j=function(){return[]};
g.I(PIz,nw);PIz.prototype.j=function(){return[]};
g.I(kOW,nw);kOW.prototype.j=function(){return[]};
g.I(SLs,nw);SLs.prototype.j=function(){return[]};
g.I(DxC,nw);DxC.prototype.j=function(){return[]};
g.I(Oim,nw);Oim.prototype.j=function(){return[]};
g.I(Vam,nw);Vam.prototype.j=function(){return[]};
g.I(Jbm,nw);Jbm.prototype.j=function(){return[]};
g.I(ybz,nw);ybz.prototype.j=function(){return[]};
g.I(lBV,nw);lBV.prototype.j=function(){return[]};
g.I(m$C,nw);m$C.prototype.j=function(){return[]};
g.I($$E,nw);$$E.prototype.j=function(){return[]};
g.I(Hiz,nw);Hiz.prototype.j=function(){return[]};
g.I(jV1,nw);jV1.prototype.j=function(){return[]};
g.I(CDV,nw);CDV.prototype.j=function(){return[]};
var CFn=["browse","music/browse","streaming_browse","unplugged/browse"],UUD=["offline/playlist_sync_check"],O3y=["offline"],FSE=["offline/offline_video_playback_position_sync"],xUs=["offline/get_playback_data_entity"];Xx.getInstance=function(){return g.Q(function(O){return O.return(new Promise(function(V){g.Gf().then(function(J){J?(Xx.instance||(Xx.instance=new Xx(J)),V(Xx.instance)):V(void 0)})}))})};
Xx.prototype.get=function(O){var V=this,J,y,l;return g.Q(function(m){if(m.j==1)return m.K(FzV(V.token),2);if(m.j!=3)return J=m.U,m.K(J.get("prefs",O),3);y=m.U;if(!y)return m.return();l=(0,g.cH)();return y.expirationTimestampMs<=l?m.return():m.return(y.value)})};
Xx.prototype.set=function(O,V,J){J=J===void 0?31536E3:J;var y=this,l,m,H;return g.Q(function(F){if(F.j==1)return l=(0,g.cH)(),m={key:O,value:V,expirationTimestampMs:l+J*1E3},F.K(FzV(y.token),2);H=F.U;return F.K(H.put("prefs",m),0)})};
Xx.prototype.remove=function(O){var V=this,J;return g.Q(function(y){if(y.j==1)return y.K(FzV(V.token),2);J=y.U;return y.K(J.delete("prefs",O),0)})};
var EU;g.I(dm,g.pn);g.I(gm,sVn);gm.prototype.U=function(O,V){V=ejz(V);O=(new TextEncoder).encode(JSON.stringify(O));return this.K.encrypt(O,V)};
gm.prototype.j=function(O,V){if(!(O instanceof Uint8Array))throw U$F(1);var J=new TextDecoder;V=ejz(V);O=this.K.decrypt(O,V);return JSON.parse(J.decode(O))};
var IBW={accountLinkStatusEntity:MHn,booleanEntity:Ydz,buttonEntity:Jbm,captionTrack:Xlz,channelHandle:TbW,chipEntity:R3D,commerceAcquisitionClientPayloadEntity:lBV,commerceCartListEntity:m$C,compositeSourceEntity:Uxs,multiviewStagingEntity:Z1s,contextNoteFeedEntityPayload:eNd,contextNoteUserRatingEntityPayload:ILW,continuationTokenEntity:ipV,downloadQualityPickerEntity:EIz,downloadsPageRefreshTokenEntity:gIE,downloadsPageViewConfigurationEntity:J6V,downloadStatusEntity:dBz,dismissState:BfE,sfvAudioItemCurrentlyPlayingEntity:A6s,
emojiFountainDataEntity:Oim,emojiCustomizationSetEntity:DxC,fakeChannel:bpy,fakePlaylist:p$F,fakePlaylistEntryCollection:hNd,fakeVideo:oIm,fakeVideoDescription:vID,featuredProductsEntity:NfI,flowStateEntity:w$D,iconBadgeEntity:$$E,interstitialInteractionStateEntity:nIF,likeButtonAnimationEntity:y6n,liveChatPollStateEntity:X$E,dataFreshnessEntity:SLs,liveViewerLeaderboardChatEntryPointStateEntity:tDy,liveViewerLeaderboardPointsEntity:uMn,liveReactionsDataEntity:Vam,logoEntity:Lhd,macroMarkerEntity:lqd,
mainDownloadsLibraryEntity:qdz,mainDownloadsListEntity:Gun,mainPlaylistDownloadStateEntity:KhE,mainPlaylistEntity:RND,mainPlaylistVideoEntity:Bbz,mainVideoDownloadStateEntity:tHz,mainVideoEntity:DBW,markersEngagementPanelSyncEntity:mxs,markersVisibilityOverrideEntity:$xz,musicAlbumReleaseDetail:Iqs,musicAlbumReleaseDownloadMetadataEntity:z3d,musicAlbumRelease:e3V,musicAlbumReleaseUserDetail:YLs,musicArtistDetail:b1D,musicArtist:aqE,musicArtistUserDetail:plW,musicDownloadsLibraryEntity:c6n,musicLibraryEdit:fqz,
musicLibraryStatusEntity:h3s,musicPlaylist:vuy,musicPlaylistDownloadMetadataEntity:shn,musicShare:wly,musicTrackDetail:LKF,musicTrackDownloadMetadataEntity:Tfz,musicTrack:MDs,musicTrackUserDetail:nu1,offlineOrchestrationActionWrapperEntity:Eud,offlineVideoPolicy:dxW,offlineVideoStreams:guz,offlineabilityEntity:uTI,orchestrationWebSamplingEntity:AZn,pageHeaderEntity:PIz,pdpStateEntity:Hiz,pinnedProductEntity:xxs,playbackData:qLz,playerStateEntity:H1z,quantityIncrementerEntity:jV1,refresh:Qhz,saveToPlaylistListEntity:r6z,
selectedChipIndexEntityPayload:jhy,settingEntity:i1I,stringEntity:aLC,suggestedFeedbackChipStateEntity:CIn,transfer:GOD,trendingOfferEntity:WKz,videoDownloadContextEntity:KKd,videoOverviewAsyncDataEntity:CDV,videoPlaybackPositionEntity:ybz,votingEntity:kOW,ytMainChannelEntity:O1I,youchatPendingResponseEntity:FKz,ytMainDownloadedVideoEntity:rZz,ytMainVideoEntity:VDy};g.I(ux,sVn);ux.prototype.U=function(O){return O};
ux.prototype.j=function(O){if(O instanceof Uint8Array)throw U$F(0);return O};
g.I(AL,g.K);AL.prototype.observe=function(O){var V=this;this.observers.push(O);return function(){var J=V.observers.indexOf(O);J>=0&&V.observers.splice(J,1)}};
AL.prototype.j=function(O){EQy(this,O.data)};
AL.prototype.U5=function(){this.channel.close()};
var G7F;var qWF=new g.YC("elementsCommand");var eb=new g.YC("entityBatchUpdate");var fls=new g.YC("downloadStatusEntity");var tJC=new g.YC("mainPlaylistEntityActionMetadata");var iq=new g.YC("mainVideoEntityActionMetadata");var Dqz=new g.YC("musicPlaylistEntityActionMetadata");var a0z=new g.YC("musicTrackEntityActionMetadata");var Q_1=new g.YC("offlineOrchestrationActionCommand");var l0z=new g.YC("localImageEntityActionMetadata");var LQ=new g.YC("playbackDataActionMetadata");var Q8m=new g.YC("transferEntityActionMetadata");var pus=new g.YC("videoPlaybackPositionEntityActionMetadata");var JBd;g.Hq("","downloadsPageViewConfigurationEntity");g.Hq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");var Iv=g.Hq("DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS","mainDownloadsListEntity");g.Hq("DOWNLOADS_LIST_ENTITY_ID_SMART_DOWNLOADS","refresh");g.Hq("SMART_DOWNLOADS_ENABLED","settingEntity");new g.HP;new g.HP;Hqz.prototype.request=function(O,V,J){V=V===void 0?{}:V;return this.locks.request(O,V,function(y){return J(y)})};var Dh=g.Z1.caches,S2,xqI;kh.prototype.open=function(O){return Dh.open(FUs(O))};
kh.prototype.has=function(O){return Dh.has(FUs(O))};
kh.prototype.delete=function(O){return Dh.delete(FUs(O))};
kh.prototype.match=function(O,V){var J=this,y,l,m,H,F,N;return g.Q(function(x){switch(x.j){case 1:return x.K(J.keys(),2);case 2:y=x.U,l=g.n(y),m=l.next();case 3:if(m.done){x.uw(5);break}H=m.value;return x.K(J.open(H),6);case 6:return F=x.U,x.K(F.match(O,V),7);case 7:if(N=x.U)return x.return(N);m=l.next();x.uw(3);break;case 5:return x.return()}})};
g.I(CTz,kh);CTz.prototype.keys=function(){var O,V,J,y,l,m,H,F,N;return g.Q(function(x){if(x.j==1)return O=[],V=g.Gb("CacheStorage keys"),x.K(Dh.keys(),2);J=x.U;y=g.n(J);for(l=y.next();!l.done;l=y.next()){m=l.value;var W=m.indexOf(":");H=W===-1?{NR:m}:{NR:m.substring(0,W),datasyncId:m.substring(W+1)};F=H.NR;N=H.datasyncId;N===V&&O.push(F)}return x.return(O)})};g.I(Vu,g.K);Vu.prototype.U=function(O){this.api.MX("onOfflineOperationFailure",O.data)};
Vu.prototype.D=function(O){this.api.publish("offlinetransferpause",O.data)};
Vu.prototype.U5=function(){var O;(O=this.K)==null||O.close();var V;(V=this.j)==null||V.close()};ZqC.prototype.D_=function(){this.K&&yu(this)};
ZqC.prototype.xv=function(){this.j&&this.j.resolve();this.U=this.K=!1;this.qX()};var JXC=["OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"];var E9D="captionTrack downloadStatusEntity ytMainChannelEntity mainPlaylistEntity mainPlaylistDownloadStateEntity mainPlaylistVideoEntity mainVideoEntity mainVideoDownloadStateEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity videoPlaybackPositionEntity".split(" ");var RLd="downloadStatusEntity musicAlbumRelease musicDownloadsLibraryEntity musicPlaylist musicTrack musicTrackDownloadMetadataEntity offlineVideoPolicy offlineVideoStreams playbackData transfer videoDownloadContextEntity".split(" ");g.I(zhI,v1);zhI.prototype.j=function(O){return H1(O)?T4E(this,O):jb(O)?YTF(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};g.I(aWV,v1);aWV.prototype.j=function(O){return jb(O)?b3y(this,O):pG1(O)?fWy(this,O):CQ(O)?hhD(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};g.T=oSz.prototype;g.T.SAN=function(O){var V=this,J,y,l,m;return g.Q(function(H){if(!g.R(O.state,128))return H.uw(0);J=O.state.o5;var F=(y=J)==null?void 0:y.errorCode,N=(l=J)==null?void 0:l.vj;m=F==="net.connect"&&N===1?"TRANSFER_FAILURE_REASON_NETWORK_LOST":(F==null?0:F.startsWith("net."))?"TRANSFER_FAILURE_REASON_NETWORK":"TRANSFER_FAILURE_REASON_INTERNAL";return H.K(V.Sm(V.player.getVideoData().videoId,m),0)})};
g.T.Sm=function(O,V){var J=this;return g.Q(function(y){if(y.j==1){if(J.j)return y.return();J.j=!0;return V==="TRANSFER_FAILURE_REASON_NETWORK_LOST"?(EY(J,O,!1,!0),y.uw(0)):y.K(X8(J,O),3)}g.Oy(O,4);return y.K(J.K.Sm(V),0)})};
g.T.cR=function(O){O.status===2?(O.status!==this.U&&(aNn(this.K),g.Oy(O.videoId,2)),O.K8&&oUs(this.K,O.videoId,O.K8)):O.status===4?(X8(this,O.videoId),this.Sm(O.videoId,O.fT?"TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":"TRANSFER_FAILURE_REASON_INTERNAL")):O.status===1&&h1m(this.K);this.U=O.status;this.api.MX("localmediachange",{videoId:O.videoId,status:O.status})};
g.T.Lq=function(){var O=this,V;return g.Q(function(J){if(J.j==1){if(O.j)return J.return();O.j=!0;V=O.player.getVideoData().videoId;return J.K(X8(O,V),2)}return J.K(O.K.Lq(),0)})};
g.T.YK=function(O){switch(O){case "HD_1080":return"hd1080";case "HD":return"hd720";case "SD":return"large";case "LD":return"tiny";default:return"hd720"}};
g.T.L=function(O){return this.api.Y().L(O)};g.I(Xus,v1);Xus.prototype.j=function(O){return H1(O)?dUV(this,O):jb(O)?gSz(this,O):pG1(O)?qTC(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};AFn.prototype.K=function(O,V){var J=O.action.actionMetadata.priority-V.action.actionMetadata.priority;J===0&&(O.K<V.K?J=-1:O.K>V.K&&(J=1));return J};g.I(dK,g.K);dK.prototype.U5=function(){this.qX&&this.qX();g.K.prototype.U5.call(this)};
dK.prototype.createAction=function(O,V){var J=g.$y(O.entityKey).entityType,y=g.mR(16);return new UY(J,y,O,V.actionId,V.rootActionId)};
dK.prototype.lw=function(O){var V=this,J,y,l,m,H,F,N,x,W;return g.Q(function(U){if(U.j==1){if(V.GL())return U.return();y=(J=O.offlineOrchestrationActionWrapperEntity)!=null?J:new Set;l=[];m=g.n(y);for(H=m.next();!H.done;H=m.next())F=H.value,N=g.$y(F),x=N.entityId,Rhy(V.K,x)||l.push(F);return U.K(mEz(V,l),2)}W=U.U;return U.K(lNm(V,W),0)})};
dK.prototype.retry=function(){var O=this;return g.Q(function(V){return V.K($Ed(O),0)})};j5W.prototype.R2=function(O,V){V=V===void 0?!0:V;var J=this,y,l,m,H,F,N,x,W;return g.Q(function(U){switch(U.j){case 1:if(!J.K)return U.return();y=[];l=g.P9(J.K.K,V);m=[];for(H={Uz:0};H.Uz<l.length;H={Uz:H.Uz},H.Uz++)F=l[H.Uz],N=J.K.nJ(F,"json3"),x=g.bM(N,{withCredentials:!0,format:"RAW"},3,500).then(function(Z){return function(z){z={metadata:g.Ej(l[Z.Uz]),trackData:z.xhr.responseText};m.push(z)}}(H)).TP(function(Z){OY("Caption fetch error",Z)}),y.push(x);
return U.K(sLD(y),2);case 2:return U.W(3),U.K(B2s(O,m),5);case 5:U.S(0);break;case 3:W=U.D(),OY("Caption DB transaction error",W),U.V()}})};g.I(gK,g.K);gK.prototype.U5=function(){this.j&&this.j();g.K.prototype.U5.call(this)};
gK.prototype.U=function(O){var V=this,J,y,l,m,H,F,N,x;return g.Q(function(W){y=(J=O.transfer)!=null?J:new Set;l=[];m=g.n(y);for(H=m.next();!H.done;H=m.next())F=H.value,N=g.$y(F),x=N.entityId,l.push(x);return l.length===0?W.return():W.K(NPE(V,l),0)})};g.I(z1d,g.K);g.T=z1d.prototype;g.T.U5=function(){this.fD&&this.fD();this.O5.dispose();this.D.dispose();this.ol&&g.JF(this.V.Ps,this.ol);this.Vz&&g.JF(this.V.Ps,this.Vz);g.K.prototype.U5.call(this)};
g.T.iuL=function(O){var V=this,J,y,l;return g.Q(function(m){switch(m.j){case 1:J=g.Hq(O,"transfer");if(V.K&&J===V.K.key){EY(V.S,V.W,!0);V.D.stop();m.uw(0);break}return m.K(rm(V.j,{mode:"readwrite",cY:!0},function(H){return qr(H,J,"transfer").then(function(F){if(F&&F.transferState!=="TRANSFER_STATE_COMPLETE"&&F.transferState!=="TRANSFER_STATE_FAILED")return F.transferState="TRANSFER_STATE_PAUSED_BY_USER",Kw(H,F,"transfer").then(function(){return F})})}),3);
case 3:y=m.U;if(!y){m.uw(0);break}if(!O||!V.U){m.uw(5);break}return m.K(F8(O,V.U,V.j,"DOWNLOAD_STATE_PAUSED"),5);case 5:return m.K(Ga(V,O),7);case 7:l=m.U,alm({videoId:O,r8:y,offlineModeType:l}),m.V()}})};
g.T.F0K=function(){var O=this;if(this.K&&this.W){EY(this.S,this.W,!1);var V=this.K,J=(V==null?0:V.key)?g.$y(V.key).entityId:"";J&&this.U&&(new Promise(function(y,l){F8(J,O.U,O.j,"DOWNLOAD_STATE_PAUSED").catch(function(m){l(m)})})).catch(function(y){OY("Download state setting error",y)})}this.D.stop()};
g.T.Qb=function(){this.K?TPF(this,this.K):Qu(this)};
g.T.GZ=function(O){var V=this;return g.Q(function(J){switch(J.j){case 1:if(!V.K){J.uw(2);break}if(V.K.transferState==="TRANSFER_STATE_COMPLETE"||V.K.transferState==="TRANSFER_STATE_FAILED"||!O.transfer||!O.transfer.has(V.K.key)){J.uw(3);break}return J.K(RA(V.j,V.K.key,"transfer"),4);case 4:V.K=J.U;if(V.K){J.uw(3);break}return J.K(e1z(V),3);case 3:if(V.K)return J.return();case 2:return J.K(Qu(V),0)}})};
g.T.Sm=function(O,V){var J=this,y,l,m,H,F;return g.Q(function(N){switch(N.j){case 1:if(!J.K){KQ(J,"onTransferFailure: "+O);N.uw(2);break}y=J.K;m=((l=y)==null?0:l.key)?g.$y(y.key).entityId:"";a:switch(O){case "TRANSFER_FAILURE_REASON_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_EXTERNAL_FILESYSTEM_WRITE":case "TRANSFER_FAILURE_REASON_PLAYABILITY":case "TRANSFER_FAILURE_REASON_TOO_MANY_RETRIES":var x=!1;break a;default:x=!0}return x&&vU1(J)?N.K(tv(J,"TRANSFER_STATE_TRANSFER_IN_QUEUE"),8):N.K(wP1(J,
O),5);case 5:if(!m||!J.U){N.uw(2);break}return N.K(F8(m,J.U,J.j,"DOWNLOAD_STATE_FAILED"),2);case 8:return N.K(Ga(J,m),9);case 9:H=N.U;mF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_RETRY"},{videoId:m,r8:y,offlineModeType:H});if(!m||!J.U){N.uw(2);break}return N.K(F8(m,J.U,J.j,"DOWNLOAD_STATE_RETRYABLE_FAILURE"),2);case 2:qG(J),F=Qu(J,!0),V&&V(F),N.V()}})};
g.T.Lq=function(O){var V=this,J,y,l,m,H,F,N,x,W,U,Z,z;return g.Q(function(c){switch(c.j){case 1:if(!V.K){KQ(V,"onMaybeTransferStreamsExpired");c.uw(2);break}return vU1(V)?c.K(tv(V,"TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"),9):c.K(wP1(V,"TRANSFER_FAILURE_REASON_STREAM_MISSING"),5);case 5:if(!V.U){c.uw(2);break}J=V.K;l=((y=J)==null?0:y.key)?g.$y(J.key).entityId:"";if(!l){c.uw(2);break}return c.K(F8(l,V.U,V.j,"DOWNLOAD_STATE_FAILED"),2);case 9:return V.K||KQ(V,"onMaybeTransferStreamsExpiredRetryAttempting"),
m=V.K,F=((H=m)==null?0:H.key)?g.$y(m.key).entityId:"",c.K(Ga(V,F),10);case 10:return N=c.U,mF({transferStatusType:"TRANSFER_STATUS_TYPE_DEQUEUED_BY_PLAYER_RESPONSE_EXPIRATION"},{videoId:F,r8:m,offlineModeType:N}),x=v9E(),g.fY(x,LQ,{isEnqueuedForExpiredStreamUrlRefetch:!0}),W=g.Hq(F,"playbackData"),U={actionType:"OFFLINE_ORCHESTRATION_ACTION_TYPE_ADD",entityKey:W,actionMetadata:x},Z=za(new UY("playbackData",F,U)),c.K(ix(V.j,Z,"offlineOrchestrationActionWrapperEntity"),2);case 2:qG(V),z=Qu(V,!0),O&&
O(z),c.V()}})};
var XyF={},MJW=(XyF.TRANSFER_STATE_TRANSFERRING=1,XyF.TRANSFER_STATE_TRANSFER_IN_QUEUE=2,XyF);g.T=uq.prototype;g.T.qy=function(){return this.W.promise};
g.T.Nh=function(){if(this.j&&this.S)return this.W.promise;XPI(this).then(this.W.resolve).catch(this.W.reject);return this.W.promise};
g.T.B5=function(O){var V={};return V.playbackData=new zhI(O,this.B,this.K),V.transfer=new Xus(O,this.B),V.videoPlaybackPositionEntity=new aWV(O,this.B),V};
g.T.RD=function(){var O=this;return g.Q(function(V){return O.j?V.K(cXz(O.j),0):V.uw(0)})};
g.T.zH=function(){var O=this,V,J;return g.Q(function(y){if(y.j==1)return O.j||O.S?y.K(O.qy(),2):y.return();O.T!==void 0&&(g.xg(O.T),O.T=void 0);O.D!==void 0&&(g.xg(O.D),O.D=void 0);(V=O.j)==null||V.dispose();O.j=void 0;(J=O.S)==null||J.dispose();O.S=void 0;O.api.MX("onOrchestrationLostLeader");O.W=new g.HP;y.V()})};
g.T.isOrchestrationLeader=function(){return this.U.K};
g.T.Ke=function(){return g.Q(function(O){return O.return(!1)})};
g.T.vA=function(O){var V=this.K;V.api.publish("offlinetransferpause",O);var J;(J=V.j)==null||J.postMessage(O)};
g.T.Qb=function(O){var V,J;return g.Q(function(y){if(y.j==1)return y.K(Pr(),2);V=y.U;if(!V)return y.return();J=g.Hq(O,"transfer");return y.K(rm(V,{mode:"readwrite",cY:!0},function(l){var m=qr(l,J,"transfer"),H=qr(l,g.Hq(O,"videoDownloadContextEntity"),"videoDownloadContextEntity");return g.WH.all([m,H]).then(function(F){F=g.n(F);var N=F.next().value;var x=F.next().value;return N&&N.transferState==="TRANSFER_STATE_PAUSED_BY_USER"?(N.transferState="TRANSFER_STATE_TRANSFER_IN_QUEUE",Kw(l,N,"transfer").then(function(){mF({transferStatusType:"TRANSFER_STATUS_TYPE_REENQUEUED_BY_USER_RESUME",
statusType:"USER_RESUMED"},{videoId:O,r8:N,offlineModeType:x==null?void 0:x.offlineModeType});return g.WH.resolve(null)})):g.WH.resolve(null)})}),0)})};
g.T.ZB=function(O){O=O===void 0?43200:O;var V=this,J,y,l,m,H,F,N,x;return g.Q(function(W){if(W.j==1)return V.V.fE()?W.K(Pr(),2):W.return(EUC());if(W.j!=3){J=W.U;if(!J)return W.return([]);y=Date.now()/1E3;return W.K(Br(J,"offlineVideoPolicy"),3)}l=W.U;m=[];H=g.n(l);for(F=H.next();!F.done;F=H.next())N=F.value,Number(N.lastUpdatedTimestampSeconds)+O<=y&&(x=g.$y(N.key).entityId,m.push(x));return m.length?W.return(Av(V,m,V.qX,"OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH")):W.return([])})};
g.T.deleteAll=function(){return Av(this,["!*$_ALL_ENTITIES_!*$"],this.qX,"OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",{offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}})};
g.T.refreshAllStaleEntities=function(O){var V=this;return g.Q(function(J){return J.j==1?J.K(V.ZB(O),2):J.return(J.U)})};
g.T.setUpPositionSyncInterval=function(O){var V=this;this.D!==void 0&&(g.xg(this.D),this.D=void 0);var J=O!=null?O:864E5;this.D=g.FR(function(){V.dK(J)},J)};
g.T.dK=function(O){var V=this,J,y,l,m,H,F;return g.Q(function(N){switch(N.j){case 1:return N.W(2),N.K(Xx.getInstance(),4);case 4:J=N.U;if(!J)throw Error("prefStorage is undefined");return N.K(J.get("psi"),5);case 5:y=N.U;m=((l=y)==null?0:l.y7)?Number(y.y7)/1E3:0;H=Date.now();if(!(m+O<=H)){N.uw(6);break}return N.K(Av(V,["!*$_ALL_ENTITIES_!*$"],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_REFRESH"),6);case 6:N.S(0);break;case 2:F=N.D(),OY("Offline manager error",F),N.V()}})};
g.T.qh=function(){var O=this,V,J,y,l,m,H,F;return g.Q(function(N){if(N.j==1)return N.K(Pr(),2);if(N.j!=3)return(V=N.U)?N.K(Br(V,"transfer"),3):N.return([]);J=N.U;y=[];l=g.n(J);for(m=l.next();!m.done;m=l.next())H=m.value,H.transferState==="TRANSFER_STATE_WAITING_FOR_PLAYER_RESPONSE_REFRESH"&&H.key&&(F=g.$y(H.key).entityId,y.push(F));return N.return(gUV(O,y))})};
g.T.xX=function(){return g.Q(function(O){return O.return([])})};
g.T.yk=function(){return g.Q(function(O){O.V()})};
g.T.CX=function(){return g.Q(function(O){O.V()})};g.I(q91,v1);q91.prototype.j=function(O){return H1(O)?KaE(this,O):jb(O)?uPV(this,O):CQ(O)?AXm(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};
var rK=[10];g.I(PNF,v1);PNF.prototype.j=function(O){return H1(O)?DEm(this,O):jb(O)?OZs(this,O):CQ(O)?VLy(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};
var S9D=[10];g.I(y_V,v1);y_V.prototype.j=function(O){return jb(O)?mnz(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};g.I($nD,uq);g.T=$nD.prototype;g.T.B5=function(O){var V=uq.prototype.B5.call(this,O);V.mainVideoEntity=new PNF(O,this.B,this.K);V.mainPlaylistEntity=new q91(O,this.B,this.K);V.mainDownloadsListEntity=new y_V(O,this.B,this.K);return V};
g.T.refreshAllStaleEntities=function(O,V){var J=this,y,l,m,H,F,N,x,W,U,Z,z;return g.Q(function(c){switch(c.j){case 1:y=[];if(!J.B.L("web_player_offline_playlist_auto_refresh")){c.uw(2);break}return c.K(HZz(J,O,V),3);case 3:y=c.U;case 2:return c.K(Xx.getInstance(),4);case 4:return l=c.U,c.K((m=l)==null?void 0:m.get("sdois"),5);case 5:return H=c.U,c.K((F=l)==null?void 0:F.get("lmqf"),6);case 6:N=c.U;if(!H){c.uw(7);break}W=y;U=W.concat;return c.K(jZs(J,H,(x=N)!=null?x:"SD",O===0),8);case 8:y=U.call(W,
c.U);case 7:return Z=y,z=Z.concat,c.K(uq.prototype.refreshAllStaleEntities.call(J,O,V),9);case 9:return y=z.call(Z,c.U),c.return(y)}})};
g.T.Ke=function(O){var V,J,y,l,m,H,F,N;return g.Q(function(x){if(x.j==1)return x.K(Pr(),2);if(x.j!=3)return(V=x.U)?x.K(RA(V,Iv,"mainDownloadsListEntity"),3):x.return(!1);J=x.U;if((y=J)==null?0:(l=y.downloads)==null?0:l.length)for(m=g.Hq(O,"mainVideoEntity"),H=g.n(J.downloads),F=H.next();!F.done;F=H.next())if(N=F.value,N.videoItem===m)return x.return(!0);return x.return(!1)})};
g.T.xX=function(){var O=this,V,J,y,l,m,H,F,N;return g.Q(function(x){if(x.j==1)return x.K(Pr(),2);if(x.j!=3)return(V=x.U)?x.K(Br(V,"downloadStatusEntity"),3):x.return([]);J=x.U;y=[];l=g.n(J);for(m=l.next();!m.done;m=l.next())H=m.value,H.downloadState==="DOWNLOAD_STATE_USER_DELETED"&&H.key&&(F=g.$y(H.key).entityId,y.push(F));return y.length?(N={offlineLoggingData:{offlineDeleteReason:"OFFLINE_DELETE_REASON_USER_INITIATED"}},x.return(Av(O,y,"mainVideoEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_DELETE",
N))):x.return([])})};
g.T.CX=function(){var O;return g.Q(function(V){return V.j==1?V.K(Pr(),2):(O=V.U)?V.K(rm(O,{mode:"readwrite",cY:!0},function(J){return QM(J,"mainVideoEntity").then(function(y){var l=[];y=g.n(y);for(var m=y.next();!m.done;m=y.next()){m=m.value;var H=void 0;(H=m.userState)!=null&&H.playbackPosition||(H=g.$y(m.key).entityId,H={key:g.Hq(H,"videoPlaybackPositionEntity"),videoId:H,lastPlaybackPositionSeconds:"0"},l.push(Kw(J,H,"videoPlaybackPositionEntity")),m.userState={playbackPosition:H.key},l.push(Kw(J,
m,"mainVideoEntity")))}return g.WH.all(l)})}),0):V.return()})};
g.T.yk=function(){var O,V,J,y,l,m,H,F,N,x,W,U,Z,z,c,Y,b,M,w,L,X,u,G,k,D,Oo,md,xY,V7,Tr,Rp,ys,JI,uX,nn,im,fd,h;return g.Q(function(X1){if(X1.j==1)return X1.K(Pr(),2);if(X1.j!=3){O=X1.U;if(!O)return X1.return();V=g.Hq("DOWNLOADS_LIST_ENTITY_ID_MANUAL_DOWNLOADS","mainDownloadsListEntity");return X1.K(rm(O,{mode:"readonly",cY:!0},function(AI){return g.WH.all([qr(AI,V,"mainDownloadsListEntity"),qr(AI,Iv,"mainDownloadsListEntity"),QM(AI,"mainVideoEntity"),QM(AI,"mainPlaylistEntity")])}),3)}J=X1.U;
y=g.n(J);l=y.next().value;m=y.next().value;H=y.next().value;F=y.next().value;N=l;x=m;W=H;U=F;Z=new Set;if((z=N)==null?0:(c=z.downloads)==null?0:c.length)for(Y=g.n(N.downloads),b=Y.next();!b.done;b=Y.next())M=b.value,w=void 0,(L=(w=M.videoItem)!=null?w:M.playlistItem)&&Z.add(L);if((X=x)==null?0:(u=X.downloads)==null?0:u.length)for(G=g.n(x.downloads),k=G.next();!k.done;k=G.next())D=k.value,D.videoItem&&Z.add(D.videoItem);Oo=new Set;md=[];xY=g.n(U);for(V7=xY.next();!V7.done;V7=xY.next()){Tr=V7.value;
if(Tr.videos)for(Rp=g.n(Tr.videos),ys=Rp.next();!ys.done;ys=Rp.next())JI=ys.value,(uX=JSON.parse(g.$y(JI).entityId).videoId)&&Oo.add(uX);Tr.key&&!Z.has(Tr.key)&&md.push(Tr.key)}nn=g.n(W);for(im=nn.next();!im.done;im=nn.next())fd=im.value,fd.key&&!Z.has(fd.key)&&(h=g.$y(fd.key).entityId,Oo.has(h)||md.push(fd.key));return md.length?X1.K(uuD(O,md),0):X1.uw(0)})};g.I(CLW,v1);CLW.prototype.j=function(O){return H1(O)?N7C(this,O):jb(O)?xns(this,O):CQ(O)?WEW(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};
var Rv=[10];g.I(ZZV,v1);ZZV.prototype.j=function(O){return H1(O)?c_n(this,O):jb(O)?sZm(this,O):CQ(O)?T7D(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};
var B1=[10];g.I(Y7W,v1);Y7W.prototype.j=function(O){return H1(O)?f0y(this,O):jb(O)?hGz(this,O):CQ(O)?o6z(this,O):Promise.reject(Error("Unsupported action type: "+O.actionType))};
var pyd=[10];g.I(P1,uq);P1.prototype.B5=function(O){var V=uq.prototype.B5.call(this,O);V.musicTrack=new Y7W(O,this.K);V.musicPlaylist=new ZZV(O,this.K);V.musicAlbumRelease=new CLW(O,this.K);return V};
P1.prototype.refreshAllStaleEntities=function(O,V){var J=this,y,l,m;return g.Q(function(H){if(H.j==1)return H.K(wyz(J,O,V),2);if(H.j!=3)return l=y=H.U,m=l.concat,H.K(uq.prototype.refreshAllStaleEntities.call(J,O,V),3);y=m.call(l,H.U);return H.return(y)})};g.I(MLD,g.zm);g.T=MLD.prototype;g.T.create=function(){var O=this;g.t(this,this.events);if(g.ZG(this.B))this.K=new $nD(this.B,this.player);else if(g.pJ(this.B)||g.cJ(this.B))this.K=new P1(this.B,this.player);this.events.Z(this.player,"onPlaybackStartExternal",function(){O.Yo()});
this.events.Z(this.player,"videodatachange",function(){O.Yo()});
this.B.L("html5_offline_playback_position_sync")&&this.events.Z(this.player,"presentingplayerstatechange",this.wT)};
g.T.W1=function(){return!1};
g.T.Xz=function(O,V,J,y){var l=this;return g.Q(function(m){return l.K?m.return(Av(l.K,O,V,J,y)):m.return(Promise.reject())})};
g.T.deleteAll=function(){return this.K.deleteAll()};
g.T.ZB=function(O){return this.K.ZB(O)};
g.T.refreshAllStaleEntities=function(O){return this.K.refreshAllStaleEntities(O)};
g.T.setUpPositionSyncInterval=function(O){this.K.setUpPositionSyncInterval(O)};
g.T.vA=function(O){this.K.vA(O)};
g.T.Qb=function(O){return this.K.Qb(O)};
g.T.Yo=function(){var O=this,V;return g.Q(function(J){V=O.player.getVideoData();return g.UJ(V)?LEV(V)&&O.j!==V.clientPlaybackNonce?J.K(n6z(O,V),0):J.uw(0):J.return()})};
g.T.wT=function(O){var V=this,J,y,l,m,H,F,N;return g.Q(function(x){if(x.j==1)return J=V.player.getVideoData(),y=J.oB,g.Jg(O,2)||g.Jg(O,512)?x.K(Pr(),2):x.return();if(x.j!=3){l=x.U;if(!l)return OY("PES is undefined"),x.return();m=J.videoId;return x.K(RA(l,g.Hq(m,"mainVideoEntity"),"mainVideoEntity"),3)}H=x.U;if(!H)return x.return();F=Math.floor(y).toString();N={videoPlaybackPositionEntityActionMetadata:{lastPlaybackPositionSeconds:F}};return x.K(V.Xz([m],"videoPlaybackPositionEntity","OFFLINE_ORCHESTRATION_ACTION_TYPE_UPDATE",
N),0)})};
g.T.isOrchestrationLeader=function(){return this.K.isOrchestrationLeader()};
g.T.updateDownloadState=function(O,V){var J,y,l,m;return g.Q(function(H){if(H.j==1)return H.K(Pr(),2);J=H.U;if(!J)return OY("PES is undefined"),H.return();y=g.$y(O);l=y.entityType;m=y.entityId;return H.K(F8(m,l,J,V,!0),0)})};g.Z8("offline",MLD);})(_yt_player);
